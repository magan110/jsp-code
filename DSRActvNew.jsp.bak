<%@ include file="/Envr/JSP/SecurityCom.jsp"%>

<%
ResultSet rset = null;

/*
http://10.4.64.20/BirlaWhite/Mobile/DSRActv.jsp

ADD EDIT DELETE Button to be Given 

dsrSizAr Text Box Limit Size Array to be Filled with Department Condition

separate 

DSR Changes In DEC 2018

	1.	DSR Open in update Mode with Last Three Days
	2.  Added Search Box in areaCode
	3.  AJAX Dropdown in Purchaser & Retl Code
	4.  New Dept type Added For varun Goyal KKR162
	5.  Added New product 
	6.  Also Capture Area Code during Save page
	7.  Added New Column For cusRtTyp
	8.  Approval Proccess For new VAP Team
	9.  Added Two new Colummn For CASC Name& Mobile No in Site Activity -- Pending


DSR Change 05/09/2019

1.  Market mapping
2.


*/
String  sql = "",
		procType = "A",
		docuNumb = "",
		paramCod = "",
		paramDes = "",
		mktNamUF = "Y",
		cusRtlFl = "",
		areaCode = "",
		custCdRt = "",
		cusRtlCd = "",
		randNmSt = "",
		stateGeo = "",
		pinCodeN = "",
		custName = "",
		cstBisTy = "",
		prtDsCnt = "",
		kycVerFl = "",
		pndIsuDt = "",
		pendIsue = "N",
		cityName = "",
		calVstTy = "",
		FinlRslt = "",
		geoLatit = "",
		geoLongt = "",
		wcErlSlb = "0",
		wpErlSlb = "0",
		vpErlSlb = "0",
		ordExDat = "",
		dsrRem09 = "",
		dsrRem01 = "",
		wcHgstSl = "",
		pendWith = "",
		mrktName = "",
		brndSlWc = "",
		brndSlWp = "",
		isuDetal = "",
		dsrRem02 = "",
		dsrRem03 = "",
		dsrRem04 = "",
		dsrRem05 = "",
		dsrRem06 = "",
		bwAvgWcc = "",
		bwAvgWcp = "",
		sapLgnGr = (log.sapLgnIdGet().length() < 6 ? "" : log.sapLgnIdGet().substring(0, 6)),
		bwAvgVap = "",
		dsrRem07 = "",
		dsrRem08 = "",
		bwStkWcc = "0.00",
		bwStkWcp = "0.00",
		bwStkVap = "0.00",
		docuSrNo = "",
		repoCatg = "",
		prodQnty = "",
		statCode = "",
		areaDesc = "",
		cuRtType = "",
		actnRemk = "",
		targetDt = "",
		docuTySt = "",
		zoneCode = "",
		message  = "",
		locaCapr = "",
		lgtitute = "",
		latitute = "",
		district = "",
		cusRtlNm = "",
		mobileNo = "",
		prdCodMk = "",
		docuType = "",
		docuDate = sysDateOnly, 
		strtDate = "01" + sysDateOnly.substring(2),
		dsrParam = "",
		deptCode = log.deptCodeGet(), // For Department added KKR115	Advertisement 26-Apr-18 
//		deptCode = "KKR116", 
		dsrParamStr = "",
		wcHgstSlStr = "",
		cusRtlFlStr = "",
		custLabl = "Purchaser / Retailer",
		dsrRemAr[] = new String[8],
		dsrSizAr[][] = new String[4][8], // 0 and 1 for Text Area Ht Wd and 2 for S Select List, T for text Box 
		formName = "DSRActvNew"; 
int i, j, msAreCnt, trAreCnt;
boolean recFound = false,
		actPntRq = false,
		prdSelRq = false,
		cusSelRq = false,
		cusCodRq = false,
		prjSelRq = false,
		pinCdRqA = false,
		dsrEntAl = true,
		dsrStkAl = true,
		rtlTrgFl = false,
		docuDtRq = false;

int		ttlMpdRt = 0,
		ttlMpdUq = 0,
		targtCmt = 0,
		targtPty = 0,
		targtVAP = 0;
Double 	trgCmtPr = 0.00,
		trgPtyPr = 0.00,
		trgVapPr = 0.00;

for(j = 0; j < dsrSizAr[0].length; j++) // common Width for Text Area 
{
	dsrSizAr[0][j] = "2";
	dsrSizAr[1][j] = "35";
	dsrSizAr[2][j] = "T";
	dsrRemAr[j] = "";
}
if(sapLgnGr.equals("BWZHKY") || sapLgnGr.equals("BWSHRT") || sapLgnGr.equals("BWZHCS") || sapLgnGr.equals("BWZCUB")) 
{
	pendWith = log.getZoneHead();
}
else if(sapLgnGr.equals("BWMORL")) 
{
	pendWith = log.rurlHeadGet(); //ruralHead
}
else if(log.deptCodeGet().equals("KKR162")) 
{
	pendWith = "2440"; //VAP Team
}
else
{
	pendWith = log.getStatHead();
}

if(log.getUserType().equals("S"))
{
	sql = "select retlArHd from bkmAreaMast where areaCode = '" + log.getArCode() + "' ";
	rset = WebSessBean.selectRecord(sql);

	if(rset.next())
	{
		pendWith = rset.getString(1);
	}

}

wcHgstSlStr = WebSessBean.getSqlToOptionStr("select sapPrdCd, prodDesc + ' : ' + repoCatg from bkmProducts with (nolock) where isActive = 'Y' and repoCatg in  ('02','01') and packSize in (40,50) and tradeNtr = 'T' ", prdCodMk);

statCode = log.stateCodGet();

	sql = "select zoneCode from bkmAreaStZn where areaCode = '" + log.getArCode() + "' ";
	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
		zoneCode = rset.getString(1);
	}

	if(zoneCode.equals("A"))
	{
		pinCdRqA = true;
	}
	
//	loginIdM = "2961";
	sql = "select  count(distinct a.areaCode), count(distinct b.areaCode) "
		+ "from	bkmAreaMast a with (nolock) left outer join dptMktIntel b with (nolock) on a.areaCode = b.areaCode and		b.mnthYear = dbo.cofPrevMnYr(convert(varchar(6), getdate(), 112),  getdate())  "
		+ "where	a.retlArHd = '" + loginIdM + "' and  a.areaCode not in ('EXE','EXT','EXR','KKR', 'KAT', 'DLC') and a.isActive = 'Y' ";
	rset = WebSessBean.selectRecord(sql);
//	out.println(sql);
	if(rset.next())
	{
		msAreCnt = rset.getInt(1);
		trAreCnt = rset.getInt(2);
//	out.println("msAreCnt : " + msAreCnt + loginIdM);
//	out.println("trAreCnt : " + trAreCnt);
		if(msAreCnt > 0 && msAreCnt != trAreCnt) // && trAreCnt != "0"		  unComment When Lockdown over
			dsrEntAl = false;
	}

//	loginIdM = "2961";
	sql = "select  count(distinct a.areaCode), count(distinct b.areaCode) "
		+ "from	bkmAreaMast a with (nolock) left outer join "
		+ "( "
		+ "		select distinct a.mnthYear, b.areaCode "
		+ "		from dptStkTgtRc a with (nolock), dpmCustomer b with (nolock) "
		+ "		where mnthYear = convert(varchar(6), getdate(), 112) "
		+ "		and   a.custCode  = b.custCode and a.repoCatg = '01' "
		+ ") b "
		+ "on a.areaCode = b.areaCode and		b.mnthYear = convert(varchar(6), getdate(), 112) "
		+ "where	a.areaCode not in ('EXE','EXR','KKR','EXT', 'KAT', 'DLC') "
		+ "and	a.retlArHd = '" + loginIdM + "' and  a.areaCode not in ('EXE','EXR','EXT','KKR', 'KAT', 'DLC') and a.isActive = 'Y'  ";
	rset = WebSessBean.selectRecord(sql);

	if(rset.next())
	{
		msAreCnt = rset.getInt(1);
		trAreCnt = rset.getInt(2);

//	out.println("msAreCnt : " + msAreCnt + loginIdM);
//	out.println("trAreCnt : " + trAreCnt);
		if(msAreCnt > 0 && msAreCnt != trAreCnt) // && trAreCnt != "0" --Commented as per Rajendra advise 04-02-2020
			dsrStkAl = false;
	}
	
	if(dsrStkAl)
	{
		sql = "select  count(distinct a.areaCode), count(distinct b.areaCode) "
			+ "from	bkmAreaMast a with (nolock) left outer join "
			+ "( "
			+ "		select distinct a.mnthYear, b.areaCode "
			+ "		from dptStkTgtRc a with (nolock), dpmCustomer b with (nolock) "
			+ "		where mnthYear = convert(varchar(6), getdate(), 112) "
			+ "		and   a.custCode  = b.custCode and a.repoCatg = '02' "
			+ ") b "
			+ "on a.areaCode = b.areaCode and		b.mnthYear = convert(varchar(6), getdate(), 112) "
			+ "where	a.areaCode not in ('EXE','EXR','EXT','KKR', 'KAT', 'DLC') "
			+ "and	a.retlArHd = '" + loginIdM + "' and  a.areaCode not in ('EXE','EXR','EXT','KKR', 'KAT', 'DLC') and a.isActive = 'Y'  ";
		rset = WebSessBean.selectRecord(sql);

		if(rset.next())
		{
			msAreCnt = rset.getInt(1);
			trAreCnt = rset.getInt(2);

	//	out.println("msAreCnt : " + msAreCnt + loginIdM);
	//	out.println("trAreCnt : " + trAreCnt);
			if(msAreCnt > 0 && msAreCnt != trAreCnt) // && trAreCnt != "0" --Commented as per Rajendra advise 04-02-2020
				dsrStkAl = false;
		}
	}
	sql = "select AreaDesc from bkmAreaMast with (nolock) where retlArHd = '" + loginIdM + "' ";
	rset = WebSessBean.selectRecord(sql);

	while(rset.next())
	{
		areaDesc += rset.getString(1) + ", ";
	}

if(zoneCode.equals("C"))
{
	sql = "select  sum(mapedRtlCnt), sum(trgtEntCt), sum(cmt01) as cmt01, sum(cmt02) as cmt02, sum(cmt03) as cmt03, sum(ttlCnt) as ttlCnt, "
		+ "		   dbo.cofCalcPerc('normPerc', sum(cmt01), sum(mapedRtlCnt)) as 'Cmt-%', "
		+ "		   dbo.cofCalcPerc('normPerc', sum(cmt02), sum(mapedRtlCnt)) as 'Puty-%', "
		+ "		   dbo.cofCalcPerc('normPerc', sum(cmt03), sum(mapedRtlCnt)) as 'Vap-%' "
		+ "From  "
		+ "( "
		+ "	select b.loginIdM, b.emplName, count(*)  as mapedRtlCnt, 0 as trgtEntCt, 0 as cmt01,0 as cmt02, 0 as cmt03, 0 as ttlCnt "
		+ "	from rtmRetailer a with (nolock), prmEmployee b with (nolock), bkmAreaStZn c with (nolock) "
		+ "	where a.concEmpl = b.loginIdM "
		+ "	and   b.areaCode = c.areaCode "
		+ "	and   a.isActive = 'Y' "
		+ "	and   b.isActive = 'Y' "
		+ "	and   c.zoneCode = 'C' and   a.createDt < '01 Sep 2021' "
		+ " and   b.loginIdM = '" + loginIdM + "' "
		+ "	group by b.loginIdM, b.emplName "
		+ "	union all "
		+ "	select b.loginIdM, b.emplName, 0, count(distinct a.retlCode) as trgtEntCt,  "
		+ "		   sum(case when repoCatg = '01' then 1 else 0 end) as cmt01, "
		+ "		   sum(case when repoCatg = '02' then 1 else 0 end) as cmt02, "
		+ "		   sum(case when repoCatg = '03' then 1 else 0 end) as cmt03, count(*) as ttlCnt "
		+ "	from rtmRetailer a with (nolock), prmEmployee b with (nolock), bkmAreaStZn c with (nolock), dptCusRtlTg d with (nolock) "
		+ "	where a.concEmpl = b.loginIdM "
		+ "	and   b.areaCode = c.areaCode "
		+ "	and   a.retlCode = d.cusRtlCd "
		+ "	and   d.cusRtlFl = 'R' "
		+ "	and   d.mnthYear = CONVERT(varchar(6), getdate(), 112) "
		+ "	and   d.statFlag not in ('C','R') "
		+ "	and   a.isActive = 'Y' "
		+ "	and   b.isActive = 'Y' "
		+ "	and   c.zoneCode = 'C' "
		+ " and   b.loginIdM = '" + loginIdM + "' "
		+ "	group by b.loginIdM, b.emplName "
		+ ") x "
		+ "where x.loginIdM not in ('2004') and x.loginIdM = '" + loginIdM + "' "
		+ "group by loginIdM, emplName ";

	rset = WebSessBean.selectRecord(sql);

	if(rset.next())
	{
		ttlMpdRt = rset.getInt(1);
		ttlMpdUq = rset.getInt(2);
		targtCmt = rset.getInt(3);
		targtPty = rset.getInt(4);
		targtVAP = rset.getInt(5);
		trgCmtPr = rset.getDouble(7);
		trgPtyPr = rset.getDouble(8);
		trgVapPr = rset.getDouble(9);

		if(ttlMpdRt > 0 && (trgCmtPr < 100 || trgPtyPr < 100 || trgVapPr < 100))
		{
			dsrEntAl = false;
			rtlTrgFl = true;
		}
	}
}

// out.println("dsrStkAl " + dsrStkAl);

sql = "select '1BF', 'Before' union select '2AF', 'After' union select 'ADH', 'More Image' ";
docuTySt = WebSessBean.getSqlToOptionStr(sql, ""); 

if (XssFilter.parSmGet("deptCode") != null)
	deptCode = XssFilter.parSmGet("deptCode");

if (XssFilter.parSmGet("dsrRem08") != null)
	dsrRem08 = XssFilter.parSmGet("dsrRem08");

if (XssFilter.parSmGet("cusRtlFl") != null)
	cusRtlFl = XssFilter.parSmGet("cusRtlFl");

if (XssFilter.parSmGet("procType") != null)
	procType = XssFilter.parSmGet("procType");

if (XssFilter.parSmGet("docuNumb") != null)
	docuNumb = XssFilter.parSmGet("docuNumb");

if (XssFilter.parSmGet("cuRtType") != null)
	cuRtType = XssFilter.parSmGet("cuRtType");

if (XssFilter.parSmGet("calVstTy") != null)
	calVstTy = XssFilter.parSmGet("calVstTy");

if (XssFilter.parSmGet("areaCode") != null)
	areaCode = XssFilter.parSmGet("areaCode");

if (XssFilter.parSmGet("cusRtlCd") != null)
	cusRtlCd = XssFilter.parSmGet("cusRtlCd");

if (XssFilter.parSmGet("dsrParam") != null)
	dsrParam = XssFilter.parSmGet("dsrParam");

if (XssFilter.parSmGet("formName") != null)
	formName = XssFilter.parSmGet("formName");

if (XssFilter.parSmGet("docuDate") != null)
	docuDate = XssFilter.parSmGet("docuDate");

if (XssFilter.parSmGet("message") != null)
	message = XssFilter.parSmGet("message");

if (XssFilter.parSmGet("docuType") != null)
	docuType = XssFilter.parSmGet("docuType");

if(procType.equals("U"))
{
	docuDtRq = true;
}
else if(procType.equals("A"))
{
	docuDtRq = false;
}
%>
 <!-- Header Starts -->
<jsp:include page="/Envr/JSP/HeaderCom.jsp" flush="true">
		<jsp:param name="mobFrend" value="B"/>
</jsp:include>
<!-- Header Ends -->

<%
try
{
	if(!docuNumb.equals("") && procType.equals("U"))
	{
		sql = "select docuNumb, convert(char(10), docuDate , 103), dsrParam, cusRtlFl, cusRtlCd, dsrRem01, dsrRem02, dsrRem03, dsrRem04, dsrRem05, dsrRem06, dsrRem07, dsrRem08, areaCode, isnull(cuRtType, ''), convert(char(10), ordExDat , 103)   from dptDSRActvt with (nolock) where docuNumb = '" + docuNumb + "'  and createId = '" + loginIdM + "' ";	// and createId = '" + loginIdM + "'
		rset = WebSessBean.selectRecord(sql);
	//	out.println(sql);
		if (rset.next())
		{
			docuNumb = rset.getString(1);
			docuDate = rset.getString(2);
			dsrParam = rset.getString(3);
			cusRtlFl = rset.getString(4);
			cusRtlCd = rset.getString(5);
			dsrRem01 = rset.getString(6);
			dsrRem02 = rset.getString(7);
			dsrRem03 = rset.getString(8);
			dsrRem04 = rset.getString(9);
			dsrRem05 = rset.getString(10);
			dsrRem06 = rset.getString(11);
			dsrRem07 = rset.getString(12);
			dsrRem08 = rset.getString(13);
			areaCode = rset.getString(14);
			cuRtType = rset.getString(15);
			ordExDat = rset.getString(16);
		}

		if (cuRtType.equals("RR"))
		{
			cusRtlFl = "RR";			
		}
		if (cuRtType.equals("RD"))
		{
			cusRtlFl = "RD";			
		}
		mrktName = dsrRem01; 
		pendIsue = dsrRem02; 
		pndIsuDt = dsrRem03; 
		isuDetal = dsrRem04; 
		brndSlWc = dsrRem06; 
		brndSlWp = dsrRem07; 
		prtDsCnt = dsrRem08; 

//		out.println("dsrRem01 : " + dsrRem01);
	//	areaCode = docuNumb.substring(3,6);

	//	out.println("areaCode Update " + areaCode);
	}

sql = "select 'R', 'Retailer' union select 'RR', 'Rural Retailer' union select 'C', 'Stockiest/ Urban Stockiest' union select 'D', 'Direct Dealer' union select 'RD', 'Rural Stockiest' union select 'AD', 'AD' union select 'UR', 'UBS' ";//select 'C', 'Stockiest/ Urbon Stockiest' union select 'D', 'Direct Dealer'  union select 'RD', 'Rural Stockiest'  union 
if(dsrParam.equals("52") || dsrParam.equals("13") || dsrParam.equals("23") || dsrParam.equals("41") || dsrParam.equals("50"))
	actPntRq = true;
if(dsrParam.equals("01") ||dsrParam.equals("02") ||dsrParam.equals("61") || dsrParam.equals("51") || dsrParam.equals("11") || dsrParam.equals("21"))
	prdSelRq = true;
if(dsrParam.equals("01") || dsrParam.equals("02") || dsrParam.equals("21"))
	prjSelRq = true;


if(dsrParam.equals("01") || dsrParam.equals("61") || dsrParam.equals("02") || dsrParam.equals("12") || dsrParam.equals("13") || dsrParam.equals("22") || dsrParam.equals("23") || dsrParam.equals("04") || dsrParam.equals("05") || dsrParam.equals("50") || dsrParam.equals("41")) // || dsrParam.equals("21") || dsrParam.equals("11") // removed 31-Jan-18
{
	cusSelRq = true;
	
	if(dsrParam.equals("50") || dsrParam.equals("61"))
		cusCodRq = false;
	else
		cusCodRq = true;
}
		cusCodRq = true;

if(deptCode.equals("KKR158"))
	 deptCode = "KKR116";
else if(deptCode.equals("KKR125")) // Key accounts 
	 deptCode = "KKR118";

cusRtlFlStr = WebSessBean.getSqlToOptionStr(sql, cusRtlFl);

//dsrParamStr = WebSessBean.getSqlToOptionStr("select paramCod, paramDes from wcmParametr with (nolock) where paramTyp = 83 and paramCod <> '00000' and paramCod in ('02') ", dsrParam); 
%>

<script type="text/javascript" language="javascript">
var withutLcAl = "N";
var withAlNm = 0;

function getBuildNumb(str) 
{
  var myVar = null;
  myVar = Android.getBuildNumb();
  
  if(myVar < "1.54")
  {
    alert("Dear User Please Update Your Mobile App from Play Store");
//    window.location  = "https://play.google.com/store/apps/details?id=com.bw.sparsh";
    return false;
  }
}

if("<%=mobilApp%>" == "true" && isAndroid.matches)
	getBuildNumb();  


var upldFlNm ;

var hdRowCnt = 1;

function refreshed(currObjt)
{
	//return false;
	if(currObjt == "Y")
	{
		if(document.<%=formName%>.cusRtlCd.value == "")
		{
			alert("Purchaser Code Cannot be blank");
			return false
		}
		if(document.<%=formName%>.cusRtlCd.value.length > 1)
		{
			var cstRtlVl = document.<%=formName%>.cusRtlCd.value.split("~");
			document.<%=formName%>.cusRtlCd.value = cstRtlVl[0];
		var rtnValue = customerValidDsr();
		}
	}
	else
	{
		rtnValue = true;
	}
	if(rtnValue)
	{
		document.<%=formName%>.method = "POST";
		document.<%=formName%>.action = "<%=formName%>.jsp";
		document.<%=formName%>.submit();
	}
}

var hdRowCnt = 1;

function addrow1(currOjct)
{
	addrow(currOjct, "", "", "", "", "");
}

function repoDescPop(numbRows)
{
	var srcFldNm = "repoDesc" + numbRows,
		tgtFldNm = "repoDesc" + numbRows + "Div",
		newCustS = "Y";

	var queryCod = "",
		wherList = "",
		rtnValue = false,
		rqstType = "G";
		queryCod = "MK_01059";

	wherList = whMasAdd(wherList, "Y");
	wherList = whereAdd(wherList, "SW_03", "'T','B'");

	rtnValue = setPrmNew("<%=formName%>", srcFldNm, queryCod, rqstType, "DN", wherList, tgtFldNm);
	if (!rtnValue)
		return false;

	repoDescArr = document.getElementById(tgtFldNm).innerText.split("~~");
	document.getElementById(tgtFldNm).innerText = "";

	$("#repoDesc" + numbRows).autocomplete(
	{
		source: repoDescArr
	});
	return true;

}

function repoDescChng(numbRows)
{
	a = eval("document.<%=formName%>.prodCode" + numbRows).options[eval("document.<%=formName%>.prodCode" + numbRows).selectedIndex].text;
	b = a.split(" : ");

	document.getElementById("catgPkPr" + numbRows).value = b[0];
	document.getElementById("secnPack" + numbRows).value = b[3];
	document.getElementById("secNoTon" + numbRows).value = b[4];
	rtnValue = packSizeChk("document.<%=formName%>.prodQnty" + numbRows, b[3]);

	if(rtnValue)
	{	
		eval("document.<%=formName%>.projQnty" + numbRows).value =   eval("document.<%=formName%>.prodQnty" + numbRows).value / b[4];
		document.getElementById("prdQtMt" + numbRows).innerText =    eval("document.<%=formName%>.prodQnty" + numbRows).value / b[4];
	}
}

function packSizeChk(prodQnty, secnPack)
{
	//alert(eval(prodQnty).value + " . secnPack : " + secnPack)
	var qtyToChk = parseFloat(eval(prodQnty).value)/parseInt(secnPack);
	
//	alert("qtyToChk " + qtyToChk % 1);
	
	if(qtyToChk % 1 > 0)
	{
		alert("Entered " + eval(prodQnty).value + " Bags. Qty is not as per Pack Size.");
		eval(prodQnty).value = "";
		eval(prodQnty).focus();
		return false;
	}
	return true;
}

function repoCtPkDcCHng(numbRows)
{
	a = eval("document.<%=formName%>.prdCodMk" + numbRows).options[eval("document.<%=formName%>.prdCodMk" + numbRows).selectedIndex].text;
	b = a.split(" : ");
	document.getElementById("repoCtPk" + numbRows).value = b[1];
}
function mrktMisPrc_Row(branName, prdCodMk, bPriceVl, cPriceVl)
{
//	alert(branName);
	var numrow1 = getNumRows2();
	var newRow = insertRowBw(document.all.mrktMisPrc);

	var disabFlg = "", 
		docNoStr = "";

	name = "abc1";
	m = insertCellBw(newRow);
	m.innerHTML = "<div class='chkBox'><input type='checkbox' name='" + name + "' value='" + numrow1 + "' onClick='deleter2()'></div>";

	name = "branName" + numrow1;
	m = insertCellBw(newRow);
	m.innerHTML = "<select name='" + name + "' id='" + name + "' class='form-control'><option value='' selected>Select</option><option value='BW'>Birla White</option><option value='JK'>JK</option><option value='AP'>Asian Paint</option><option value='BG'>Berger</option><option value='Ot'>Others</option>";

	name = "prdCodMk" + numrow1;
	m = insertCellBw(newRow); //wcHgstSlStr
	m.innerHTML = "<select name='" + name + "' id='" + name + "' class='form-control' onChange='return repoCtPkDcCHng(" + numrow1 + ")'><%=wcHgstSlStr%></select> ";

	name = "bPriceVl" + numrow1;
	m = insertCellBw(newRow);
	m.innerHTML = "<input type='text'  class='form-control' class='form-control' placeholder='Enter Amount' name='" + name + "' id='" + name + "' value='" + bPriceVl + "' data-mini='true' size='4' maxlength='7' title='in MT'>";
	
	name = "cPriceVl" + numrow1;
	m = insertCellBw(newRow);
	m.innerHTML = "<input type='text'  class='form-control' class='form-control' placeholder='Enter Amount' name='" + name + "' id='" + name + "' value='" + cPriceVl + "' data-mini='true' size='4' maxlength='7' title='in MT'>";
	 
	m.innerHTML += "<input type='hidden' name='srNumMrktMis' value=" + numrow1 + ">";
	m.innerHTML += "<input type='hidden' name='repoCtPk" + numrow1 + "'  id='repoCtPk" + numrow1 + "' value=''>";
	if(branName != "")
	{
		eval("document.<%=formName%>.branName" + numrow1).value = branName;
		eval("document.<%=formName%>.prdCodMk" + numrow1).value = prdCodMk;
		eventFireBw("onchange", eval("document.<%=formName%>.prdCodMk" + numrow1));
	}
}
function addrow(repoCatg, prodCode, prodQnty, projQnty, actnRemk, targetDt)
{
	var numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTable);

	var disabFlg = "", 
		docNoStr = "";

	name = "abc1";
	m = insertCellBw(newRow);
	m.innerHTML = "<div class='chkBox'><input type='checkbox' name='" + name + "' value='" + numrows + "' onClick='deleter1()'></div>";
	m.innerHTML += "<input type='hidden' name='catgPkPr" + numrows + "' id='catgPkPr" + numrows + "' value=''>"; 
	m.innerHTML += "<input type='hidden' name='secnPack" + numrows + "' id='secnPack" + numrows + "' value=''>"; 
	m.innerHTML += "<input type='hidden' name='secNoTon" + numrows + "' id='secNoTon" + numrows + "' value=''>"; 

	name = "repoCatg" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = "<select name='" + name + "' id='" + name + "' value=" + repoCatg + " class='form-control' data-live-search='true' onChange='prodRateGet(true, " + numrows + ")'><%=MrktgSuper.getRepCatgDesc(repoCatg, true)%></select>";

	name = "prodCode" + numrows;
	m = insertCellBw(newRow);	// onChange=\"priceDataDwnld(" + numrows + ")\"						 
	m.innerHTML = "<select name='" + name + "' id='" + name + "' value='" + prodCode + "' onChange='repoDescChng('', " + numrows + ", 'A')' class='form-control' ></select>";

	name = "prodQnty" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = "<input type='tel' onChange='repoDescChng(" + numrows + ")' class='form-control' placeholder='Enter Qty in Bags' name='" + name + "' id='" + name + "' value='" + prodQnty + "' data-mini='true' size='4' maxlength='7' title='in Bags'> <p>Qty in MT : <div id='prdQtMt"  + numrows + "'></div></p>";
	
	name = "projQnty" + numrows;
	m.innerHTML += "<input type='hidden' class='col-12  mx-sm-12s' name='" + name + "' id='" + name + "' value='" + projQnty + "' data-mini='true' size='4' maxlength='7' title='in MT'>";

	m.innerHTML += "<input type='hidden' name='actnRemk" + numrows + "' value=''>";

//		m = insertCellBw(newRow);
	m.innerHTML += "<input type='hidden' name='targetDt" + numrows + "' value=''>";
	m.innerHTML += "<input type='hidden' name='serNumbr' value=" + numrows + ">";

	if("<%=procType%>" == "U")
	{
		eval("document.<%=formName%>.repoCatg" + numrows).value = repoCatg;
		eventFireBw("onchange", eval("document.<%=formName%>.repoCatg" + numrows));
		eval("document.<%=formName%>.prodCode" + numrows).value = prodCode;
		eventFireBw("onchange", eval("document.<%=formName%>.prodQnty" + numrows));
	}
}
function prodRateGet(reinit, varNumRw)
{
	if (document.<%=formName%>.areaCode.value != "")
	{
		var wherList = "", plantCod ="";
			plantCod = "FBW";

	//	wherList = whereAdd(wherList, "SW_01", plantCod);
		wherList = whereAdd(wherList, "SW_03", eval("document.<%=formName%>.repoCatg" + varNumRw).value);	
		rtnValue = sapProdStr('<%=formName%>', 'repoCatg' + varNumRw, 'T', wherList, 'prodCode' + varNumRw, 'DW');
	//	alert(rtnValue);
   }
   else
   {
	   alert("Please select Sales Area");   
   }
   return true;
}
function addrowMrkShr(repoCatgMk, repoDescMk, prodQntyMk, projQntyMk, actnRemkMk, targetDtMk)
{
	var numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTableMekt);

	var disabFlg = "", 
		docNoStr = "";

	if(repoCatgMk != "")
		disabFlg = " disabled ";

		name = "abc2";
		m = insertCellBw(newRow);
		m.innerHTML = "<div class='chkBox'><input type='checkbox' name='" + name + "' value='" + numrows + "' " + disabFlg + "></div>";
		m.innerHTML += "<input type='hidden' name='repoCatgMk" + numrows + "' value='" + repoCatgMk + "'>"; 

		m = insertCellBw(newRow);
		m.innerHTML = repoDescMk; 

		name = "prodQntyMk" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='number'  class='col-12  mx-sm-12' name='" + name + "' id='" + name + "' value='" + prodQntyMk + "' data-mini='true' size='4' maxlength='7' title='in MT'>";


		name = "projQntyMk" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='number' class='col-12  mx-sm-12' name='" + name + "' id='" + name + "' value='" + projQntyMk + "' data-mini='true' size='4' maxlength='7' title='in MT'>";

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='actnRemkMk" + numrows + "' value=''>";

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='targetDtMk" + numrows + "' value=''>";
	
//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='serNumMk' value=" + numrows + ">";
}

function addrowMrkPrv(repoCatgPr, repoDescPr, prodQntyPr, projQntyPr, mrtkDatePr)
{
	var numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTablePrv);

		m = insertCellBw(newRow);
		m.innerHTML = repoDescPr; 

		m = insertCellBw(newRow);
		m.innerHTML = prodQntyPr; 

		m = insertCellBw(newRow);
		m.innerHTML = projQntyPr; 

		m = insertCellBw(newRow);
		m.innerHTML = mrtkDatePr; 
}

function deleter1()
{
	deleterCv("<%=formName%>", "abc1", "prjTable", hdRowCnt);
}
function deleter2()
{
	deleterCv("<%=formName%>", "abc1", "mrktMisPrc", hdRowCnt);
}

$(function()
{

    // Opera 8.0+
    var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;

    // Firefox 1.0+
    var isFirefox = typeof InstallTrigger !== 'undefined';

    // Safari 3.0+ "[object HTMLElementConstructor]" 
    var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || safari.pushNotification);

    // Internet Explorer 6-11
    var isIE = /*@cc_on!@*/false || !!document.documentMode;

    // Edge 20+
    var isEdge = !isIE && !!window.StyleMedia;

    // Chrome 1+
    var isChrome = !!window.chrome && !!window.chrome.webstore;
        // Blink engine detection
	$("#cusRtlFl").change(function()
	{
	//	alert("1");
		document.<%=formName%>.cusRtlCd.value = '';
		custCdRtArr = "";
		cusRtlCdArr = "";
	});

	$("#areaCode").change(function()
	{
	//	alert("1");
		document.<%=formName%>.cusRtlCd.value = '';
		custCdRtArr = "";
		cusRtlCdArr = "";
	});

}); 

function enbDsbl()
{
	if(document.<%=formName%>.pendIsue.value == "Y")
	{
		enableDisable("pndIsuDt", "E", false, true);
		enableDisable("isuDetal", "E", false, true);
	}
	else
	{
		enableDisable("pndIsuDt", "D", false, true);
		enableDisable("isuDetal", "D", false, true);
	}

}
function enabDisb() 
{
	var enabDsFl = "";
	
	if(<%=cusCodRq%>) 
		enabDsFl = "E";
	else
		enabDsFl = "D";

	//alert(enabDsFl);
	//enableDisable("areaCode", enabDsFl, false, true);
	//enableDisable("cusRtlFl", enabDsFl, false, true);
//	enableDisable("docuDate", enabDsFl, false, true);
	readonly("cusRtlCd", enabDsFl, false, true);
	//document.<%=formName%>.cusRtlFl.value = '';
	//document.<%=formName%>.areaCode.value = ''; // To check Value Initialized ni displaying in Front End
	
	$("#cusRtlCd").addClass("");

	if(<%=docuDtRq%>) 
	{
		enabDsFl = "D";
//	alert(1);
	//	document.<%=formName%>.docuDate.value = <%=docuDate%>;
//		enableDisable("docuDate", enabDsFl, false, false);
	}
}


function edValueKeyPressCust() 
{
    var edValue = document.getElementById("cusRtlCd").value.length;
//	alert(edValue);
	if(edValue > 3)
		cusRtlCdHlpget('G');
}

</script>

<form name="<%=formName%>" class="form-horizontal">
<div class="container-fluid">

<%
if(dsrEntAl && dsrStkAl)
{
%>
<div class="row">
	<input type="hidden" size="24" value="<%=sysDateOnly%>" name="sysDateOnly" >
	<input type="hidden" name="deptCode" value="<%=deptCode%>">
	<input type="hidden" name="formName" value="<%=formName%>">
	<input type="hidden" name="pendWith" value="<%=pendWith%>">
	<input type="hidden" name="submMthd" value="">
<%
	if(!cusRtlCd.equals(""))
	{
		sql = "select a.retlCode, a.retlName, a.mobileNo, a.custCode, a.sapRtlCd, "
			+ "isnull(a.locaCapr, 'NA') as locaCapr, isnull(a.latitute, 'NA') as latitute, "
			+ "isnull(a.lgtitute, 'NA') as lgtitute, case when isNull(kycVerFl, 'N') <> 'Y' then 'N' else kycVerFl end as kycVerFl, ISNULL(mrktName, '') "
			+ " From rtmRetailer a with (nolock) "
			+" where isActive = 'Y' "			   
			+" and   retlCode = '" + cusRtlCd + "' "
			+" union all select a.custCode, a.custName, a.mobileNo, a.custCode, a.sapCusCd, "
			+ "isnull(a.locaCapr, 'NA') as locaCapr, isnull(a.latitute, 'NA') as latitute, "
			+ "isnull(a.lgtitute, 'NA') as lgtitute, 'Y' as kycVerFl, ISNULL(mrktName, '') "
			+ " From dpmCustomer a with (nolock) "
			+" where isActive = 'Y' "
			+" and   custCode = '" + cusRtlCd + "'";
		rset = WebSessBean.selectRecord(sql);
		
		if (rset.next())
		{
			cusRtlCd = rset.getString(1);
			cusRtlNm = rset.getString(2);
			mobileNo = rset.getString(3);
			locaCapr = rset.getString(6);
			latitute = rset.getString(7);
			lgtitute = rset.getString(8);
			kycVerFl = rset.getString(9);
			mrktName = rset.getString(10);
		}	

		if(!mrktName.equals(""))
		{
			mktNamUF = "N";
		}

		if(cusRtlFl.equals("R") || cusRtlFl.equals("RR"))	
		{
			sql = "select  isnull(sum(case when mrgRepCt = '01' then salesQty else 0 end), 0)/3 as wc, "
				+" 		isnull(sum(case when mrgRepCt = '02' then salesQty else 0 end), 0)/3 as wcp, "
				+" 		isnull(sum(case when mrgRepCt = '03' then salesQty else 0 end), 0)/3 as vap "
				+" From sbvTlySlsDt with (nolock) "
				+" where retlCode = '" + cusRtlCd + "' "
				+" and rtlInvDt between '01 Jan 2021' and '31 Mar 2021' ";
		}
		else 
		{
			sql =" select isnull(sum(case when mrgRepCt = '01' then invnQnty else 0 end), 0)/3 as wc, "
				+"	   isnull(sum(case when mrgRepCt = '02' then invnQnty else 0 end), 0)/3 as wcp, "
				+"	   isnull(sum(case when mrgRepCt = '03' then invnQnty else 0 end), 0)/3 as vap	"
				+"from dpsCustSlDt a with (nolock), bkmProducts b with (nolock), bkmRepoCatg c with (nolock) "
				+"where  a.prodCode = b.prodCode "
				+"and    b.repoCatg = c.repoCatg "
				+"and    a.invMnTyp = 'NS'		 "
				+"and    a.invDocDt between '01 Mar 2021' and '31 May 2021' "
				+"and    a.custCode = '" + cusRtlCd + "'";
		}	
		rset = WebSessBean.selectRecord(sql);
		
		if (rset.next())
		{
			bwAvgWcc = rset.getString(1);
			bwAvgWcp = rset.getString(2);
			bwAvgVap = rset.getString(3);

			if(bwAvgWcc.equals(""))
				bwAvgWcc = "0.00";
			if(bwAvgWcp.equals(""))
				bwAvgWcp = "0.00";
			if(bwAvgVap.equals(""))
				bwAvgVap = "0.00";
		}
		else
		{
			bwAvgWcc = "0.00";
			bwAvgWcp = "0.00";
			bwAvgVap = "0.00";	
		}

		sql = "select  sum(case when b.mrgRepCt = '01' then stockQty else 0 end) wc01, "
			+ "		sum(case when b.mrgRepCt = '02' then stockQty else 0 end) wc02, "
			+ "		sum(case when b.mrgRepCt = '03' then stockQty else 0 end) wc03 "
			+ "From sbvCustStck a with (nolock), bkmRepoCatg b with (nolock) "
			+ "where   a.repoCatg = b.repoCatg "
			+ "and     a.custCode = '" + cusRtlCd + "'";
		rset = WebSessBean.selectRecord(sql);
		if(rset.next())
		{
			bwStkWcc = rset.getString(1);
			bwStkWcp = rset.getString(2);
			bwStkVap = rset.getString(3);
		}
		else
		{
			bwStkWcc = "0.00";	
			bwStkWcp = "0.00";
			bwStkVap = "0.00";	
		}
	}

if(!mobilApp && (dsrParam.equals("50") || dsrParam.equals("01")))
{
%>
   		<blockquote>
			<span>Dear User:  You can not submit Retailer / Stockiest Visit on Desktop application. Please download Birla white SPARSH Mobile App from Play store .
			</span>
		</blockquote>
<%
}
else
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label >Process Type*</label>
			<div class="card1">
				<label class="check"> 
					<input type="radio" name="procType" id="procType" value="A" onClick="return refreshed('A')"> <span>Add</span> 
				</label>																	   
				<label class="check"> <input type="radio" name="procType" id="procType" onClick="return refreshed('A')" value="U"> <span>Update</span> </label> 
				<label class="check"> <input type="radio" name="procType" id="procType" onClick="return refreshed('A')" value="D"> <span>Delete</span> </label> 
			</div>
		</div>
	</div>			
<%
	if(procType.equals("U") || procType.equals("D"))
	{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="docuNumb" class="select">Document No*</label>
			<select name="docuNumb" class=" selectpicker"  data-live-search="true" id="docuNumb" onchange="return refreshed('A')"><%=WebSessBean.getSqlToOptionStr("select distinct top 30 docuNumb, dbo.wcfParamDes(dsrParam, 'dsrParNw')+ ' ~ ' + docuNumb + ' ~ ' + convert(char(10), docuDate , 103) from dptDSRActvt with (nolock) where docuDate > GETDATE() - 4 and createId = '" + loginIdM + "' and statFlag not in ('C', 'R') and dsrParam in ('04','05') order by docuNumb desc", docuNumb)%></select>
		</div>
	</div>
<%
	}
%>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label >Tele Call/Personal Visit</label>
			<div class="card1">
				<label class="check"> 
					<input type="radio" name="dsrParam" id="dsrParam1" value="04" onClick="distancChk()"> <span>Tele Call</span> 
				</label>																	   
				<label class="check"> <input type="radio" name="dsrParam" id="dsrParam2" value="05" onClick="distancChk()"> <span>Personal Visit</span> </label> 
			</div>
		</div>
	</div>			
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="cusRtlFl"><%=custLabl%>*:</label>	<br>
			<select name="cusRtlFl" id="cusRtlFl" class="" placeholder="<%=custLabl%>" value="<%=cusRtlFl%>"><%=cusRtlFlStr%></select> 
		</div>
	</div>			
	<div class="col-lg-4 col-xs-6 col-sm-4 col-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="areaCode">Area Code*:</label>
			<select name="areaCode"   value="<%=areaCode%>" id="areaCode"><%=WebSessBean.getArDesc(areaCode, true)%></select>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-8">
		<div class="form-group">
			<label class="control-label  float-sm-left">Code*:</label>
			<div class="input-group mb-3">
				<input type="text" name="cusRtlCd" placeholder="Purchaser Code" id="cusRtlCd" size="24" maxlength="8" value="<%=cusRtlCd%>"  onkeyup="edValueKeyPressCust(this.value)" autocomplete='off'   onchange="return refreshed('Y')">
			<div class="input-group-append">
				<input type='button' name='srchcusRtlCd' class="searchBtnApp" onClick = "cusRtlCdHlpLoc('L')" alt="Click for Search"  >
			</div>
			</div>					
		</div>
	</div>
	<input type="hidden" name="mktNamUF" id="mktNamUF" value="<%=mktNamUF%>">
	<script>
		document.<%=formName%>.areaCode.value = "<%=areaCode%>";
		jQuery("#cusRtlCd").change(function () {
			refreshed();
		});

	</script>
	<div id="cusRtlCdDiv" style="display:none"></div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem08">Name</label><br>
			<div class="form-control" id = "cusRtlCdDiv1"><%=cusRtlNm%></div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="docuDate">Report Date*</label>
			<input type="text" readonly="true" style="background:#fff;" name="docuDate" id="docuDate"  class="" size="24" value="<%=docuDate%>" onfocus='showCal("<%=formName%>","docuDate")' onChange="return docuDateChkLoc()" >
			<div id="docuDateDiv"></div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>KYC Status</label>
            <div class="input-group">
			<select name="kycVerFl" id="kycVerFl" class="form-control" disabled><%=WebSessBean.getYesNo(kycVerFl, true)%></select >
			<span></span> 
			<div class="d-inline  ml-4">
				<a type="button" onclick="return openClickWind('/BirlaWhite/Master/Purchaser/<%=cusRtlFl.equals("R") ? "RetailerEntry" : cusRtlFl.equals("RT") ? "SubDistrEntry" : "CustProfileUpdSelf"%>.jsp?procType=U&areaCode=<%=areaCode%>&<%=cusRtlFl.equals("R") || cusRtlFl.equals("RT") ? "retlCode" : "custCode"%>=<%=cusRtlCd%>')" >
				<img src="/Stat/images/editN.png" class="shadow img-fluid " data-toggle='tooltip' data-placement='bottom' title="Click Here for Edit KYC" style="border-radius: 60%;" height="32px" width="35px">
				</a>
			</div>
            </div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>Participation of Display Contest*</label>
        <div class="card1">
			<label class="check"> <input type="radio" name="prtDsCnt" value="Y" id="prtDsCnt" onclick="enbDsbl(this)"> <span>Yes</span> </label>
			<label class="check"> <input type="radio" name="prtDsCnt" value="N" id="prtDsCnt" onclick="enbDsbl(this)"> <span>No</span> </label> 
			<label class="check"> <input type="radio" name="prtDsCnt" value="N" id="prtDsCnt" onclick="enbDsbl(this)"> <span>NA</span> </label> 
	    </div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>Market Name (Location Or Road Name)*</label>
			<input type="text" name="mrktName" id="mrktName" value="<%=mrktName%>" title="Please Enter Correct You can not Edit Next time" <%=mrktName.equals("") ? "" : " disabled"%> placeholder="Market Name">
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6">
		<div class="form-group">
			<label>Any Pending Issues(Yes /No)* </label>
        <div class="card1">
			<label class="check"> <input type="radio" name="pendIsue" value="Y" id="pendIsue" onclick="enbDsbl(this)"> <span>Yes</span> </label>
			<label class="check"> <input type="radio" name="pendIsue" value="N" id="pendIsue" onclick="enbDsbl(this)"> <span>No</span> </label> 
	    </div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6">
		<div class="form-group">
			<label>if Yes, pending issue details*</label>
			<select name="pndIsuDt" id="pndIsuDt" value="<%=pndIsuDt%>" disabled class="form-control"><%=WebSessBean.getSqlToOptionStr("select 'T', 'Token' union all select 'S', 'Scheme' union all select 'P', 'Product' union all select 'O', 'Other' ", pndIsuDt)%></select >
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6">
		<div class="form-group">
			<label>if Yes, Specify Issue</label>
			<input type="text" name="isuDetal" id="isuDetal" value="<%=isuDetal%>" disabled>
		</div>
	</div>
<%
if(procType.equals("U") && !docuNumb.equals(""))
{
	sql = "select  prodQnty, projQnty, prodQtyV "
		+ "from     dptDSRActvtDtl a  with (nolock) "
		+" where    docuNumb = '" + docuNumb + "' "
		+ "and		createId = '" + loginIdM + "' "
		+ "and		mrktData = '01' ";
		rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
		wcErlSlb = rset.getString(1);
		wpErlSlb = rset.getString(2);
		vpErlSlb = rset.getString(3);
	}
	sql = "select   prodQnty, projQnty, prodQtyV "
		+ "from     dptDSRActvtDtl a  with (nolock) "
		+" where    docuNumb = '" + docuNumb + "' "
		+ "and		createId = '" + loginIdM + "' "
		+ "and		mrktData = '02' ";
	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
		bwStkWcc = rset.getString(1);
		bwStkWcp = rset.getString(2);
		bwStkVap = rset.getString(3);
	}
	else
	{
		bwStkWcc = "0.00";	
		bwStkWcp = "0.00";
		bwStkVap = "0.00";	
	}
}
%>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>Enrolment Slab (in MT)*	</label>
			 <div class="row">
					<div class="col-4 mb-1 form-label-group"> 
						<input type="number" name="wcErlSlb" id="wcErlSlb" value="<%=wcErlSlb%>" class="input-field"  tooltip="WC"> 
						<label for="wcErlSlb">WC</label>
					</div>
					<div class="col-4 mb-1 form-label-group"> 
						<input type="number" name="wpErlSlb" id="wpErlSlb" value="<%=wpErlSlb%>" class="input-field"  tooltip="WC"> 
						<label for="wpErlSlb">WCP</label>
					</div>
					<div class="col-4 mb-1 form-label-group"> 
						<input type="number" name="vpErlSlb" id="vpErlSlb" value="<%=vpErlSlb%>" class="input-field"  tooltip="WC"> 
						<label for="vpErlSlb">VAP</label>
					</div>
				</div>
			</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>BW Stocks Availability (in MT)*</label>
			 <div class="row">
					<div class="col-4 mb-1 form-label-group"> 
						<input type="number" name="bwStkWcc" id="bwStkWcc" value="<%=bwStkWcc%>" class="input-field"  tooltip="WC" <%=cusRtlFl.equals("C") || cusRtlFl.equals("RD") ? " disabled" : ""%>> 
						<label for="bwStkWcc">WC</label>
					</div>
					<div class="col-4 mb-1 form-label-group"> 
						<input type="number" name="bwStkWcp" id="bwStkWcp" value="<%=bwStkWcp%>" class="input-field"  tooltip="WC" <%=cusRtlFl.equals("C") || cusRtlFl.equals("RD") ? " disabled" : ""%>> 
						<label for="bwStkWcp">WCP</label>
					</div>
					<div class="col-4 mb-1 form-label-group"> 
						<input type="number" name="bwStkVap" id="bwStkVap" value="<%=bwStkVap%>" class="input-field"  tooltip="WC" <%=cusRtlFl.equals("C") || cusRtlFl.equals("RD") ? " disabled" : ""%>> 
						<label for="bwStkVap">VAP</label>
					</div>
				</div>
			</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12" id="wcIndustry">
		<label>Brands selling - WC(Industry Volume) (in MT)*</label>
        <div class="card1">
			<label class="check"> <input type="checkbox" name="brndSlWc" value="BW"> <span>BW</span> </label>
			<label class="check"> <input type="checkbox" name="brndSlWc" value="JK"> <span>JK</span> </label> 
			<label class="check"> <input type="checkbox" name="brndSlWc" value="RK"> <span>RAK</span> </label> 
			<label class="check"> <input type="checkbox" name="brndSlWc" value="OT"> <span>Other</span> </label> 
	    </div>
		<br>
		<input type="text" name="slWcVlum" value="" Placeholder="WC Industry Volume in (MT)">
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12" id="wcpIndustry">
		<label>Brands selling - WCP(Industry Volume)*</label>
        <div class="card1">
			<label class="check"> <input type="checkbox" name="brndSlWp" value="BW"  onClick="return hgtSlgSkuCp('BW')"> <span>BW</span> </label>
			<label class="check"> <input type="checkbox" name="brndSlWp" value="JK" onClick="return hgtSlgSkuCp('JK')"> <span>JK</span> </label> 
			<label class="check"> <input type="checkbox" name="brndSlWp" value="AP" onClick="return hgtSlgSkuCp('ASIAN')"> <span>Asian Paints</span> </label> 
			<label class="check"> <input type="checkbox" name="brndSlWp" value="BG" onClick="return hgtSlgSkuCp('BERGER')"> <span>Berger</span> </label> 						
			<label class="check"> <input type="checkbox" name="brndSlWp" value="AC" onClick="return hgtSlgSkuCp('Oth')"> <span>Aerocon</span> </label> 
			<label class="check"> <input type="checkbox" name="brndSlWp" value="PM" onClick="return hgtSlgSkuCp('Oth')"> <span>Paint Major</span> </label> 
			<label class="check"> <input type="checkbox" name="brndSlWp" value="OT" onClick="return hgtSlgSkuCp('Oth')"> <span>Any Other</span> </label> 
	    </div>
		<br>
		<input type="text" name="slWpVlum" value="" Placeholder="WCP Industry Volume in (MT)">
	</div>
<%
if(!cusRtlCd.equals(""))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>Last 3 Months Average - BW (in MT)</label>
			 <div class="row">
				<div class="col-4 mb-1 form-label-group"> 
					<input type="text" id="bwAvgWcc" class="input-field" value="<%=WebSessBean.dfFormat(Double.parseDouble(bwAvgWcc), 2, "0.00")%>" tooltip="WC" readonly> 
					<label for="bwAvgWcc">WC</label>
				</div>
				<div class="col-4 mb-1 form-label-group"> 
					<input type="text" id="bwAvgWcp" name="bwAvgWcp" class="input-field" value="<%=WebSessBean.dfFormat(Double.parseDouble(bwAvgWcp), 2, "0.00")%>"  tooltip="WC" readonly> 
					<label for="bwAvgWcp">WCP</label>
				</div>
				<div class="col-4 mb-1 form-label-group"> 
					<input type="text" id="bwAvgVap" name="bwAvgVap" class="input-field" value="<%=WebSessBean.dfFormat(Double.parseDouble(bwAvgVap), 2, "0.00")%>"  tooltip="WC" readonly> 
					<label for="bwAvgVap">VAP</label>
				</div>
			</div>
		</div>
	</div>
<%
}
%>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12" id="lstThrAvg">
		<div class="form-group">
			<label>Last 3 Months Average*</label>
			<table id="lstmntAvg">
				<thead>
					<tr>
						<th></th>
						<th>WC Qty</th>
						<th>WCP Qty</th>
					</tr>
				</thead>
<%
	if(procType.equals("U"))
	{
		sql = "select   case when actnRemk like '% - JK' then 'JK' when actnRemk like '% - Asian' then 'Asian' 	else 'Other' end, case when actnRemk like '% - JK' then 'jk' when actnRemk like '% - Asian' then 'as' 	else 'ot' end, prodQnty, projQnty "
			+ "from     dptDSRActvtDtl a  with (nolock) "
			+" where    docuNumb = '" + docuNumb + "' "
			+ "and		createId = '" + loginIdM + "' "
			+ "and		mrktData = '04' ";
		rset = WebSessBean.selectRecord(sql);
		while(rset.next())
		{
%>
				<tr>
					<td><%=rset.getString(1)%></td>
					<td>
						<input type="text" id="<%=rset.getString(2)%>AvgWcc" name="<%=rset.getString(2)%>AvgWcc" class="input-field" PlaceHolder="WC" value="<%=rset.getString(3)%>"> 
					</td>
					<td>
						<input type="text" name="<%=rset.getString(2)%>AvgWcp" id="<%=rset.getString(2)%>AvgWcp" class="input-field" PlaceHolder="WCP" value="<%=rset.getString(4)%>"> 
					</td>
				</tr>
<%
		}
						
	}
	else
	{
%>
				<tr>
					<td>JK</td>
					<td>
						<input type="text" id="jkAvgWcc" name="jkAvgWcc" class="input-field" PlaceHolder="WC" value="0"> 
					</td>
					<td>
						<input type="text" name="jkAvgWcp" id="jkAvgWcp" class="input-field" PlaceHolder="WCP" value="0"> 
					</td>
				</tr>
				<tr>
					<td>Asian</td>
					<td>
						<input type="text" id="asAvgWcc" name="asAvgWcc" class="input-field" PlaceHolder="WC" value="0"> 
					</td>
					<td>
						<input type="text" name="asAvgWcp" id="asAvgWcp" class="input-field" PlaceHolder="WCP" value="0"> 
					</td>
				</tr>
				<tr>
					<td>Other</td>
					<td>
						<input type="text" id="otAvgWcc" name="otAvgWcc" class="input-field" PlaceHolder="WC" value="0"> 
					</td>
					<td>
						<input type="text" name="otAvgWcp" id="otAvgWcp" class="input-field" PlaceHolder="WCP" value="0"> 
					</td>
				</tr>
<%
	}
%>
			</table>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label>Last Billing date <%=cusRtlFl.equals("R") || cusRtlFl.equals("RR") ? "as per Tally" : ""%></label>
			 <div class="card">
			 <table>
			 	<thead>
					<tr>
						<th>Product</th>
						<th>Date</th>
						<th>Qty.</th>
					</tr>
				</thead>
<%
if(cusRtlFl.equals("R") || cusRtlFl.equals("RR"))	
{
	sql = "select a.mrgRepDs, convert(varchar(11), a.rtlInvDt, 113) as rtlInvDt, sum(salesQty) as salesQty From sbvTlySlsDt a with (nolock), "
		+"( "
		+"	select mrgRepCt, max(rtlInvDt) as rtlInvDt "
		+"	From sbvTlySlsDt with (nolock) "
		+"	where retlCode = '" + cusRtlCd + "' "
		+"	group by mrgRepCt "
		+") b "
		+"where a.mrgRepCt = b.mrgRepCt "
		+"and   a.rtlInvDt = b.rtlInvDt	"
		+"and   retlCode = '" + cusRtlCd + "' "
		+"group by a.mrgRepDs, a.rtlInvDt "
		+"order by a.rtlInvDt desc";
}
else
{
	sql = "select c.mrgRepDs, convert(varchar(11), a.invDocDt, 113) as rtlInvDt, sum(invnQnty) as salesQty  "
		+"from dpsCustSlDt a with (nolock), bkmProducts b with (nolock),  "
		+"	 bkmRepoCatg c with (nolock), "
		+"	 ( "
		+"		select a.custCode, c.mrgRepCt, max(a.invDocDt) as invDocDt "
		+"		from dpsCustSlDt a with (nolock), bkmProducts b with (nolock), bkmRepoCatg c with (nolock) "
		+"		where  a.prodCode = b.prodCode "
		+"		and    b.repoCatg = c.repoCatg and b.isActive= 'Y' "
		+"		and    a.invMnTyp = 'NS' "
		+"		and    a.custCode = '" + cusRtlCd + "' "
		+"		group by a.custCode, mrgRepCt "
		+"	)d "
		+"where  a.prodCode = b.prodCode "
		+"and    b.repoCatg = c.repoCatg "
		+"and    a.custCode = d.custCode "
		+"and    a.invDocDt = d.invDocDt "
		+"and    c.mrgRepCt = d.mrgRepCt and b.isActive= 'Y'  "
		+"group by c.mrgRepDs, convert(varchar(11), a.invDocDt, 113) "
		+"order by convert(varchar(11), a.invDocDt, 113) desc";
}
	rset = WebSessBean.selectRecord(sql);
	
	while (rset.next())
	{
%>
	<tr>
		<td><%=rset.getString(1)%></td>
		<td><%=rset.getString(2)%></td>
		<td><%=rset.getString(3)%></td>
	</tr>
<%
	}
%>
  </table>
  </div>
  </div>
  </div>
	<div class="col-lg-8 col-xs-8 col-sm-6 col-12">
				<label>Order Booked in call/e meet</label> 
				<table class="table table-responsive" id="prjTable">
					<thead>
						<tr>
							<div class='chkBox'><th id="th">Del</th></div>
							<th id="th">Product</th>
							<th id="th">Product (SKU)</th>
							<th id="th">Order Qty. (in Bags)</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
<%
		if (procType.equals("A"))
		{
%>
			<script language="Javascript">
				addrow('02', '', '0', '0', '0', '');
			</script>
<%
		}
		else if(procType.equals("U") && !docuNumb.equals(""))
		{
//			sql = "select a.repoCatg, a.repoDesc,  prodQnty,projQnty, actnRemk, isnull(convert(char(10), targetDt, 103), '') from bkmRepoCatg a with (nolock), dptDSRActvtDtl b with (nolock) where a.isActive = 'Y' and   a.repoCatg = b.repoCatg and   a.repoCatg in ('01', '02', '03', '09', '15') and  docuNumb = '" + docuNumb + "' ";	// and createId = '" + loginIdM + "'" + docuNumb + "
			sql = "select a.repoCatg, b.catgPack,  isnull(prodQnty, 0), isnull(projQnty, 0), isnull(actnRemk, ''), isnull(convert(char(10), targetDt, 103), '') "
				+ "from bkmRepoCatg a with (nolock), dptDSRActvtDtl b  with (nolock) "
				+" where    a.repoCatg = b.repoCatg " 
				+ "and		docuNumb = '" + docuNumb + "' "
				+ "and		b.createId = '" + loginIdM + "' "
				//+ "and      a.repoCatg in ('01', '02', '03', '09','12','15','17','18','19') "
				+ "and		a.isActive = 'Y'  and mrktData = '05' ";
				rset = WebSessBean.selectRecord(sql);
			while(rset.next())
			{
%>			
				<script language="Javascript">
					addrow('<%=rset.getString(1)%>','<%=rset.getString(2)%>','<%=rset.getString(3)%>','<%=rset.getString(4)%>','<%=rset.getString(5)%>','<%=rset.getString(6)%>','0');
				</script>
<%

				recFound = true;
			}
		}

%>
</tbody>
	<div align="center">
		<button name="skAdd" id="skAdd" class="btn-secondary" onClick="addrow1()" type="button">+</button>
	</div>
</table>
</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-12">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="ordExDat">Order Execution date</label>
			<input type="text" name="ordExDat" id="ordExDat" value="<%=ordExDat%>" placeholder="Order Execution date" class="" size="24" value="" onfocus='showCal("<%=formName%>","ordExDat")'>
		</div>
	</div>
	<div class="col-lg-12 col-xs-12 col-sm-6 col-12" id="mrktWcpHgstSlSKU">
		<div class="form-group">
			<label>Market -- WCP (Highest selling SKU)</label>
			<table class="table-responsive" id="mrktMisPrc">
				<thead>
					<tr>
						<td>Del</td>
						<td>Brand</td>
						<td>Product</td>
						<td>Price - B</td>
						<td>Price - C</td>
					</tr>
				</thead>
<%
		if (procType.equals("A"))
		{
%>
			<script language="Javascript">
				mrktMisPrc_Row('', '', '0','0');
			</script>
<%
		}
		else if(procType.equals("U") && !docuNumb.equals(""))
		{
//			sql = "select a.repoCatg, a.repoDesc,  prodQnty,projQnty, actnRemk, isnull(convert(char(10), targetDt, 103), '') from bkmRepoCatg a with (nolock), dptDSRActvtDtl b with (nolock) where a.isActive = 'Y' and   a.repoCatg = b.repoCatg and   a.repoCatg in ('01', '02', '03', '09', '15') and  docuNumb = '" + docuNumb + "' ";	// and createId = '" + loginIdM + "'" + docuNumb + "
			sql = "select isnull(b.repoCatg, ''), isnull(catgPack, '') as catgPack, isnull(prodQnty, 0), isnull(projQnty, 0), isnull(actnRemk, '') "
				+ "from  dptDSRActvtDtl b  with (nolock)  "
				+" where    docuNumb = '" + docuNumb + "' "
				+ "and		b.createId = '" + loginIdM + "' "
				//+ "and      a.repoCatg in ('01', '02', '03', '09','12','15','17','18','19') "
				+ "and		mrktData = '06' ";
				rset = WebSessBean.selectRecord(sql);
			while(rset.next())
			{
%>			
				<script language="Javascript">
				// mrktMisPrc_Row(branName, prdCodMk, bPriceVl, cPriceVl)
					mrktMisPrc_Row('<%=rset.getString(1)%>','<%=rset.getString(2)%>','<%=rset.getString(3)%>','<%=rset.getString(4)%>');
				</script>
<%

				recFound = true;
			}
		}

%>

			</table>
			<div align="center">
				<button name="skAdd" id="skAdd" class="btn-secondary" onClick="mrktMisPrc_Row('', '', '0', '0')" type="button">+</button>
			</div>
		</div>
	</div>
<%
if(mobilApp)
{
%>	

	<div class="col-lg-4 col-xs-6 col-sm-4" id="finlRsltDiv7">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem07">Address</label>
			<input type="text" name="geoLatit" id="geoLatit" value="<%=geoLatit%>" readonly>
			<input type="text" name="geoLongt" id="geoLongt" value="<%=geoLongt%>" readonly>
			<input id="FinlRslt" name="FinlRslt" size="25" class="" type="hidden" value="<%=FinlRslt%>" readonly>
			<input type="text" name="lgtitute" id="lgtitute" value="<%=lgtitute%>" readonly>
			<input type="text" name="latitute" id="latitute" value="<%=latitute%>" readonly>
			<input type="hidden" name="locaCapr" id="locaCapr" value="">
			<input style="display:none;" type="button" value="Get Address" onclick="GetAddress()" />
			<div id="map"></div>
			<div id="current" style="display:none"></div>
		</div>
	</div>

<script>
//  document.getElementById("finlRsltDiv").style.display = "none";
</script>
<%
}
else
{
%>
			<div id="current" style="display:none"></div>
		<input type="hidden" name="geoLatit" id="geoLatit" value="">
		<input type="hidden" name="geoLongt" id="geoLongt" value="">
		<input type="hidden" name="FinlRslt" id="FinlRslt" value="">
		<input type="hidden" name="lgtitute" id="lgtitute" value="">
		<input type="hidden" name="latitute" id="latitute" value="">
		<input type="hidden" name="locaCapr" id="locaCapr" value="">
<%
}
%>

		<input type="hidden" name="dsrExcpA" id="dsrExcpA" value="N">
		<input type="hidden" name="randNmSt" value="<%=randNmSt%>">
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6">
		<div class="form-group">
			<label>Any other Remarks</label>
			<input type="text" name="dsrRem05" id="dsrRem05" value="<%=dsrRem05%>" maxlength="200">
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4 col-6" id="cityNameDiv">
		<div class="form-group">
			<label>Select Reason*</label>
			<select name="cityName" id="cityName" value="<%=cityName%>" class="form-control"><%=WebSessBean.getSqlToOptionStr("select '01', 'Network Issue' union select '02', 'Battery Low' union select '03', 'Mobile Not working'  union select '04', 'Location not capturing'  ", cityName)%></select >
		</div>
	</div>

  <div class="container-fluid" align="center">
	<div class="col-lg-12 col-xs-12 col-sm-12">
<%
//union select '04', 'Other'
if(mobilApp)
{
%>
      <div class="btn-group" role="group" aria-label="Basic example">
        <button type="button" id="saveButnA" onClick="return submitValid('A')" class="m-1 btn btn-light">Add Another Activity</button>
        <button type="button" id="saveButnE" onClick="return submitValid('E')" class="m-1 btn btn-primary">Submit & Exit</button>
        <button type="button" id="saveButnE"  onclick="return initialise()" class="m-1 btn btn-primary">Capture Location</button>
	  </div>

<%
}
else
{
%>
      <div class="btn-group" role="group" aria-label="Basic example">
        <button type="button" id="saveButnA" onClick="return submitValid('A')" class="m-1 btn btn-light">Add Another Activity</button>
        <button type="button" id="saveButnE" onClick="return submitValid('E')" class="m-1 btn btn-primary">Submit & Exit</button>
		<a class="m-1 btn btn-secondary" style='cursor:pointer' onclick = "openClickWind('/BirlaWhite/Reports/General/DSRActvRepSelf.jsp?createId=<%=loginIdM%>&strtDate=<%=strtDate%>&endgDate=<%=sysDateOnly%>&emplName=<%=log.getUserName()%>')">Click to See Submitted Data</a>
	  </div>
<%
}
%>
    </div>
  </div>
<script language="javascript">
enabDisb();
 //mrktMisPrc_Row('', '', '0','0');
function hgtSlgSkuCp(currObjt)
{
	$('#hgstSlg' + currObjt).show();
}
	$('#cityNameDiv').hide();
/*

//$('#hgstSlgBW').hide();
$('#hgstSlgJK').hide();
$('#hgstSlgOth').hide();
$('#hgstSlgASIAN').hide();
$('#hgstSlgBERGER').hide();
*/
</script>
<%
}
}
else
{
	if(rtlTrgFl)
	{
%>
	<blockquote>
		<div class="alert alert-danger" role="alert">
			<font size="3" color="red">
				<strong> Dear User, <br> You are not Aurthorized to Enter DSR Without Entering Retailer Target Entry.
				<br> 
					First You complete 100% retailers target for Cement, VAP & Putty and then submit DSR. 
				<br>	
				<div class="card">
					<table>
						<tr>
							<th>Total Mapped Retailers</th><td><%=ttlMpdRt%></td> <td></td>
						</tr>
						<tr>
							<th>Product</th><td>No Of Retailers Target Entered</td> <td> % (Target Enter Vs Total Mapped)</td>
						</tr>
						<tr class=<%=trgCmtPr < 100 ? "table-danger" : "table-success" %>>
							<th>Cement </th><td><%=targtCmt%></td><td><%=trgCmtPr%></td>
						</tr>
						<tr class=<%=trgPtyPr < 100 ? "table-danger" : "table-success" %>>
							<th>Putty </th><td><%=targtPty%></td>	<td><%=trgPtyPr%></td>
						</tr>
						<tr class=<%=trgVapPr < 100 ? "table-danger" : "table-success" %>>
							<th>VAP </th><td><%=targtVAP%></td><td><%=trgVapPr%></td>
						</tr>
					</table>
				</div>
					<br>	Please <a href="/BirlaWhite/Mobile/RetailerTrgt.jsp">Click Here </a>for  <font size="3" color="black">Enter Retailer Target Entry</font>
					<br>	Please <a href="/BirlaWhite/Reports/MIS/BidVsTrgtSl.jsp?repoType=T">Click Here </a>for  <font size="3" color="black">Enter Retailer Target Download</font>
				</strong>
			</font>
		</div>
	<blockquote> 
<%
	}
	else
	{
%>
	<blockquote>
		<div class="alert alert-danger" role="alert">
			<font size="3" color="red">
				<strong> Dear User, <br> You are not Aurthorized to Enter DSR Without Entering Market MIS Entry And Stockiest Target Entry.<br> First You complete Both entries and then submit DSR. 
					<br>	Please <a href="/BirlaWhite/Mobile/SFAEnt01.jsp">Click Here </a>for Enter Market MIS Entry <font size="3" color="black"><%=dsrEntAl ? "Market MIS Entry Complete" : " Pending"%></font>
					<br>	Please <a href="/BirlaWhite/Mobile/StcktTrgtDt.jsp">Click Here </a>for Enter Stockiest Target Entry <font size="3" color="black"><%=dsrStkAl ? "Market MIS Entry Complete" : " Pending"%></font>
				</strong>
			</font>
			<div >
					<strong>You Belogns to Given Area : <%=areaDesc%>.<br> If there is any wrong mapping Please Contact to Your State Head Or Zonal Head</strong>
			</div>
		</div>
	<blockquote> 
<%
	}
}	
}
catch (Exception e)
{
	throw new Exception("Error while fetching records in " + pageAddress + e.toString() + sql);
}
rset = WebSessBean.closeRset(rset);
%>

<script src="/tmp/geoTag/js/geoPosition.js" type="text/javascript" charset="utf-8"></script>


<script language="javascript">
if("<%=dsrParam%>" != "" || "<%=procType%>" != "" )
{
 	setTimeout(function()
	{
		$('input[name=procType][value=<%=procType%>]').attr('checked', 'checked');
		if("<%=prtDsCnt%>" != "")
			$('input[name=prtDsCnt][value=<%=prtDsCnt%>]').attr('checked', 'checked');

		if("<%=dsrParam%>" != "")
			$('input[name=dsrParam][value=<%=dsrParam%>]').attr('checked', 'checked');
	
		if("<%=pendIsue%>" != "")
			$('input[name=pendIsue][value=<%=pendIsue%>]').attr('checked', 'checked');

		if("<%=procType%>" != "A" )
		{
			var i = 0, j = 0;
			var brndSlWc = "<%=brndSlWc%>";
			var brndSlWcarr = brndSlWc.split(",");
			var brndSlWp = "<%=brndSlWp%>";
			var brndSlWparr = brndSlWp.split(",");
						   //alert(brndSlWcarr[0]);
			for (i = 0; i< brndSlWcarr.length ; i++)
			{
				$('input[name=brndSlWc][value=' + brndSlWcarr[i] + ']').attr('checked', 'checked');
			}
			for (j = 0; j< brndSlWparr.length ; j++)
			{
				$('input[name=brndSlWp][value=' + brndSlWparr[j] + ']').attr('checked', 'checked');
			}

			if(document.<%=formName%>.pendIsue.value == "Y")
			{
				enableDisable("pndIsuDt", "E", false, true);
				enableDisable("isuDetal", "E", false, true);
			}
		}
	}, 500);  
}
//brndSlWc
 var isAndroid =  /Android/.test(navigator.userAgent);

	function  showHideRtl()
	{
		if(document.<%=formName%>.cusRtlFl.value == "R" || document.<%=formName%>.cusRtlFl.value == "RR")
			$("#retlClas").show();
		else
			$("#retlClas").hide();
	}



function MessgView()
{	
	var imgeView="";
	imgeView = "All DIC will have to enter Market MIS at month end then only he would be able to enter DSR for next month.";
//	document.getElementById("myModalLabel" ).innerText = "Important Message";
	imgeView = "/Envr/JSP/AtchFileShow.jsp?docuNumb=&atchNmId=0&filSeqNo=0&attFilTy=00";
	document.getElementById("modeliframe" ).src = imgeView;
}
/**/

function cusRtlCdHlpLoc(rqstType)
{
	var srcFldNm = "cusRtlCd";
	var cusRtlFl = document.<%=formName%>.cusRtlFl;
	var wherList = "";
	var cusTypFl = "";


	if(cusRtlFl.value == "")
	{
		alert("Please select User Type");
		cusRtlFl.value = "";
		cusRtlFl.focus();
		return false;
	}

	if(cusRtlFl.value == "C" || cusRtlFl.value == "D" || cusRtlFl.value == "RD")
	{
		if("<%=deptCode%>" == "KKR118") 
		{
			//wherList = whereAdd(wherList, "SW_28", "BL"); // Bulder Segment
			wherList = whereAdd(wherList, "SW_05", "");
		}
		else
		{
			wherList = whereAdd(wherList, "SW_04", ""); // All Trade Segment
		}

		if(cusRtlFl.value == "C" && "<%=deptCode%>" != "KKR118")
			cusTypFl = "T";
		else if(cusRtlFl.value == "RD")
			cusTypFl = "R";

		custCodeHlp('<%=formName%>', 'areaCode', srcFldNm, rqstType, 'O', cusTypFl, wherList);
	}
	else if(cusRtlFl.value == "R" || cusRtlFl.value == "RR")
	{
		if(cusRtlFl.value == "R")
			wherList = whereAdd(wherList, "SW_06", ""); // Exclude Subdistributor 
		else if(cusRtlFl.value == "RR")
			wherList = whereAdd(wherList, "SW_06", "S"); // Exclude Subdistributor 

		retlCodeHlp('<%=formName%>', srcFldNm, 'areaCode', 'A', rqstType, 'Y', wherList);
	}
	else
	{
		wherList = whereAdd(wherList, "SW_01", "Y");
		//wherList = whereAdd(wherList, "SW_04", "");
		wherList = whereAdd(wherList, "SW_07", document.<%=formName%>.areaCode.value);
		wherList = whereAdd(wherList, "SW_03", cusRtlFl.value);

		dataLook("<%=formName%>", srcFldNm, 'MK_00045', 'L', 'DN', wherList);
	
	}
	return true;
}

var custCdRtArr = "",
	cusRtlCdArr = "";

function cusRtlCdHlpget(rqstType)
{
	if(rqstType == "A")
	{
		var srcFldNm = "custCdRt",
			tgtFldNm = "custCdRtDiv",
			newCustS = "Y";
		if(!(document.<%=formName%>.cusRtlFl.value == "R" || document.<%=formName%>.cusRtlFl.value == "RR"))	
		{
			alert("Nearest Stokiest Code Not require");
			return false;
		}
	}
	else
	{
		var srcFldNm = "cusRtlCd",
			newCustS = "",
			tgtFldNm = "cusRtlCdDiv";
	}

	var wherList = "",
		rtnValue = false,
		rqstType = "G";
		queryCod = "MK_01083";
	var cusRtlFl = document.<%=formName%>.cusRtlFl;

	wherList = whMasAdd(wherList, "Y");

//	wherList = whereAdd(wherList, "SW_04", "AGR");
	wherList = whereAdd(wherList, "SW_04", document.<%=formName%>.areaCode.value);

	if(cusRtlFl.value == "")
	{
		alert("Please select User Type");
		cusRtlFl.value = "";
		cusRtlFl.focus();
		return false;
	}

	if(document.<%=formName%>.areaCode.value == "")
	{
		alert("Please select Area");
		document.<%=formName%>.areaCode.focus();
		return false;
	}

	if(cusRtlFl.value == "C")
	{
		wherList = whereAdd(wherList, "SW_08", "'ST'");
	}
	else if(cusRtlFl.value == "RD")
	{
		wherList = whereAdd(wherList, "SW_08", "'RD'");
	}
	else if(cusRtlFl.value == "AD")
	{
		wherList = whereAdd(wherList, "SW_08", "'AD'");
	}
	else if(cusRtlFl.value == "UR")
	{
		wherList = whereAdd(wherList, "SW_08", "'UR'");
	}
	else if(cusRtlFl.value == "D")
	{
		if(document.<%=formName%>.areaCode.value == "DEL" || document.<%=formName%>.areaCode.value == "CAL")
		{
		//	return true
		}
		else 
		{
			document.<%=formName%>.cusRtlCd.value = "";
			alert("DD Modal not applicable for your Sales Area");
			return false;
		}
		wherList = whereAdd(wherList, "SW_08", "'DD'");
	}
	else if(cusRtlFl.value == "R")
	{
		wherList = whereAdd(wherList, "SW_06", "'R'");
	}
	else if(cusRtlFl.value == "RR")
	{
		wherList = whereAdd(wherList, "SW_07", "'R'");
	}
//	wherList = whereAdd(wherList, "SW_05", "<%=loginIdM%>");
	
//	alert(wherList);
	rtnValue = setPrmNew("<%=formName%>", srcFldNm, queryCod, rqstType, "DN", wherList, tgtFldNm);
	if (!rtnValue)
		return false;
//	alert(rtnValue);
	if(newCustS == "Y")
	{
		custCdRtArr = document.getElementById(tgtFldNm).innerText.split("~~");
		document.getElementById(tgtFldNm).innerText = "";

		$("#custCdRt").autocomplete(
		{
			source: custCdRtArr
		});
	}
	else
	{
		cusRtlCdArr = document.getElementById(tgtFldNm).innerText.split("~~");
		document.getElementById(tgtFldNm).innerText = "";

		$("#cusRtlCd").autocomplete(
		{
			source: cusRtlCdArr
		});
	}
//	cusRtlCdHlpChng(cusRtlCdArr);
	return true;
}
function cusRtlCdHlpChng(currObjc)
{
//	alert(isAndroid.matches);
	var rqstLnth = currObjc.value.split("~");
//	alert(rqstLnth.length);

	if(rqstLnth.length == "1")
	{
//		alert(currObjc.value);
		if(document.<%=formName%>.cusRtlFl.value  == "07" || document.<%=formName%>.cusRtlFl.value  == "08")
		{
		   document.<%=formName%>.cusRtlCd.value = currObjc.value;
		}
		else 
		{

		var wherList = "",
			rtnValue = false,
			rqstType = "G";
			queryCod = "MK_01083";
		var srcFldNm = "cusRtlCd",
			newCustS = "",
			tgtFldNm = "cusRtlCdDiv";
			
			wherList = whMasAdd(wherList, "Y");
			wherList = whereAdd(wherList, "SW_04", document.<%=formName%>.areaCode.value);
			wherList = whereAdd(wherList, "SW_09", currObjc.value);

		var rtnVal01 = setPrmNew('<%=formName%>', srcFldNm, queryCod, rqstType, 'DN', wherList, tgtFldNm);
/*
	wherList = whereAdd(wherList, "@__01", document.<%=formName%>.appRtlCd.value); 
	
	rtnKycFl = setPrmNew('<%=formName%>', document.<%=formName%>.appRtlCd.name, 'MK_01096', 'G', 'DN', wherList, 'rtnKycFlDiv');
		alert(rtnVal01);
*/

		if (!rtnVal01)
			return false;

		custCdRtArr = document.getElementById("cusRtlCdDiv").innerText;
		
		document.getElementById("cusRtlCdDiv").innerText = "";
	///	currObjc	= custCdRtArr;
	//	document.<%=formName%>.cusRtlCd.value = "";
		//	return false;
		document.<%=formName%>.kycVerFl.value = custCdRtArr.split("~")[8];
		document.<%=formName%>.lgtitute.value = custCdRtArr.split("~")[7];
		document.<%=formName%>.latitute.value = custCdRtArr.split("~")[6];
		document.<%=formName%>.locaCapr.value = custCdRtArr.split("~")[5];
		document.getElementById("cusRtlCdDiv").innerText = custCdRtArr.split("~")[1];
		document.<%=formName%>.cusRtlCd.value = custCdRtArr.split("~")[0];
		}
	}
	else
	{
		document.<%=formName%>.lgtitute.value = currObjc.value.split("~")[7];
		document.<%=formName%>.latitute.value = currObjc.value.split("~")[6];
		document.<%=formName%>.locaCapr.value = currObjc.value.split("~")[5];
		document.getElementById("cusRtlCdDiv").innerText = currObjc.value.split("~")[1];
		document.<%=formName%>.cusRtlCd.value = currObjc.value.split("~")[0];
	}

	document.getElementById("cusRtlCdDiv1").innerText = document.getElementById("cusRtlCdDiv").innerText;
	var alValChk = "5";

//	   alert(compareDateNew(document.<%=formName%>.docuDate.value, "17/05/2020"));
	if(compareDateNew( document.<%=formName%>.docuDate.value, "16/05/2020") > 0  && parseInt(withAlNm) <= parseInt(alValChk))
	{
		if(document.getElementById("lgtitute").value != "NA" && isAndroid.matches && document.getElementById("latitute").value != "NA" && document.<%=formName%>.dsrParam.value == "01")
		{
			var distCalc = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");
			if(parseInt(distCalc) < 500)
				return true;
			else
			{
				alert("You are not at Customer`s Shop. Please Go to Purchaser Shop and retry. Your Distance from Purchaser's shop : " + distCalc);
	
				document.getElementById("cusRtlCd").value = "";
				
//				withAlNm += 1;

			//	 alert(withAlNm);
				if(isAndroid.matches)
					getLocation();
				else
					initialise();

				return false;
			}
		}
		else if (document.<%=formName%>.dsrParam.value == "01" && isAndroid.matches)
		{
			alert("Dear User Please capture retailer / Purchaser's Address First Other wise it is not allowing to update DSR Entry.");

			var openUrln = "/BirlaWhite/Mobile/LatLogCusCp.jsp?popupWin=Y&cusRtlCd=" + document.getElementById("cusRtlCd").value + "&areaCode="+document.<%=formName%>.areaCode.value + "&cusRtlFl=" + document.<%=formName%>.cusRtlFl.value;
			//createModal('Purchaser Location Capture', openUrln);
			location.href = openUrln;
			document.getElementById("cusRtlCdDiv").innerText = "";
			document.getElementById("cusRtlCd").value = "";
		}
	}
}
//alert( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent));
function distancChk()
{
	if (document.<%=formName%>.dsrParam.value == "05" && document.<%=formName%>.cusRtlCd.value != "")
	{
		//return true;
	}
	else
	{
		return false;
	}

	withAlNm ++;
	var alValChk = "10";
	//alert(withAlNm);
	if(parseInt(withAlNm) <= parseInt(alValChk))
	{
//		alert("if 1");
		if(document.getElementById("lgtitute").value != "NA" && document.getElementById("latitute").value != "NA" && document.<%=formName%>.dsrParam.value == "05")
		{
			var distCalc = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");
			if(distCalc < 500)
			{
				return true;
			}
			else
			{
				alert("You are not at Customer`s Shop. Please Go to Purchaser Shop and retry. Your Distance from Purchaser's shop : " + distCalc);

			//	document.getElementById("cusRtlCd").value = "";
				
		//				withAlNm += 1;

			//	 alert(withAlNm);
				if(isAndroid.matches)
					getLocation();
				else
					initialise();

				return false;
			}
		}
		else if (document.<%=formName%>.dsrParam.value == "05")
		{
			alert("Dear User Please capture retailer / Purchaser's Address First Other wise it is not allowing to update DSR Entry.");

			var openUrln = "/BirlaWhite/Mobile/LatLogCusCp.jsp?cusRtlCd=<%=cusRtlCd%>&areaCode=" + document.<%=formName%>.areaCode.value + "&cusRtlFl=" + document.<%=formName%>.cusRtlFl.value;
			//createModal('Purchaser Location Capture', openUrln);
			location.href = openUrln;
			//document.getElementById("cusRtlCdDiv").innerText = "";
			//document.getElementById("cusRtlCd").value = "";
			return false;
		}
		/*
		else if (document.<%=formName%>.dsrParam.value == "05")
		{
			alert("Please Enter reason why you are not using Mobile Devices. This Entry goes to approval for your supervisor. Without approving this Entry You cannot fill your attendace. ");
			$('#cityNameDiv').show();
			document.<%=formName%>.dsrExcpA.value = "Y";
			window.clearInterval(myVar);
			return true;
		}
		*/
	}
	else if (document.<%=formName%>.dsrParam.value == "05" && document.getElementById("lgtitute").value == "")
	{
		alert("We have not find location. This DSR Entry should be approved by your supervisor either you not submit attendance also.");
//		alert("2");
		$('#cityNameDiv').show();
		document.<%=formName%>.dsrExcpA.value = "Y";
		if(isAndroid.matches)
			getLocation();
		else
			initialise();
		window.clearInterval(myVar);
		return true;
	}
	else if(document.<%=formName%>.dsrParam.value == "05" && document.getElementById("lgtitute").value != "")
	{
		var distCalc = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");
		if(distCalc < 1000)
		{
			return true;
		}
		else
		{
			alert("You are not at Customer`s Shop. Please Go to Purchaser Shop and retry. Your Distance from Purchaser's shop : " + distCalc);

		//	document.getElementById("cusRtlCd").value = "";
			
	//				withAlNm += 1;

		//	 alert(withAlNm);
			if(isAndroid.matches)
				getLocation();
			else
				initialise();

			return false;
		}
	}
}

function distanceCalDsr(lat1, lon1, lat2, lon2, unit) 
{
	if ((lat1 == lat2) && (lon1 == lon2)) 
	{
		return 0;
	}
	else 
	{
		var radlat1 = Math.PI * lat1/180;
		var radlat2 = Math.PI * lat2/180;
		var theta = lon1-lon2;
		var radtheta = Math.PI * theta/180;
		var dist = "";
			dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
		if (dist > 1) {
			dist = 1;
		}
		dist = Math.acos(dist);
		dist = dist * 180/Math.PI;
		dist = dist * 60 * 1.1515;
		if (unit=="K") { dist = dist * 1.609344 }
		if (unit=="M") { dist = dist * 1.609344 * 1000}
		if (unit=="N") { dist = dist * 0.8684 }
		
		return dist;
	}
}  


function docuDateChkLoc()
{
	if(!isDate(document.<%=formName%>.docuDate, true, "<=today"))
	{
		document.<%=formName%>.docuDate.value = "";
		document.<%=formName%>.docuDate.focus();
		return false;
	}

	var wherList = "";

	wherList = whereAdd(wherList, "@__01", "<%=loginIdM%>"); 
	wherList = whereAdd(wherList, "@__02", dmyTOdmmmy(document.<%=formName%>.docuDate.value)); 
	wherList = whereAdd(wherList, "@__03", "D"); // D for DSR

	var dataRecd = dataLook("<%=formName%>", "docuDate", "MK_02008", 'G', "DN", wherList);
	 

	if(document.getElementById("docuDateDiv").innerText != "OK")
	{
		alert("Please Put Valid DSR Date");
	//	document.<%=formName%>.docuDate.value = "";
		return false;
	}

	return document.getElementById("docuDateDiv").innerText;
}


function customerValidDsr()
{

	if(!textValidApp(document.<%=formName%>.cusRtlFl, '<%=custLabl%> Flag', false))
		return false;
	
	if(!textValidApp(document.<%=formName%>.areaCode, 'Area Code', false))
		return false;

	if(<%=cusCodRq%> && !textValidApp(document.<%=formName%>.cusRtlCd, '<%=custLabl%> Code', false))  
		return false;

	return true;
}


function submitValid(submMthd)
{
	document.<%=formName%>.submMthd.value = submMthd;

	var docuDtMs = docuDateChkLoc();

	if(docuDtMs != "OK")
	{
		displErr(docuDtMs);
		document.<%=formName%>.docuDate.focus();
		return false;
	}

	if(!textValidApp(document.<%=formName%>.dsrParam, 'Activity Type', false))
		return false;
	if(!textValidApp(document.<%=formName%>.procType, 'Process Type', false))
		return false;
	if(!textValidApp(document.<%=formName%>.docuDate, 'Report Date', false))
		return false;
	if(!textValidApp(document.<%=formName%>.cusRtlFl, 'Purchaser / Retailer Type', false))
		return false;
	if(!textValidApp(document.<%=formName%>.areaCode, 'Area Code', false))
		return false;
	if(!textValidApp(document.<%=formName%>.cusRtlCd, 'Purchaser / Retailer Code', false))
		return false;
	if(!textValidApp(document.<%=formName%>.prtDsCnt, 'Participation of Display Contest', false))
		return false;
	if(!textValidApp(document.<%=formName%>.mrktName, 'Market Name', false))
		return false;
	if(!textValidApp(document.<%=formName%>.pendIsue, 'Any Pending Issues(Yes /No) ', false))
		return false;
	if(document.<%=formName%>.pendIsue.value == "Y")
	{
		if(!textValidApp(document.<%=formName%>.pndIsuDt, 'if Yes, pending issue details', false))
			return false;
		if(!textValidApp(document.<%=formName%>.isuDetal, 'if Yes, Specify Issue', false))
			return false;
	}
	if(!textValidApp(document.<%=formName%>.wcErlSlb, 'Enrolment Slab (in MT) WC', false))
		return false;
	if(!textValidApp(document.<%=formName%>.wpErlSlb, 'Enrolment Slab (in MT) WCP', false))
		return false;
	if(!textValidApp(document.<%=formName%>.vpErlSlb, 'Enrolment Slab (in MT) VAP', false))
		return false;

	if (!isNumApp(eval("document.<%=formName%>.wcErlSlb"), "PZ"))
		return false;
	if (!isNumApp(eval("document.<%=formName%>.wpErlSlb"), "PZ"))
		return false;
	if (!isNumApp(eval("document.<%=formName%>.vpErlSlb"), "PZ"))
		return false;

	if(document.<%=formName%>.cusRtlFl.value == "ST" || document.<%=formName%>.cusRtlFl.value == "RD")
	{
		//return true;
	}
	else
	{
		if(!textValidApp(document.<%=formName%>.bwStkWcc, 'BW Stocks Availability (in MT) WC', false))
			return false;
		if(!textValidApp(document.<%=formName%>.bwStkWcp, 'BW Stocks Availability (in MT) WCP', false))
			return false;
		if(!textValidApp(document.<%=formName%>.bwStkVap, 'BW Stocks Availability (in MT) VAP', false))
			return false;
	}
//	if(!textValidApp(document.<%=formName%>.areaCode, 'Area Code', false))
//		return false;
//	if(!textValidApp(document.<%=formName%>.areaCode, 'Area Code', false))
//		return false;
//	if (!isDate(document.<%=formName%>.docuDate, true, "<=today"))
//		return false;


//	alert(rtnValue);
	var msgeText = "";
	if(document.<%=formName%>.dsrExcpA.value == "Y" || (document.<%=formName%>.dsrParam.value == "05" && document.<%=formName%>.geoLatit.value == ""))
	{
		//alert("");
		$('#cityNameDiv').show();
		if(!textValidApp(document.<%=formName%>.cityName, 'Exception Reason', false))
			return false;

		msgeText = "Current DSR Entry exception apporval goes to your supervisor. Still Do you want to submit. Without approving this Entry You cannot fill your attendace.";
	}

	if(document.<%=formName%>.dsrParam.value == "05")
		document.<%=formName%>.ltLgDist.value = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");

  	if (!subValidCom("<%=formName%>"))
		return false;

	displSav(msgeText);
	return false;
}

function frmSubmt(val) // For Common Submit Function 
{
	if (val)
	{
		enbDisAll('AE');
		document.<%=formName%>.method = "POST";
		document.<%=formName%>.action = "DSRActvNewS.jsp"; 
		document.<%=formName%>.submit();
	}
} 

function enbDisAll(currObjt)
{
	if(currObjt == "AE")
	{
		enableDisable("dsrParam1", "E", false, false);
		enableDisable("dsrParam2", "E", false, false);
		enableDisable("procType", "E", false, false);
		enableDisable("cusRtlFl", "E", false, false);
		enableDisable("areaCode", "E", false, false);
		enableDisable("cusRtlCd", "E", false, false);
		enableDisable("docuDate", "E", false, false);
		enableDisable("mrktName", "E", false, false);
		enableDisable("pndIsuDt", "E", false, false);
		enableDisable("isuDetal", "E", false, false);
		enableDisable("bwStkWcc", "E", false, false);
		enableDisable("bwStkWcp", "E", false, false);
		enableDisable("bwStkVap", "E", false, false);
		enableDisable("bwAvgWcc", "E", false, false);
		enableDisable("bwAvgWcp", "E", false, false);
		enableDisable("bwAvgVap", "E", false, false);
	}
	else if(currObjt == "AD")
	{
		enableDisable("dsrParam1", "D", false, false);
		enableDisable("dsrParam2", "D", false, false);
		enableDisable("procType", "D", false, false);
		enableDisable("cusRtlFl", "D", false, false);
		enableDisable("areaCode", "D", false, false);
		enableDisable("cusRtlCd", "D", false, false);
		enableDisable("docuDate", "D", false, false);
		enableDisable("bwAvgWcc", "D", false, false);
		enableDisable("bwAvgWcp", "D", false, false);
		enableDisable("bwAvgVap", "D", false, false);
	}
}
if("<%=procType%>" == "U")
{
	enbDisAll("AD");
}

if(("<%=cusRtlFl%>" == "R" || "<%=cusRtlFl%>" == "RT" || "<%=cusRtlFl%>" == "RR"))
{
	$('#lstThrAvg').show();
	$('#wcpIndustry').show();
	$('#mrktWcpHgstSlSKU').show();
	$('#wcIndustry').show();
}
else
{
	$('#lstThrAvg').hide();
	$('#mrktWcpHgstSlSKU').hide();
	$('#wcpIndustry').hide();
	$('#wcIndustry').hide();
}
var lat, lng, address;

function initiate_geolocation() 
{
	navigator.geolocation.getCurrentPosition(handle_geolocation_query);
}

function handle_geolocation_query(position)
{
	lat = position.coords.latitude;	//To
	document.getElementById("geoLatit").value = lat; 
	lng = position.coords.longitude;
	document.getElementById("geoLongt").value = lng;
}

function GetAddress() 
{
var latlng = new google.maps.LatLng(lat, lng);
var geocoder = geocoder = new google.maps.Geocoder();

geocoder.geocode({ 'latLng': latlng }, function (results, status) 
{
	if (status == google.maps.GeocoderStatus.OK) 
	{
		if (results[1]) 
		{
			address = results[1].formatted_address;
			document.getElementById("FinlRslt").value = address; 
			$("#finlRsltDiv").show();
		}
	}
	else 
	{
		$("#finlRsltDiv").hide();
	//	alert("Geocoder failed due to: " + status + " Please Enable Location");
	}

});
}

if(<%=mobilApp%>  == true)
{
	$(function()
	{
	initiate_geolocation();

	setTimeout(function(){
	  GetAddress();
	}, 3000);

	});	
}

function initMap() 
{
var map = new google.maps.Map(document.getElementById('map'), 
{
  zoom: 15,
  center: {lat: 40.731, lng: -73.997}
});
var geocoder = new google.maps.Geocoder;
var infowindow = new google.maps.InfoWindow;

  (geocoder, map, infowindow);

}
var mylatlng = "";

function getLocation() 
{
	withAlNm = withAlNm + 1;

	var getLocan = Android.trunOnGPSLoca();
	
setTimeout(function()
{
	var AndroidVL = Android.setLatLong();
//	alert(AndroidVL);
	document.getElementById("latlng").value = AndroidVL;

	if(document.getElementById("latlng").value == "")
	{
		initialiseMap();initialise();
	}
	
	var latlng = AndroidVL.split(",");
//	var latlng = "";

	document.getElementById("geoLatit").value =    latlng[0];
	document.getElementById("geoLongt").value = 	latlng[1];

	//	mylatlng = 	{lat: 26.6062318, lng: 73.6853633};
	//	document.getElementById("latlng").value = "26.6062318,73.6853633";
		mylatlng = 	{lat: parseFloat(latlng[0]), lng: parseFloat(latlng[1])};

	var map = new google.maps.Map(document.getElementById("map"), 
	{
		zoom: 18,
//	    center = bounds.getCenter(),

		center: mylatlng
	});
	var geocoder = new google.maps.Geocoder;
	var infowindow = new google.maps.InfoWindow;
	var marker = new google.maps.Marker({position: mylatlng, map: map});
	var infoWindow = new google.maps.InfoWindow(
    //        {content: '', position: mylatlng}
	);
	geocodeLatLng(geocoder, map, infowindow);
        // Configure the click listener.
}, 3000);
}

function getLocationScript() 
{
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } 
  
}

function showPosition(position) 
{
	document.getElementById("latlng").value = position.coords.latitude + "," + position.coords.longitude;
	document.getElementById("geoLatit").value =     position.coords.latitude;
	document.getElementById("geoLongt").value = 	position.coords.longitude;

		mylatlng = 	{lat: position.coords.latitude, lng: position.coords.longitude};

	var map = new google.maps.Map(document.getElementById("map"), 
	{
		zoom: 18,
//	    center = bounds.getCenter(),

		center: mylatlng
	});
	var geocoder = new google.maps.Geocoder;
	var infowindow = new google.maps.InfoWindow;
	var marker = new google.maps.Marker({position: mylatlng, map: map});
	var infoWindow = new google.maps.InfoWindow(
    //        {content: '', position: mylatlng}
	);

		infoWindow.open(map);
				map.addListener('click', function(mapsMouseEvent) 
				{
				  // Close the current InfoWindow.
				  infoWindow.close();

				  // Create a new InfoWindow.
				  infoWindow = new google.maps.InfoWindow({position: mapsMouseEvent.latLng});
				  infoWindow.setContent(mapsMouseEvent.latLng.toString());
				
				  document.getElementById("googleValue").innerHTML = mapsMouseEvent.latLng.toString();
					
				   maulValuAsn(mapsMouseEvent.latLng.toString());

				  infoWindow.open(map);
				});	
		geocodeLatLng(geocoder, map, infowindow);
        // Configure the click listener.             
}

		function initialiseMap()
		{
			/*
			var myOptions = {
			      zoom: 4,
			      mapTypeControl: true,
			     // mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
			      navigationControl: true,
			    //  navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
//			      mapTypeId: google.maps.MapTypeId.ROADMAP      
			    }	
			map = new google.maps.Map(document.getElementById("map"), myOptions);
			*/
		}
		function initialise()
		{
			//alert("1");
			withAlNm = withAlNm + 1;
			if(geoPosition.init())
			{
				document.getElementById('current').innerHTML="Receiving...";
				geoPosition.getCurrentPosition(showPositionNew,function(){document.getElementById('current').innerHTML="Couldn't get location"},{enableHighAccuracy:true});
			}
			else
			{
				document.getElementById('current').innerHTML="Functionality not available";
			}
		}

		function showPositionNew(p)
		{
			var latitude = parseFloat( p.coords.latitude );
			var longitude = parseFloat( p.coords.longitude );
			document.getElementById('current').innerHTML="latitude=" + latitude + " longitude=" + longitude;

			document.getElementById("geoLatit").value = latitude;
			document.getElementById("geoLongt").value = longitude;

			var pos=new google.maps.LatLng( latitude , longitude);
			map.setCenter(pos);
			map.setZoom(14);
			
			var infowindow = new google.maps.InfoWindow({
			    content: "<strong>yes</strong>"
			});

			var marker = new google.maps.Marker({
			    position: pos,
			    map: map,
			    title:"You are here"
			});
			
			displMap();

			google.maps.event.addListener(marker, 'click', function() {
			  infowindow.open(map,marker);
			});
		}

if(isAndroid.matches)
	 getLocation();
else
{
	 initialiseMap();initialise();
}

if("<%=mobilApp%>" == "true")
{
	$(function()
	{
		setTimeout(function()
		{
			if(document.getElementById('geoLatit').value == "" || document.getElementById('geoLongt').value == "") 
				initialiseMap();initialise();
		}, 6000);

	});	
}


function geocodeLatLng(geocoder, map, infowindow) 
{
	var input = document.getElementById('latlng').value;
	var latlngStr = input.split(',', 2);
	var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
	geocoder.geocode({'location': latlng}, function(results, status) 
	{
	  if (status === 'OK') 
	  {
		if (results[0]) 
		{
		  map.setZoom(19);
		  var marker = new google.maps.Marker({
			position: latlng,
			map: map
		  });
		  infowindow.setContent(results[0].formatted_address);
		  infowindow.open(map, marker);
		}
		else 
		{
	//	  window.alert('No results found');
		}
  } 
	else 
	{
//		window.alert('Geocoder failed due to: ' + status);
	}
});
}

</script>

<input type="hidden" name="custName" id="custName" value="<%=custName%>">
<input type="hidden" name="ltLgDist" id="ltLgDist" value="">
<div id="custNameDiv"></div>
</div>

<!-- Form footer Starts --->
<jsp:include page="/Envr/JSP/FooterCom.jsp" flush="true"/>
<!-- Form footer Ends --->
<script>

function locationChk()
{
	setTimeout(function()
	{
		var distCalc = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");
		if(distCalc < 520)
			return true;
		else
		{
			alert("You are not at Customer`s Shop. Please Go to Purchaser Shop and retry. Your Distance from Purchaser's shop : " + distCalc);

			document.getElementById("cusRtlCd").value = "";
			
			if(isAndroid.matches)
				getLocation();
			else
				initialise();

			return false;
		}
	}, 9000);  
}

	document.<%=formName%>.areaCode.value = "<%=areaCode%>";
if("<%=cusRtlCd%>" != "")	
	myVar = setInterval(distancChk, 5000);

</script>
<style>
.card1 {
    background: #fff;
    padding-left: 14px;
    /* margin-bottom: 5px; */
    padding-top: 5px;
}
.card1 {
    z-index: 0;
    border: none;
    border-radius: 0.3rem;
    position: relative;
}
.card1 {

    box-shadow: 0 5px 15px -5px rgb(0 0 0 / 15%);
}

#lstmntAvg .form-control
{
	max-width:80px;
	min-width: 70px !important;
}
	
</style>
