<%@ include file="/Envr/JSP/SecurityCom.jsp"%>

<%
ResultSet rset = null;

/*
http://10.4.64.20/BirlaWhite/Mobile/DSRActv.jsp

ADD EDIT DELETE Button to be Given 

dsrSizAr Text Box Limit Size Array to be Filled with Department Condition

separate 

DSR Changes In DEC 2018

	1.	DSR Open in update Mode with Last Three Days
	2.  Added Search Box in areaCode
	3.  AJAX Dropdown in Purchaser & Retl Code
	4.  New Dept type Added For varun Goyal KKR162
	5.  Added New product 
	6.  Also Capture Area Code during Save page
	7.  Added New Column For cusRtTyp
	8.  Approval Proccess For new VAP Team
	9.  Added Two new Colummn For CASC Name& Mobile No in Site Activity -- Pending


DSR Change 05/09/2019

1.  Market mapping

*/
String  sql = "",
		procType = "A",
		docuNumb = "",
		paramCod = "",
		paramDes = "",
		cusRtlFl = "",
		areaCode = "",
		custCdRt = "",
		cusRtlCd = "",
		randNmSt = "",
		stateGeo = "",
		pinCodeN = "",
		custName = "",
		cstBisTy = "",
		cityName = "",
		FinlRslt = "",
		geoLatit = "",
		geoLongt = "",
		dsrRem09 = "",
		dsrRem01 =  "",
		dsrRem02 =  "",
		dsrRem03 =  "",
		dsrRem04 =  "",
		dsrRem05 =  "",
		dsrRem06 =  "",
		dsrRem07 =  "",
		dsrRem08 =  "",
		docuSrNo =  "",
		repoCatg =  "",
		prodQnty =  "",
		statCode =  "",
		areaDesc =  "",
		cuRtType =  "",
		actnRemk =  "",
		targetDt =  "",
		docuTySt = "",
		zoneCode = "",
		message = "",
		lgtitute = "",
		latitute = "",
		district = "",
		docuType = "",
		docuDate = sysDateOnly, 
		strtDate = "01" + sysDateOnly.substring(2),
		dsrParam = "",
		deptCode = log.deptCodeGet(), // For Department added KKR115	Advertisement 26-Apr-18 
//		deptCode = "KKR116", 
		dsrParamStr = "",
		cusRtlFlStr = "",
		snopFrAl = "",
		custLabl = "Purchaser / Retailer",
		dsrRemAr[] = new String[8],
		dsrSizAr[][] = new String[4][8], // 0 and 1 for Text Area Ht Wd and 2 for S Select List, T for text Box 
		formName = "DSRActv"; 
int i, j, msAreCnt, trAreCnt;
boolean recFound = false,
		actPntRq = false,
		prdSelRq = false,
		cusSelRq = false,
		cusCodRq = false,
		prjSelRq = false,
		pinCdRqA = false,
		dsrEntAl = true,
		dsrStkAl = true,
		rtlTrgFl = false,
		docuDtRq = false;

int		ttlMpdRt = 0,
		ttlMpdUq = 0,
		targtCmt = 0,
		targtPty = 0,
		targtVAP = 0;
Double 	trgCmtPr = 0.00,
		trgPtyPr = 0.00,
		trgVapPr = 0.00;

for(j = 0; j < dsrSizAr[0].length; j++) // common Width for Text Area 
{
	dsrSizAr[0][j] = "2";
	dsrSizAr[1][j] = "35";
	dsrSizAr[2][j] = "T";
	dsrRemAr[j] = "";
}


statCode = log.stateCodGet();

if(siteMktg.equals("S"))
{
		deptCode = UserBean.getDepCode();
//		loginIdM = loginIdn.substring(2,6);
		
		sql = "select stateCod from covLoginMas where loginIdM = '" + loginIdM + "' ";
		rset = KkrSessBean.selectRecord(sql);
//		out.println("sql " + sql);
		if (rset.next())
		{
			statCode = rset.getString(1);
		}
}
else
{
	sql = "select zoneCode from bkmAreaStZn where areaCode = '" + log.getArCode() + "' ";
	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
		zoneCode = rset.getString(1);
	}

	if(zoneCode.equals("A") || zoneCode.equals("B"))
	{
		pinCdRqA = true;
	}
}
	
//	loginIdM = "2961";
	sql = "select  count(distinct a.areaCode), count(distinct b.areaCode) "
		+ "from	bkmAreaMast a with (nolock) left outer join dptMktIntel b with (nolock) on a.areaCode = b.areaCode and		b.mnthYear = dbo.cofPrevMnYr(convert(varchar(6), getdate(), 112),  getdate())  "
		+ "where	a.retlArHd = '" + loginIdM + "' and  a.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXT','EXR','KKR', 'KAT', 'DLC','PNY','BKM','HAM','JAG') and a.isActive = 'Y'  and isnull(a.isOnlyDp,'N') <> 'Y' ";
	rset = WebSessBean.selectRecord(sql);
//	out.println(sql);
	if(rset.next())
	{
		msAreCnt = rset.getInt(1);
		trAreCnt = rset.getInt(2);
//	out.println("msAreCnt : " + msAreCnt + loginIdM);
//	out.println("trAreCnt : " + trAreCnt);
		if(msAreCnt > 0 && msAreCnt != trAreCnt) // && trAreCnt != "0"		  unComment When Lockdown over
		{
			dsrEntAl = false;
		}
	}

//	loginIdM = "2961";
	sql = "select  count(distinct a.areaCode), count(distinct b.areaCode) "
		+ "from	bkmAreaMast a with (nolock) left outer join "
		+ "( "
		+ "		select distinct a.mnthYear, b.areaCode "
		+ "		from dptStkTgtRc a with (nolock), dpmCustomer b with (nolock) "
		+ "		where mnthYear = convert(varchar(6), getdate(), 112) "
		+ "		and   a.custCode  = b.custCode and a.repoCatg = '01' "
		+ ") b "
		+ "on a.areaCode = b.areaCode and		b.mnthYear = convert(varchar(6), getdate(), 112) "
		+ "where	a.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXR','KKR','EXT', 'KAT', 'DLC','HAM','KGR','SHI','SGO','DHU','JAG') "
		+ "and	a.retlArHd = '" + loginIdM + "' and  a.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXR','EXT','KKR', 'KAT', 'DLC','PNY','BKM','HAM','JAG','HAM','KGR','SHI','SGO','DHU','JAG') and a.isActive = 'Y'  and isnull(a.isOnlyDp,'N') <> 'Y' ";
	rset = WebSessBean.selectRecord(sql);

	if(rset.next())
	{
		msAreCnt = rset.getInt(1);
		trAreCnt = rset.getInt(2);

//	out.println("msAreCnt : " + msAreCnt + loginIdM);
//	out.println("trAreCnt : " + trAreCnt);
		if(msAreCnt > 0 && msAreCnt != trAreCnt) // && trAreCnt != "0" --Commented as per Rajendra advise 04-02-2020
			dsrStkAl = false;
	}
	
	if(dsrStkAl)
	{
		sql = "select  count(distinct a.areaCode), count(distinct b.areaCode) "
			+ "from	bkmAreaMast a with (nolock) left outer join "
			+ "( "
			+ "		select distinct a.mnthYear, b.areaCode "
			+ "		from dptStkTgtRc a with (nolock), dpmCustomer b with (nolock) "
			+ "		where mnthYear = convert(varchar(6), getdate(), 112) "
			+ "		and   a.custCode  = b.custCode and a.repoCatg = '02' "
			+ ") b "
			+ "on a.areaCode = b.areaCode and		b.mnthYear = convert(varchar(6), getdate(), 112) "
			+ "where	a.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXR','KKR','EXT', 'KAT', 'DLC','HAM','KGR','SHI','SGO','DHU','JAG') "
			+ "and	a.retlArHd = '" + loginIdM + "' and  a.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXR','EXT','KKR', 'KAT', 'DLC','PNY','BKM','HAM','JAG','HAM','KGR','SHI','SGO','DHU','JAG') and a.isActive = 'Y'  and isnull(a.isOnlyDp,'N') <> 'Y' ";
		rset = WebSessBean.selectRecord(sql);

		if(rset.next())
		{
			msAreCnt = rset.getInt(1);
			trAreCnt = rset.getInt(2);

	//	out.println("msAreCnt : " + msAreCnt + loginIdM);
	//	out.println("trAreCnt : " + trAreCnt);
			if(msAreCnt > 0 && msAreCnt != trAreCnt) // && trAreCnt != "0" --Commented as per Rajendra advise 04-02-2020
				dsrStkAl = false;
		}
	}
	sql = "select AreaDesc from bkmAreaMast with (nolock) where retlArHd = '" + loginIdM + "' and  isActive = 'Y' and isnull(isOnlyDp,'N') <> 'Y' ";
	rset = WebSessBean.selectRecord(sql);

	while(rset.next())
	{
		areaDesc += rset.getString(1) + ", ";
	}

if(zoneCode.equals("C"))
{
	sql = "select  sum(mapedRtlCnt), sum(trgtEntCt), sum(cmt01) as cmt01, sum(cmt02) as cmt02, sum(cmt03) as cmt03, sum(ttlCnt) as ttlCnt, "
		+ "		   dbo.cofCalcPerc('normPerc', sum(cmt01), sum(mapedRtlCnt)) as 'Cmt-%', "
		+ "		   dbo.cofCalcPerc('normPerc', sum(cmt02), sum(mapedRtlCnt)) as 'Puty-%', "
		+ "		   dbo.cofCalcPerc('normPerc', sum(cmt03), sum(mapedRtlCnt)) as 'Vap-%' "
		+ "From  "
		+ "( "
		+ "	select b.loginIdM, b.emplName, count(*)  as mapedRtlCnt, 0 as trgtEntCt, 0 as cmt01,0 as cmt02, 0 as cmt03, 0 as ttlCnt "
		+ "	from rtmRetailer a with (nolock), prmEmployee b with (nolock), bkmAreaStZn c with (nolock) "
		+ "	where a.concEmpl = b.loginIdM "
		+ "	and   b.areaCode = c.areaCode "
		+ "	and   a.isActive = 'Y' and b.position <> 'EM05' "
		+ "	and   b.isActive = 'Y' "
		+ "	and   c.zoneCode = 'C' and   a.createDt < convert(varchar(11), DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE())-1, 0), 113) "
		+ " and   b.loginIdM = '" + loginIdM + "' "
		+ "	group by b.loginIdM, b.emplName "
		+ "	union all "
		+ "	select b.loginIdM, b.emplName, 0, count(distinct a.retlCode) as trgtEntCt,  "
		+ "		   sum(case when repoCatg = '01' then 1 else 0 end) as cmt01, "
		+ "		   sum(case when repoCatg = '02' then 1 else 0 end) as cmt02, "
		+ "		   sum(case when repoCatg = '03' then 1 else 0 end) as cmt03, count(*) as ttlCnt "
		+ "	from rtmRetailer a with (nolock), prmEmployee b with (nolock), bkmAreaStZn c with (nolock), dptCusRtlTg d with (nolock) "
		+ "	where a.concEmpl = b.loginIdM "
		+ "	and   b.areaCode = c.areaCode "
		+ "	and   a.retlCode = d.cusRtlCd and b.position <> 'EM05' "
		+ "	and   d.cusRtlFl = 'R' "
		+ "	and   d.mnthYear = CONVERT(varchar(6), getdate(), 112) "
		+ "	and   d.statFlag not in ('C','R') "
		+ "	and   a.isActive = 'Y' "
		+ "	and   b.isActive = 'Y' "
		+ "	and   c.zoneCode = 'C' "
		+ " and   b.loginIdM = '" + loginIdM + "' "
		+ "	group by b.loginIdM, b.emplName "
		+ ") x "
		+ "where x.loginIdM = '" + loginIdM + "' "
		+ "and   x.loginIdM <> '2603' "
		+ "group by loginIdM, emplName ";
	rset = WebSessBean.selectRecord(sql);
	
	if(rset.next())
	{
		ttlMpdRt = rset.getInt(1);
		ttlMpdUq = rset.getInt(2);
		targtCmt = rset.getInt(3);
		targtPty = rset.getInt(4);
		targtVAP = rset.getInt(5);
		trgCmtPr = rset.getDouble(7);
		trgPtyPr = rset.getDouble(8);
		trgVapPr = rset.getDouble(9);

		if(ttlMpdRt > 0 && (trgCmtPr < 100 || trgPtyPr < 100 || trgVapPr < 100))
		{
			dsrEntAl = false;
			rtlTrgFl = true;
		}
	}
}

/*
	sql = "	select  'SnOP',  nwMtKgLt, count(distinct case when noOfEntry > 0 then areaCode else null end), count(distinct areaCode),  "
		+ "			case when sum(noOfEntry) > 0 then 'Done' else 'Pending' end "
		+ "From  "
		+ "( "
		+ "	selecT  c.stLgcCod, c.retlStHd, a.areaCode, d.nwMtKgLt, count(*) as noOfEntry "
		+ "	From	dptAreaDemd a with (nolock), bkmAreaMast b with (nolock), bkmStateLgc c with (nolock), bkmCatgPack d with (nolock) "
		+ "	where	a.areaCode = b.areaCode "
		+ "	and		b.stLgcCod = c.stLgcCod	"
		+ "	and		a.mnthYear = dbo.cofNextYrMn(convert(varchar(6), getdate(), 112)) "
		+ "	and		a.catPckCd = d.catPckCd "
		+ "	and     a.statFlag not in ('C','R') "
		+ "	group   by c.stLgcCod, c.retlStHd, a.areaCode, d.nwMtKgLt "
		+ "	union all "
		+ "	selecT  c.stLgcCod, c.retlStHd, b.areaCode, d.nwMtKgLt, 0 "
		+ "	From	bkmAreaMast b with (nolock), bkmStateLgc c with (nolock), bkmCatgPack d with (nolock) "
		+ "	where	b.stLgcCod = c.stLgcCod "
		+ "	and     d.isActive = 'Y' "
		+ "	and     b.isActive = 'Y' and  b.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXT','EXR','KKR', 'KAT', 'DLC','PNY','BKM','NAT','KAT','JPF') "
		+ "	and     d.prodCdDs is not null "
		+ "	group   by c.stLgcCod, c.retlStHd, b.areaCode, d.nwMtKgLt "
		+ ")x "
		+ "where retlStHd = '" + loginIdM + "' "
		+ "and   day(getdate()) >= 19 "
		+ "group by stLgcCod,  nwMtKgLt "  ;
	rset = WebSessBean.selectRecord(sql);
//	out.println(sql);
	while(rset.next())
	{
		snopFrAl = rset.getString(5);

		if(snopFrAl.equals("Pending") && dsrEntAl)
		{
			dsrEntAl = false;
			break;
		}
	}
*/
// out.println("dsrStkAl " + dsrStkAl);
dsrStkAl =true;
dsrEntAl =true;

sql = "select '1BF', 'Before' union select '2AF', 'After' union select 'ADH', 'More Image' ";
docuTySt = WebSessBean.getSqlToOptionStr(sql, ""); 

if (XssFilter.parSmGet("deptCode") != null)
	deptCode = XssFilter.parSmGet("deptCode");

if (XssFilter.parSmGet("dsrRem08") != null)
	dsrRem08 = XssFilter.parSmGet("51");

if (XssFilter.parSmGet("cusRtlFl") != null)
	cusRtlFl = XssFilter.parSmGet("cusRtlFl");

if (XssFilter.parSmGet("procType") != null)
	procType = XssFilter.parSmGet("procType");

if (XssFilter.parSmGet("docuNumb") != null)
	docuNumb = XssFilter.parSmGet("docuNumb");

if (XssFilter.parSmGet("cuRtType") != null)
	cuRtType = XssFilter.parSmGet("cuRtType");

if (XssFilter.parSmGet("areaCode") != null)
	areaCode = XssFilter.parSmGet("areaCode");

if (XssFilter.parSmGet("cusRtlCd") != null)
	cusRtlCd = XssFilter.parSmGet("cusRtlCd");

if (XssFilter.parSmGet("dsrParam") != null)
	dsrParam = XssFilter.parSmGet("dsrParam");

if (XssFilter.parSmGet("formName") != null)
	formName = XssFilter.parSmGet("formName");

if (XssFilter.parSmGet("docuDate") != null)
	docuDate = XssFilter.parSmGet("docuDate");

if (XssFilter.parSmGet("message") != null)
	message = XssFilter.parSmGet("message");

if (XssFilter.parSmGet("docuType") != null)
	docuType = XssFilter.parSmGet("docuType");

if(procType.equals("U"))
{
	docuDtRq = true;
}
else if(procType.equals("A"))
{
	docuDtRq = false;
}
%>
 <!-- Header Starts -->
<jsp:include page="/Envr/JSP/HeaderCom.jsp" flush="true">
		<jsp:param name="mobFrend" value="B"/>
</jsp:include>
<!-- Header Ends -->

<%
try
{
	if(!docuNumb.equals("") && procType.equals("U"))
	{
		sql = "select docuNumb, convert(char(10), docuDate , 103), dsrParam, cusRtlFl, cusRtlCd, dsrRem01, dsrRem02, dsrRem03, dsrRem04, dsrRem05, dsrRem06, dsrRem07, dsrRem08, areaCode, isnull(cuRtType, '')  from dptDSRActvt where docuNumb = '" + docuNumb + "'  and createId = '" + loginIdM + "' ";	// and createId = '" + loginIdM + "'
		rset = WebSessBean.selectRecord(sql);
	//	out.println(sql);
		if (rset.next())
		{
			docuNumb = rset.getString(1);
			docuDate = rset.getString(2);
			dsrParam = rset.getString(3);
			cusRtlFl = rset.getString(4);
			cusRtlCd = rset.getString(5);
			dsrRem01 = rset.getString(6);
			dsrRem02 = rset.getString(7);
			dsrRem03 = rset.getString(8);
			dsrRem04 = rset.getString(9);
			dsrRem05 = rset.getString(10);
			dsrRem06 = rset.getString(11);
			dsrRem07 = rset.getString(12);
			dsrRem08 = rset.getString(13);
			areaCode = rset.getString(14);
			cuRtType = rset.getString(15);
		}

		if (cuRtType.equals("RR"))
		{
			cusRtlFl = "RR";			
		}
		if (cuRtType.equals("RD"))
		{
			cusRtlFl = "RD";			
		}

//		out.println("dsrRem01 : " + dsrRem01);
	//	areaCode = docuNumb.substring(3,6);

	//	out.println("areaCode Update " + areaCode);
	}
/*
	Ajax
	if(dsrParam.equals("50") && !dsrRem08.equals("")) 
	{
		sql = "select top 1  a.dsrRem01, a.dsrRem08, a.cuRtType, a.dsrRem03, a.areaCode, a.pinCodeN, a.cityName, a.district, a.cusRtlCd, b.stateCod "
			+ "from dptDSRActvt a with (nolock), bkmAreaStZn b with (nolock)  "
			+ "where a.areaCode = b.areaCode and  a.dsrRem08 = '" + dsrRem08 + "' and  a.areaCode = '" + areaCode + "' and statFlag not in ('C', 'R') order by a.createDt desc ";
		rset = WebSessBean.selectRecord(sql);
		while (rset.next())
		{
			dsrRem01 = rset.getString(1);
			dsrRem08 = rset.getString(2);
			cuRtType = rset.getString(3);
			dsrRem03 = rset.getString(4);
			areaCode = rset.getString(5);
			pinCodeN = rset.getString(6);
			cityName = rset.getString(7);
			district = rset.getString(8);
			custCdRt = rset.getString(9);
			stateGeo = rset.getString(10);
		}
		if (cuRtType.equals("RR"))
		{
			cusRtlFl = "RR";			
		}
		if (cuRtType.equals("RD"))
		{
			cusRtlFl = "RD";			
		}
	}
*/

//dsrParam = "50"; //Hard Code Vaibhav 

sql = "select 'C', 'Stockiest/ Urbon Stockiest' union select 'D', 'Direct Dealer'  union select 'RD', 'Rural Stockiest'  union select 'R', 'Retailer' union select 'RR', 'Rural Retailer'  union select '07', 'Registered Applicator' union select '08', 'Painter' ";
if(dsrParam.equals("52") || dsrParam.equals("13") || dsrParam.equals("23") || dsrParam.equals("41") || dsrParam.equals("50"))
	actPntRq = true;
if(dsrParam.equals("01") ||dsrParam.equals("02") ||dsrParam.equals("61") || dsrParam.equals("51") || dsrParam.equals("11") || dsrParam.equals("21"))
	prdSelRq = true;
if(dsrParam.equals("01") || dsrParam.equals("02") || dsrParam.equals("21"))
	prjSelRq = true;


if(dsrParam.equals("01") || dsrParam.equals("61") || dsrParam.equals("02") || dsrParam.equals("12") || dsrParam.equals("13") || dsrParam.equals("22") || dsrParam.equals("23") || dsrParam.equals("50") || dsrParam.equals("41")) // || dsrParam.equals("21") || dsrParam.equals("11") // removed 31-Jan-18
{
	cusSelRq = true;
	
	if(dsrParam.equals("50") || dsrParam.equals("61"))
		cusCodRq = false;
	else
		cusCodRq = true;
}

if(deptCode.equals("KKR158"))
	 deptCode = "KKR116";
else if(deptCode.equals("KKR125")) // Key accounts 
	 deptCode = "KKR118";

dsrRemAr[0] = "Topic Discussed";			// for KKR158 and KKR116


dsrRemAr[1] = "Ugai Recovery Plans";
dsrRemAr[2] = "Any Purchaser Grievances";
dsrRemAr[3] = "Any Other Points";
dsrRemAr[4] = "";

/*
if(deptCode.equals("KKR115")) // Blank Label required for Ugai Recovery Plans in case of Advt 
	dsrRemAr[1] = "";
*/

// Common Activities
if(dsrParam.equals("41") ) // KKR115 Advt 
{
	dsrRemAr[0] = "Dangler";			
	dsrRemAr[1] = "Posters";
	dsrRemAr[2] = "Stickers";
	
	dsrSizAr[0][0] = "1"; 
	dsrSizAr[1][0] = "25";	
	
	dsrSizAr[0][1] = "1"; 
	dsrSizAr[1][1] = "25";	
	
	dsrSizAr[0][2] = "1"; 
	dsrSizAr[1][2] = "25";

	dsrSizAr[0][3] = "2"; 
	dsrSizAr[1][3] = "40";

	dsrSizAr[0][4] = "2"; 
	dsrSizAr[1][4] = "40";

	dsrSizAr[0][5] = "2"; 
	dsrSizAr[1][5] = "40";

	dsrRemAr[3] = "Feedback";
	dsrRemAr[4] = "Recommendations";
	dsrRemAr[5] = "Insights";
}
else if(dsrParam.equals("60") || dsrParam.equals("55")) // Any Other Activity
{
	dsrRemAr[0] = "Activity Details 1";			
	dsrRemAr[1] = "Activity Details 2";
	dsrRemAr[2] = "Activity Details 3";
	dsrRemAr[3] = "Other Points";
}
else if(dsrParam.equals("50") || dsrParam.equals("61")) // Code not Required
{
	sql = "select 'C', 'Purchaser'  union select 'D', 'Direct Dealer' union select 'RD', 'Rural Stockiest' union select 'R', 'Retailer' union select '3', 'Contractor' union select '7', 'Applicator' union select 'RR', 'Rural Retailer' union select '07', 'Registered Applicator' union select '08', 'Painter' ";

	dsrRemAr[0] = "Party Name";			
	dsrRemAr[1] = "Name and Designation of Person";
	dsrRemAr[2] = "Topics discussed during meeting";
	dsrRemAr[3] = "Any Other Points";
	
	if(deptCode.equals("KKR115"))
	{
		dsrRemAr[4] = "Dangler";			
		dsrRemAr[5] = "Posters";
		dsrRemAr[6] = "Stickers";
	}
	dsrRemAr[7] = "Mobile No";

	dsrSizAr[0][0] = "1"; 
	dsrSizAr[1][0] = "40";	
	
	dsrSizAr[0][1] = "2"; 
	dsrSizAr[1][1] = "40";	
	
	dsrSizAr[0][2] = "2"; 
	dsrSizAr[1][2] = "40";

	dsrSizAr[0][3] = "2"; 
	dsrSizAr[1][3] = "40";

	dsrSizAr[0][4] = "2"; 
	dsrSizAr[1][4] = "40";

	dsrSizAr[0][5] = "2"; 
	dsrSizAr[1][5] = "40";
	dsrSizAr[0][6] = "2"; 
	dsrSizAr[1][6] = "40";
	dsrSizAr[0][7] = "1"; 
	dsrSizAr[1][7] = "40";


}
else if(dsrParam.equals("51")) // Engagement Activities
{
	dsrRemAr[0] = "Type of Activity"; 
	dsrSizAr[2][0] = "S";
	dsrSizAr[3][0] = "Retailer Meet,Rural Retailer Meet,Stockiest Meet,Painter Meet,Architect Meet,Counter Meet,Painter Training Program,Other BTL Activities";
	dsrRemAr[1] = "No of participants"; 
	dsrSizAr[0][1] = "1"; 
	dsrSizAr[1][1] = "4";
	dsrRemAr[2] = "Town in which Activity conducted";
	dsrRemAr[3] = "Learning's from Activity";
	dsrRemAr[4] = "";
}
else if(dsrParam.equals("52")) // Internal Team Meetings / Review Meetings
{
	dsrRemAr[0] = "Meeting Done With"; 
	//dsrSizAr[2][0] = "S";
	dsrRemAr[1] = "Topics discussed during meeting"; 
	dsrRemAr[2] = "";
	dsrRemAr[3] = "";
	dsrRemAr[4] = "";
}
else if(dsrParam.equals("31")) // Visit to Get Check Sampling at Site
{
	dsrRemAr[0] = "Site Name"; 
	dsrSizAr[0][0] = "2"; 
	dsrSizAr[1][0] = "32";
	dsrRemAr[1] = "Product for which Sample is applied"; 
	dsrSizAr[2][1] = "S";
	dsrSizAr[3][1] = "White Cement,Wall Care Putty,Textura,Levelplast,Wall Primer";
	dsrRemAr[2] = "Approx Potentail of Site (MT)";
	dsrSizAr[0][2] = "1"; 
	dsrSizAr[1][2] = "32";
	dsrRemAr[3] = "Applicator Name Who Applied Sample";
	dsrSizAr[0][3] = "2";
	dsrSizAr[1][3] = "32";
	dsrRemAr[4] = "Quality of Sample";
	dsrSizAr[2][4] = "S";
	dsrSizAr[3][4] = "Average,Medium,Good";
	dsrRemAr[5] = "Status of Sample";
	dsrSizAr[2][5] = "S";
	dsrSizAr[3][5] = "Yet to be checked by Purchaser,Approved,Rejected";
	dsrRemAr[6] = "Contact Name";
	dsrSizAr[0][6] = "2";
	dsrSizAr[1][6] = "32";
	dsrRemAr[7] = "Mobile No";
	dsrSizAr[0][7] = "1";
	dsrSizAr[1][7] = "32";
}
else if(dsrParam.equals("53")) // Office Work
{
	dsrRemAr[0] = "Work Related To"; 
	dsrRemAr[1] = "No of Hours Spent"; 
	dsrSizAr[0][1] = "1"; 
	dsrSizAr[1][1] = "4";
	dsrRemAr[2] = "";
	dsrRemAr[3] = "";
	dsrRemAr[4] = "";
}
else if(dsrParam.equals("54")) // Leave
{
	dsrRemAr[0] = "Remarks"; 
	dsrRemAr[1] = ""; 
	dsrRemAr[2] = "";
	dsrRemAr[3] = "";
	dsrRemAr[4] = "";
}
else if(deptCode.equals("KKR118") || dsrParam.equals("12") || dsrParam.equals("13")) // Project 
{
//	// System.out.println("dsrParam : " + dsrParam);
	dsrRemAr[0] = "New Orders Received";
	
	sql = "select 'C', 'Purchaser (Non Trade)' union all select 'AD', 'AUTHORISED DEALER'  ";
	custLabl = "Purchaser ";

/*	
	if(!dsrParam.equals("12") && !dsrParam.equals("13"))
	{
		sql = "select 'C', 'Builder' ";
		custLabl = "Builder";
	}
	else
	{
		custLabl = "Purchaser / Retailer";
	}
*/
	if(dsrParam.equals("11") || dsrParam.equals("12"))
	{
		dsrRemAr[0] = "Site Name"; 
		dsrRemAr[1] = "Contractor Working at Site"; 
		dsrRemAr[2] = "Met With";
		dsrSizAr[2][2] = "S";
		dsrSizAr[3][2] = "Builder,Contractor";
		dsrRemAr[3] = "Name and Designation of Person";
		dsrRemAr[4] = "Topic Discussed";
		dsrRemAr[5] = "Ugai Recovery Plans";
		dsrRemAr[6] = "Any Purchaser Grievances";
		dsrRemAr[7] = "Any Other Point";
	}
}
else if(deptCode.equals("KKR116")) // Retail
{
	if(dsrParam.equals("03"))
	{
		dsrRemAr[0] = "Type of Site"; 
		dsrSizAr[2][0] = "S";
		dsrSizAr[3][0] = "Projects,IHB";
		dsrRemAr[1] = "Potential Of Site (MT)"; 
		dsrSizAr[0][1] = "1"; 
		dsrSizAr[1][1] = "4";
		dsrRemAr[2] = "Construction Stage";
		dsrSizAr[2][2] = "S";
		dsrSizAr[3][2] = "Plinth,Plaster,Brick Work";
		dsrRemAr[3] = "Name of Contractor Working at Site";
		dsrRemAr[4] = "";
	}
}
else if(deptCode.equals("KKR117")) // CASC
{
	if(dsrParam.equals("21") || dsrParam.equals("22") || dsrParam.equals("23") || dsrParam.equals("50"))
	{
		dsrRemAr[0] = "Site Type";
		dsrSizAr[2][0] = "S";
		dsrSizAr[3][0] = "IHB,Project";

		dsrRemAr[1] = "Contractor Working at Site";
		dsrRemAr[2] = "Agenda of Site Visit";
		dsrRemAr[3] = "Action Points from Meeting";

		if(dsrParam.equals("21")) 
		{
			dsrRemAr[4] = "Contact Name";
			dsrRemAr[5] = "Mobile No";
		}
	}
}

// paramAd4 for exclusion dept and paramAd5 for including and paramAd5 '' is common for all
//sql = "select 'C', 'Stockiest' union select 'R', 'Retailer'";
cusRtlFlStr = WebSessBean.getSqlToOptionStr(sql, cusRtlFl);

if(deptCode.equals("KKR115")) // Advt Required
	dsrParamStr = WebSessBean.getSqlToOptionStr("select paramCod, paramDes from wcmParametr with (nolock) where paramTyp = 83 and paramCod <> '00000' and paramCod not in ('31', '51','01','02','04') and (paramCod in ('02') or paramAd5 in ('', '" + deptCode + "'))", dsrParam); 
else if(deptCode.equals("KKR162")) // VAP Team
	dsrParamStr = WebSessBean.getSqlToOptionStr("select paramCod, paramDes from wcmParametr with (nolock) where paramTyp = 83 and paramCod <> '00000' and paramCod not in ('01','02','04') and (paramAd3 in ('" + deptCode + "') or paramAd5 = '')", dsrParam); 
else if(deptCode.equals("KKR166")) // VAP Team
	dsrParamStr = WebSessBean.getSqlToOptionStr("select paramCod, paramDes from wcmParametr with (nolock) where paramTyp = 83 and paramCod <> '00000' and (paramAd4 in ('" + deptCode + "') or paramAd5 in ('', '" + deptCode + "'))  and paramCod not in ('01','02','04') ", dsrParam); //and paramAd4 not in ('" + deptCode + "') and paramAd5 in ('', '" + deptCode + "') 
else
	dsrParamStr = WebSessBean.getSqlToOptionStr("select paramCod, paramDes from wcmParametr with (nolock) where paramTyp = 83 and paramCod <> '00000' and paramAd4 not in ('" + deptCode + "') and paramAd5 in ('', '" + deptCode + "')  and paramCod not in ('01','02','04') ", dsrParam); //and paramAd4 not in ('" + deptCode + "') and paramAd5 in ('', '" + deptCode + "') 
%>

<script type="text/javascript" language="javascript">
if("<%=dsrParam%>" == "04" || "<%=dsrParam%>" == "05")
	location.href = "DSRActvNew.jsp?dsrParam=<%=dsrParam%>&docuDate=<%=docuDate%>";
else if("<%=dsrParam%>" == "06")
	location.href = "DSRActvCasc.jsp?dsrParam=<%=dsrParam%>&docuDate=<%=docuDate%>";

 		var withutLcAl = "N";
		var withAlNm = 0;


function getBuildNumb(str) 
{
  var myVar = null;
  myVar = Android.getBuildNumb();
  
  if(myVar < "1.54")
  {
    displErr("Dear User Please Update Your Mobile App from Play Store");
//    window.location  = "https://play.google.com/store/apps/details?id=com.bw.sparsh";
    return false;
  }
}

if("<%=mobilApp%>" == "true" && isAndroid.matches)
	getBuildNumb();  


var upldFlNm ;

var hdRowCnt = 1;
function addrow1_Img()
{
	addrow_Img("");
}

function addrow_Img(docuDesc) 
{
	var numrows = getNumRows1();
	var newRow = insertRowBw(document.all.imgTable);

	var disabFlg = "";		  // if retailer Code is there then take it instead of areaCode 

	name = "abc1_Img";
	m = insertCellBw(newRow);
	m.innerHTML = "<div class='chkBox'><input type='checkbox' id='box' name='" + name + "' value='" + numrows + "' onClick=\"deleter1_Img()\">  <label for='box'>-</label></div>";

/*	name = "docuType" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = docuDesc;
	m.innerHTML += "<select name='" + name + "' id='" + name + "' value='" + name + "' ><%=docuTySt%></select>"; 
*/
	name = "uplodBtn" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = "<div class=\"btn-group btn-group-sm\" role=\"group\" aria-label=\"Basic example\"> <a name='" + name + "'  id='" + name + "'  class='m-1 btn btn-primary bootpopup col' data-toggle='modal' data-target='#myModal' onClick='photoUpl(" + numrows + ")'>Image Upload</a><a  name='imgPop" + numrows + "'  id='imgPop" + numrows + "'  class='m-1 btn btn-success bootpopup col' data-toggle='modal' data-target='#myModal'  onClick='photView(" + numrows + ")'>View Img</a><button name=\"skAdd\" id=\"skAdd\" class=\"m-1 btn btn-warning\" onClick=\"addrow1_Img()\" type=\"button\"><span class=\"ui-icon ui-icon-plus\"> +</button></div>";
	
//	if(numrows == 1)
//		m.innerHTML += "<button name=\"skAdd\" id=\"skAdd\" class=\"m-1 btn btn-success\" onClick=\"addrow1_Img()\" type=\"button\"><span class=\"ui-icon ui-icon-plus\"></button></div>"

//<button name=\"skDel\" id=\"skDel\" class=\"btn btn-danger\" onClick=\"deleter1_Img()\" type=\"button\"><span class=\"ui-icon ui-icon-minus\"></span></button>

	m.innerHTML += "<input type='hidden' name='upldFlNm" + numrows + "' value=''>";
	m.innerHTML += "<input type='hidden' name='srNumber1' value=" + numrows + ">";
	

//	$( "#uplodBtn" + numrows ).button();

	$("#imgPop" + numrows).on("click",function () 
	{
	//	$("#popup").fadeIn();
		$("#imgPop" + numrows).click();
	});
}

function deleter1_Img()
{
	deleterCv("<%=formName%>", "abc1_Img", "imgTable", hdRowCnt);
}

function refreshed()
{
	if(document.<%=formName%>.dsrParam.value == "50" && document.<%=formName%>.dsrRem08.value != "") 
	{
		if (!mobileValid(document.<%=formName%>.dsrRem08, false))
		{
			document.<%=formName%>.dsrRem08.value = "";
			displErr("Please Enter Proper Mobile Number");
			return false;
		}
	}

	document.<%=formName%>.method = "POST";
	document.<%=formName%>.action = "<%=formName%>.jsp";
	document.<%=formName%>.submit();
}

var hdRowCnt = 1;

function addrow1(currOjct)
{
//	displErr(currOjct);
	if("<%=dsrParam%>" == "01" || "<%=dsrParam%>" == "02" || "<%=dsrParam%>" == "61")
		currOjct = currOjct;
	else
		currOjct = "";

	addrow(currOjct, "", "", "", "", "");
}

function repoDescPop(numbRows)
{
	var srcFldNm = "repoDesc" + numbRows,
		tgtFldNm = "repoDesc" + numbRows + "Div",
		newCustS = "Y";

	var queryCod = "",
		wherList = "",
		rtnValue = false,
		rqstType = "G";
		queryCod = "MK_01059";

	wherList = whMasAdd(wherList, "Y");
	wherList = whereAdd(wherList, "SW_03", "'T','B'");

	rtnValue = setPrmNew("<%=formName%>", srcFldNm, queryCod, rqstType, "DN", wherList, tgtFldNm);
	if (!rtnValue)
		return false;

	repoDescArr = document.getElementById(tgtFldNm).innerText.split("~~");
	document.getElementById(tgtFldNm).innerText = "";

	$("#repoDesc" + numbRows).autocomplete(
	{
		source: repoDescArr
	});
	return true;

}

function repoDescChng(currObjc, numbRows)
{
//	displErr("Hello " + currObjc.value);
	// 020020~Wallcare Putty-Fine - 20 Kg~2~02
	document.getElementById("repoCatg" + numbRows).value = currObjc.value.split("~")[3];
	document.getElementById("repoDesc" + numbRows + "Div").innerText = currObjc.value.split("~")[1];
	document.getElementById("catgPack" + numbRows).value = currObjc.value.split("~")[0];
	document.getElementById("repoDesc" + numbRows).value = currObjc.value.split("~")[0];

}

function addrow(repoCatg, repoDesc, prodQnty, projQnty, actnRemk, targetDt)
{
	var numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTable);

	var disabFlg = "", 
		docNoStr = "";

	if(repoCatg != "")
		disabFlg = " disabled ";

	name = "abc1";
	m = insertCellBw(newRow);
	m.innerHTML = "<div class='chkBox'><input type='checkbox' name='" + name + "' value='" + numrows + "' " + disabFlg + "></div>";
	m.innerHTML += "<input type='hidden' name='repoCatg" + numrows + "' id='repoCatg" + numrows + "' value='" + repoCatg + "'>"; 
	m.innerHTML += "<input type='hidden' name='catgPack" + numrows + "' id='catgPack" + numrows + "' value=''>"; 

	if(repoCatg != "")
	{
/*
		m = insertCellBw(newRow);
		m.innerHTML = repoDesc; 
*/
		name = "repoDesc" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='text' class='col-12  mx-sm-12' name='" + name + "' id='" + name + "' size='10' value='" + repoDesc + "' onClick=\"return repoDescPop('" + numrows + "')\"  onFocusout=\"return repoDescChng(this, '" + numrows + "')\"><div id='repoDesc" + numrows + "Div'></div>"; 

		name = "prodQnty" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='number'  class='col-12  mx-sm-12'  name='" + name + "' id='" + name + "' value='" + prodQnty + "' data-mini='true' size='4' maxlength='7' title='in MT'>";

		name = "projQnty" + numrows;
		m = insertCellBw(newRow);
//		m.innerHTML = "<input type='number' class='col-6  mx-sm-3' name='" + name + "' id='" + name + "' value='" + projQnty + "' data-mini='true' size='4' maxlength='7' title='in MT'>";

		if(<%=prjSelRq%>)
		{
			m.innerHTML = "<input type='number' class='col-12  mx-sm-12s' name='" + name + "' id='" + name + "' value='" + projQnty + "' data-mini='true' size='4' maxlength='7' title='in MT'>";
		}
		else
		{
			m.innerHTML += "<input type='hidden' name='" + name + "' value='0'>";
		}

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='actnRemk" + numrows + "' value=''>";

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='targetDt" + numrows + "' value=''>";
	}
	else
	{
		name = "actnRemk" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<textarea name = '" + name + "' id = '" + name + "' rows='2' cols='30' onChange='return textValidLApp(this, \"Action remark\", 100)'  >" + actnRemk + "</textarea>"; 

		name = "targetDt" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='text' name='" + name + "' id='" + name + "' size='10' value='" + targetDt + "'  onClick='showCal(\"<%=formName%>\", \"" + name + "\")'>"; 
		
//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='prodQnty" + numrows + "' value='0'>";

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='projQnty" + numrows + "' value='0'>";
	}
//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='serNumbr' value=" + numrows + ">";
		addClassCmn();
}

function addrowMrkShr(repoCatgMk, repoDescMk, prodQntyMk, projQntyMk, actnRemkMk, targetDtMk)
{
	var numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTableMekt);

	var disabFlg = "", 
		docNoStr = "";

	if(repoCatgMk != "")
		disabFlg = " disabled ";

		name = "abc2";
		m = insertCellBw(newRow);
		m.innerHTML = "<div class='chkBox'><input type='checkbox' name='" + name + "' value='" + numrows + "' " + disabFlg + "></div>";
		m.innerHTML += "<input type='hidden' name='repoCatgMk" + numrows + "' value='" + repoCatgMk + "'>"; 

		m = insertCellBw(newRow);
		m.innerHTML = repoDescMk; 

		name = "prodQntyMk" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='number'  class='col-12  mx-sm-12' name='" + name + "' id='" + name + "' value='" + prodQntyMk + "' data-mini='true' size='4' maxlength='7' title='in MT'>";


		name = "projQntyMk" + numrows;
		m = insertCellBw(newRow);
		m.innerHTML = "<input type='number' class='col-12  mx-sm-12' name='" + name + "' id='" + name + "' value='" + projQntyMk + "' data-mini='true' size='4' maxlength='7' title='in MT'>";

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='actnRemkMk" + numrows + "' value=''>";

//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='targetDtMk" + numrows + "' value=''>";
	
//		m = insertCellBw(newRow);
		m.innerHTML += "<input type='hidden' name='serNumMk' value=" + numrows + ">";
}

function addrowMrkPrv(repoCatgPr, repoDescPr, prodQntyPr, projQntyPr, mrtkDatePr)
{
	var numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTablePrv);

		m = insertCellBw(newRow);
		m.innerHTML = repoDescPr; 

		m = insertCellBw(newRow);
		m.innerHTML = prodQntyPr; 

		m = insertCellBw(newRow);
		m.innerHTML = projQntyPr; 

		m = insertCellBw(newRow);
		m.innerHTML = mrtkDatePr; 
}

function deleter1()
{
	deleterCv("<%=formName%>", "abc1", "prjTable", hdRowCnt);
}

$(function()
{

    // Opera 8.0+
    var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;

    // Firefox 1.0+
    var isFirefox = typeof InstallTrigger !== 'undefined';

    // Safari 3.0+ "[object HTMLElementConstructor]" 
    var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || safari.pushNotification);

    // Internet Explorer 6-11
    var isIE = /*@cc_on!@*/false || !!document.documentMode;

    // Edge 20+
    var isEdge = !isIE && !!window.StyleMedia;

    // Chrome 1+
    var isChrome = !!window.chrome && !!window.chrome.webstore;
        // Blink engine detection
	$("#cusRtlFl").change(function()
	{
	//	displErr("1");
		document.<%=formName%>.cusRtlCd.value = '';
		custCdRtArr = "";
		cusRtlCdArr = "";
	});

	$("#areaCode").change(function()
	{
	//	displErr("1");
		document.<%=formName%>.cusRtlCd.value = '';
		custCdRtArr = "";
		cusRtlCdArr = "";
	});

}); 

function enabDisb() 
{
	var enabDsFl = "";
	
	if(<%=cusCodRq%>) 
		enabDsFl = "E";
	else
		enabDsFl = "D";

	//displErr(enabDsFl);
	//enableDisable("areaCode", enabDsFl, false, true);
	//enableDisable("cusRtlFl", enabDsFl, false, true);
//	enableDisable("docuDate", enabDsFl, false, true);
	readonly("cusRtlCd", enabDsFl, false, true);
	//document.<%=formName%>.cusRtlFl.value = '';
	//document.<%=formName%>.areaCode.value = ''; // To check Value Initialized ni displaying in Front End
	
	$("#cusRtlCd").addClass("");

	if(<%=docuDtRq%>) 
	{
		enabDsFl = "D";
//	displErr(1);
	//	document.<%=formName%>.docuDate.value = <%=docuDate%>;
//		enableDisable("docuDate", enabDsFl, false, false);
	}
}

function edValueKeyPress() 
{
    var edValue = document.getElementById("pinCodeN").value.length;
//	displErr(edValue);
/* 
  	if(edValue <= 3)
	{
		$( "#pinCodeN" ).autocomplete(
		{ 
			source: ""
		});

	}
*/
	if(edValue > 3)
		fillPinLoc1();
}

function edValueKeyPressCust() 
{
    var edValue = document.getElementById("cusRtlCd").value.length;
//	displErr(edValue);
	if(edValue > 3)
		cusRtlCdHlpget('G');
}

function pinExpoZ() 
{
	if(<%=pinCdRqA%>)
		fillPinLoc1();
}

var autoCmplt = "";
var tags = "";
var valuArry = "";
var n = "";

function fillPinLoc1()
{
	//statCode
	var srcFldNm = "pinCodeN",
		rtnValue = false,
		tgtFldNm = "pinCodeNDiv";

	var queryCod = "",
		wherList = "",
		rqstType = "G";

		queryCod = "MK_00005";
		wherList = whereAdd(wherList, "SW_01", "Y");
	
	    var edValue = document.getElementById("pinCodeN").value;

//		wherList = whereAdd(wherList, 'SW_02', "JODHPUR"); // For Development
	//	displErr(document.<%=formName%>.areaCode.value);
		if(document.<%=formName%>.areaCode.value == "EXE")
			var areaCode = "EXN";
		else
			var areaCode = document.<%=formName%>.areaCode.value;

		wherList = whereAdd(wherList, "SW_05", edValue);

		if(<%=pinCdRqA%>)
			wherList = whereAdd(wherList, "SW_04", areaCode);
//		else
//			wherList = whereAdd(wherList, "SW_06", "<%=statCode%>");
//		wherList = whereAdd(wherList, "SW_05", document.<%=formName%>.pinCodeN.value);
	
//	if(("<%=dsrParam%>" != "50") || ("<%=dsrParam%>" != "61"))
//		return false

//	displErr(wherList);
	rtnValue = setPrmNew("<%=formName%>", srcFldNm, queryCod, rqstType, "DN", wherList, tgtFldNm);
	
//	displErr(rtnValue);
	if (!rtnValue)
	return false;
	
	var pageDetlArr = document.getElementById(tgtFldNm).innerText.split("~~");
	
//	displErr(pageDetlArr.split("~~").length);
	/*
	tags = (pageDetlArr.replace(/~~/g, '", "')).replace(/~/g, ' : ').split(",");;
	
	valuArry = pageDetlArr.split("~~");

	n = valuArry.length; //length of datalist tags     
	*/
	document.getElementById(tgtFldNm).innerText = "";


	$("#pinCodeN").autocomplete(
	{
		source: pageDetlArr
	});
	return true;
/**/
}

function retnMobData()
{
	if(document.<%=formName%>.areaCode.value == "")
	{
		displErr("Please Select Area");
		document.<%=formName%>.dsrRem08.value = "";
		return false;
	}
	if(document.<%=formName%>.dsrRem08.value == "")
	{
		displErr("Please Select Mobile");
		return false;
	}
	var srcFldNm = "dsrRem08",
		rtnValue = false,
		tgtFldNm = "dsrRem08Div";

	var queryCod = "",
		wherList = "",
		rqstType = "G";

	var objcName = document.<%=formName%>.dsrRem08;
	var	objValue = eval(objcName).value;
	if(!mobileVlNo(objValue))
	{
		displErr("Please Enter valid Mobile No");
		eval(objcName).value = "";
		eval(objcName).focus();
		return false;
	}
	if(objValue == "9999999999" || objValue == "0000000000" || objValue == "9876543210")
	{
		displErr("Invalid Mobile No. Please Enter valid Mobile No");
		eval(objcName).value = "";
		eval(objcName).focus();
		return false;
	}
	if(!isEmpty(objValue))
	{
		document.getElementById(tgtFldNm).innerHTML =  "";
		var wherList = "";
		wherList = whereAdd(wherList, "@__01", objValue);
		wherList = whereAdd(wherList, "@__02", "");
		var dataRecvd = setPrmNew("<%=formName%>", "dsrRem08", "MK_00092", "G", "DN", wherList, tgtFldNm);
		if (dataRecvd)
		{
			var tgtFldTx = document.getElementById(tgtFldNm).innerText;
			if(tgtFldTx != "")
			{
				var brkUpArr = tgtFldTx.split(splitChr);

				document.getElementById(tgtFldNm).innerText = objValue + " Mobile No already registered with Code " + brkUpArr[0] + "-" + brkUpArr[1];
				displErr(document.getElementById(tgtFldNm).innerText + ". Please use personal Visit Option for selected Mobile No.");
				document.<%=formName%>.dsrRem08.value = "";
				document.<%=formName%>.dsrRem08.focus();
				//$("#mobileNoDivdisp").show();
				return false;
			}
		}
		else
		{
			document.<%=formName%>.mobileNo.value = objValue;
			document.getElementById(tgtFldNm).innerHTML =  "";
		}
	}
		var dsrRem08 = document.<%=formName%>.dsrRem08.value;
		queryCod = "MK_01106";
//		wherList = whereAdd(wherList, "SW_01", "Y");
	


		wherList = whereAdd(wherList, "SW_01", document.<%=formName%>.dsrRem08.value);
		wherList = whereAdd(wherList, "SW_02", document.<%=formName%>.areaCode.value);
	
		rtnValue = setPrmNew("<%=formName%>", srcFldNm, queryCod, rqstType, "DN", wherList, tgtFldNm);
	
	//displErr(rtnValue);
	if (rtnValue)
	{

		var pageDetlArr = document.getElementById(tgtFldNm).innerText.split("~");
		
//		displErr(pageDetlArr);

			document.<%=formName%>.dsrRem01.value = pageDetlArr[0];
			document.<%=formName%>.dsrRem08.value = pageDetlArr[1];
	//		"<%=cuRtType%>" = pageDetlArr[2];
			var cuRtType  = pageDetlArr[2];
			document.<%=formName%>.areaCode.value = pageDetlArr[3];
			document.<%=formName%>.pinCodeN.value = pageDetlArr[4];
			document.<%=formName%>.cityName.value = pageDetlArr[5];
			document.<%=formName%>.district.value = pageDetlArr[6];
			document.<%=formName%>.custCdRt.value = pageDetlArr[7];
		//	document.<%=formName%>.dsrRem03.value = pageDetlArr[8];

			document.getElementById("dsrRem03Div").innerText = "Last Time Topic Discussed : " + pageDetlArr[8];
			
			if (cuRtType == "RR")
			{
				document.<%=formName%>.cusRtlFl.value = "RR";			
			}
			if (cuRtType == "RD")
			{
				document.<%=formName%>.cusRtlFl.value = "RD";			
			}
		
		document.getElementById(tgtFldNm).innerText = "";
	}
	else
	{
		document.<%=formName%>.dsrRem08.value = dsrRem08;
		document.getElementById(tgtFldNm).innerText = "";
		return true;
	}
	return true;
}

function PinCodeGet(value) 
{ 
	if(document.<%=formName%>.areaCode.value == "")
	{
		displErr("Please Select Area");
		document.<%=formName%>.pinCodeN.value = "";
		return false;
	}

//	displErr(valuArry[0])
//	document.getElementById('datalist').innerHTML = ''; 
	
	l=value.length; 

	if(l <= 3)
	{
		$( "#pinCodeN" ).autocomplete(
		{ 
			source: ""
		});

		return false;
	}

	$( "#pinCodeN" ).autocomplete({ 
		source: valuArry,
		select: function (event, ui) 
		{
		//	var index = availableTags.indexOf(ui.item.value);
		//	$("#tags_code").val(availableTagsCode[index]);  
		}
	});

/*		for (var i = 0; i<n; i++) 
		{ 
			if(((valuArry[i].toLowerCase()).indexOf(value.toLowerCase()))>-1) 
			{ 
				var node = document.createElement("option"); 
				var val = document.createTextNode(valuArry[i]); 
				
				node.appendChild(val); 
				document.getElementById("datalist").appendChild(node); 
			} 
		 }
	}
*/
} 

/*
*/
function pinCodeChng(currObjc)
{
//	displErr(document.<%=formName%>.pinCodeN.value);
//	displErr(currObjc.value);
	var currValu = currObjc.value.split("~");
	
//	displErr(currValu.length);

	if(currValu.length <= 1)
	{
		displErr("Please Enter Valid Pin Code No");
		document.<%=formName%>.pinCodeN.value = "";
		document.<%=formName%>.cityName.value = "";
		document.<%=formName%>.district.value = "";
		return false;
	}

	document.<%=formName%>.pinCodeN.value = currValu[0];
	document.<%=formName%>.cityName.value = currValu[1];
	document.<%=formName%>.district.value = currValu[2];
}

$(document).ready(function(e) 
{
    $('.bootpopup').click(function()
	{
		var frametarget = $(this).attr('href');
		targetmodal = '#myModal'; 
        $('#modeliframe').attr("src", frametarget );   
	});
});
</script>
<style>
.modal-header {
    background-color: #C49F0F;
    padding:9px 15px;
    color:#FFF;
    font-family:Verdana, sans-serif;
    border-bottom:1px solid #eee;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
 }
</style>
<form name="<%=formName%>" class="form-horizontal">
<div class="container-fluid">

<div id="accordion" class="accordion" role="tablist">
    <div class="" role="tab" id="headingTwo">
		<div  class="acorLink" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
			<h3>Instructions</h3><ion-icon name="chevron-down"></ion-icon>
		</div>
    </div>
    <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo">
      <div class="card-body">
			<div class="grey-border fontsize14px">
					<blockquote>
							 <ul>
							 <li>
							<font size="3" color="red">
								<strong> * Dear User, Given Below Two Activity Type For Rural Type Retailer And Stockiest</strong>
							</font>
							</li>
							<li>
							<font size="3" color="red"><strong> * Visit to Stockiest(Trade Purchaser) / Retailer</strong></font>
							</li>
<%
if(dsrParam.equals("50") || dsrParam.equals("61"))
{
%>
							<li>
								<font size="3" color="red">
									<strong> * Meeting with New Purchaser(Trade Purchaser) / Retailer : Please Must be Add Mobile No otherwise it is not consider in new Retailer Visit Count in report(For Unique Visit We require Mobile No)</strong>
								</font>
							</li>
							<li>
							<font size="3" color="red">
								<strong> * Dear User : Please Do not use existing retailers Mobile Number other wise it is not cosider in new retailer.</strong>
							</font>
							</li>

<%							 
}
%>
					</ul>
					</blockquote>
			</div>
      </div>
    </div>
  </div>
<%
if(dsrEntAl && dsrStkAl)
{
%>
<div class="row">
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="procType">Process Type</label>
			<select name="procType" id="procType" class="" onchange="return refreshed()"><%=WebSessBean.getSqlToOptionStr("select 'A', 'Add' union Select 'U', 'Update'", procType)%></select>
		</div>
	</div>
<%
if(procType.equals("U"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="docuNumb" class="select">Document No</label>
	<!--and createId = '" + loginIdM + "'-->
		<select name="docuNumb" class=" selectpicker"  data-live-search="true" id="docuNumb" onchange="return refreshed()"><%=WebSessBean.getSqlToOptionStr("select distinct top 30 docuNumb, dbo.wcfParamDes(dsrParam, 'dsrParNw')+ ' ~ ' + docuNumb + ' ~ ' + convert(char(10), docuDate , 103) from dptDSRActvt where docuDate > GETDATE() - 4 and createId = '" + loginIdM + "' order by docuNumb desc", docuNumb)%></select>
		</div>
	</div>
<%
}
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="createDt">Submission Date</label>
			<input type="text" class="" size="24" value="<%=sysDateOnly%>" name="sysDateOnly" Readonly>
			<input type="hidden" name="deptCode" value="<%=deptCode%>">
			<input type="hidden" name="formName" value="<%=formName%>">
			<input type="hidden" name="submMthd" value="">
		</div>
	</div>
<script type="text/javascript">

</script>

	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="docuDate">Report Date</label>
			<input type="text" readonly="true" style="background:#fff;" name="docuDate" id="docuDate"  class="" size="24" value="<%=docuDate%>" onfocus='showCal("<%=formName%>","docuDate")' onblur="return docuDateChkLoc()" >
			<div id="docuDateDiv"></div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrParam" class="select"  onchange="return refreshed()" onFocusout="return refreshed()">Activity Type</label>
			<select name="dsrParam" id="dsrParam" class="" value="<%=dsrParam%>" onchange="return refreshed()" onFocusout="return refreshed()"><%=dsrParamStr%></select>
		</div>
	</div>

<!-- include file="CodeSelectIncl.jsp removed due to various condition to incorporate-->

<%
if(!message.equals(""))
{
%>
 	<div class="col-lg-12 col-xs-12 col-sm-12">
		<div class="form-group">
			<blockquote>
				<font color="red"><h2><%=message%></h2></font>
			</blockquote>
		</div>
	</div>
<%
	sql = "select latitute, lgtitute  From "
		+ "( "
		+ "	select retlCode as cusRtlCd, latitute, lgtitute "
		+ "	From rtmRetailer with (nolock) "
		+ "	where isActive = 'Y' "
		+ "	union all "
		+ "	select custCode as cusRtlCd, latitute, lgtitute "
		+ "	From dpmCustomer with (nolock) " 
		+ "	where isActive = 'Y' "
		+ ") x  "
		+ "where x.cusRtlCd = '" + cusRtlCd + "'";
	rset = WebSessBean.selectRecord(sql);
	if (rset.next())
	{
		latitute = rset.getString(1);
		lgtitute = rset.getString(2);
	}	
}

if(!mobilApp && (dsrParam.equals("50") || dsrParam.equals("01")))
{
%>
   		<blockquote>
			<span>Dear User:  You can not submit Retailer / Stockiest Visit on Desktop application. Please download Birla white SPARSH Mobile App from Play store .
			</span>	<br>
			<span>
				It is allow in Android. We will update you when it is available on Ios (Iphone).
			</span>
		</blockquote>
<%
}
else
{

if(cusSelRq)
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="areaCode">Area Code:</label>
			<select name="areaCode"   value="<%=areaCode%>" id="areaCode" onChange="return pinExpoZ(this)" onFocusout="return pinExpoZ(this)"><%=WebSessBean.getArDesc(areaCode, true)%></select>
		</div>
	</div>
<%
	if(dsrParam.equals("50") || dsrParam.equals("61")) 
	{
		if(dsrRemAr[7].equals(""))
		{
			out.println("<input type = 'hidden' name = 'dsrRem08' value = ''>");
		}
		else if(dsrSizAr[2][7].equals("T")) 
		{
%>
		<div class="col-lg-4 col-xs-6 col-sm-4">
			<div class="form-group">
				<label class="control-label  float-sm-left"  for="dsrRem08"><%=dsrRemAr[7]%></label>
				<input type="text" name="dsrRem08" id="dsrRem08" class="" onchange="return retnMobData()" placeholder="<%=dsrRemAr[7]%>" value="<%=dsrRem08%>"><div id="dsrRem08Div"></div>
			</div>
		</div>
<%
		}
	}
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="cusRtlFl"><%=custLabl%>:</label>
			<select name="cusRtlFl" id="cusRtlFl" class="" placeholder="<%=custLabl%>" value="<%=cusRtlFl%>" onClick="showHideRtl()"><%=cusRtlFlStr%></select>
		</div>
	</div>			
<%
		if(!(dsrParam.equals("50") || dsrParam.equals("61"))) 
		{
%>
			<div class="col-lg-4 col-xs-6 col-sm-4">
				<div class="form-group">
					<label class="control-label  float-sm-left">Code:</label>
				<div class="input-group mb-3">
					<input type="text" name="cusRtlCd" class=""  placeholder="Purchaser Code" id="cusRtlCd" size="24" maxlength="8" value="<%=cusRtlCd%>"  onkeyup="edValueKeyPressCust(this.value)" autocomplete='off' onselect="return cusRtlCdHlpChng(this)" onblur="return cusRtlCdHlpChng(this)">
				<div class="input-group-append">
					<input type='button' name='srchcusRtlCd' class="searchBtnApp" onClick = "cusRtlCdHlpLoc('L')" alt="Click for Search"  >
				</div>
			</div>					
			<script>
			//onfocusout="return cusRtlCdHlpChng(this)" 
			// onChange="return cusRtlCdHlpChng(this)"
			</script>
					<div id="cusRtlCdDiv" style="display:none"></div>
<%
			if(cusCodRq)
			{
%>
			<div id="retlClas">
				<a style='cursor:pointer' class='btn btn-primary btn-block' onClick="openClickWind('/BirlaWhite/Master/Purchaser/RetailerEntry.jsp?procType=U&areaCode=<%=areaCode%>&retlCode=<%=cusRtlCd%>')">Update Retailer Class</a>
			</div>
<script>
  document.getElementById("retlClas").style.display = "none	";

</script>
<%
			}
%>
				</div>
			</div>
<%
		}
		else
		{
%>
			<input type="hidden" name="cusRtlCd" class="" id="cusRtlCd" size="24" value="">
<%
		}
}
else
{ 
%>
	<input type="hidden" name="cusRtlFl" value="<%=cusRtlFl%>">
	<input type="hidden" name="areaCode" value="<%=areaCode%>">
	<input type="hidden" name="cusRtlCd" value="<%=cusRtlCd%>">
<%
}
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"><%=dsrRemAr[0]%></label> 
<%
if(dsrSizAr[2][0].equals("T"))
{
%>
		<textarea name="dsrRem01" id="dsrRem01" class=""  placeholder="<%=dsrRemAr[0]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[0]%>', 500)"><%=dsrRem01%></textarea>
	</div>
</div>
<%
}
else if(dsrSizAr[2][0].equals("S"))
{
%>	
		<select name="dsrRem01" class="" id = "dsrRem01" value="<%=dsrRem01%>">
			<%=GenrlSuper.getOptionList(dsrSizAr[3][0], dsrSizAr[3][0], dsrRem01, false, true)%>
		</select>
	</div>
</div>
<%
}

if(dsrParam.equals("50") || dsrParam.equals("61")) 
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem08">Nearest Stockiest</label>
			<input type="text"  name="custCdRt" class="" placeholder="Nearest Stockiest" id="custCdRt" size="24" maxlength="8" value="<%=custCdRt%>" onclick = "return cusRtlCdHlpget('A')" autocomplete='off' onblur="return cusRtlCdng(this)">
	<div id="custCdRtDiv" style="display:none"></div>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="cstBisTy">Counter Type</label>
			<select name="cstBisTy" id="cstBisTy" value="<%=cstBisTy%>">
				<%=WebSessBean.getSqlToOptionStr("select '03', 'Gypsum counter' union all select '01', 'Paint Counter' union all select '02', 'Non Paint Counter' union all select '04', 'Other'", cstBisTy)%>
			</select>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left" >Pin Code *</label> 
			<input type="text" list="datalist" class="" placeholder="Enter Pin Code Number" name="pinCodeN" id="pinCodeN" value="<%=pinCodeN%>" onkeyup="edValueKeyPress(this.value)"  onblur="return pinCodeChng(this)"> 
			<!-- <datalist id="datalist"> 
			</datalist> 
 -->			<div id="pinCodeNDiv"></div>
				Click Here If you are not Find Your Pin Code in List 
			<input type="button" name="PinUpdt" value="Update Pincode"class='btn btn-primary ' data-toggle='modal' data-target='#myModal' title="Click Here If you are not Find Your Pin Code in List" onclick="return pinCodeUpdar()" />
			<br>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left" >District *</label> 
			<input type="text" class="" name="district" placeholder="District" id="district" value="<%=district%>" readonly>
		</div>
	</div>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem08">Visited City</label>
			<input type="text"  class="" name="cityName" placeholder="Visited City" id="cityName" size="30" maxlength="30" value="<%=cityName%>" readonly>
		</div>
	</div>
<%
}
else
{
%>
  <input type="hidden" name="cstBisTy" id="cstBisTy" value="">
<%
}
if(dsrParam.equals("01") || dsrParam.equals("02")) 
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem08">Purchaser Name</label><br>
			<div id = "cusRtlCdDiv1"></div>
		</div>
	</div>
<%
}
/*
if(!dsrParam.equals("02"))
{
	out.println("</div>");
}
if(dsrParam.equals("13"))
{
	out.println("</div>");
}
*/
%>
<%
if(dsrRemAr[1].equals(""))
{
	out.println("<input type = 'hidden' name = 'dsrRem02' value = ''>");
}
else if(dsrSizAr[2][1].equals("T"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"><%=dsrRemAr[1]%></label>
		<textarea name="dsrRem02" class="" id="dsrRem02"  placeholder="<%=dsrRemAr[1]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[1]%>', 500)"><%=dsrRem02%></textarea>
	</div>
</div>
<%
}
else if(dsrSizAr[2][1].equals("S"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"><%=dsrRemAr[1]%></label>
		<select name="dsrRem02" id = "dsrRem02" class="" value="<%=dsrRem02%>">
			<%=GenrlSuper.getOptionList(dsrSizAr[3][1], dsrSizAr[3][1], "", true, true)%>
		</select>
	</div>
</div>
<%
}

if(dsrRemAr[2].equals(""))
{
	out.println("<input type = 'hidden' name = 'dsrRem03' value = ''>");
}
else if(dsrSizAr[2][2].equals("T"))
{
%>
<div class="col-lg-4 col-xs-6 col-sm-4">
	<div class="form-group">
		<label class="control-label  float-sm-left"  for="dsrRem03"><%=dsrRemAr[2]%></label>
		<textarea name="dsrRem03" class="" id="dsrRem03" placeholder="<%=dsrRemAr[2]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[2]%>', 500)"><%=dsrRem03%></textarea>
<%
	if(dsrParam.equals("50") || dsrParam.equals("61"))
		out.println("<div id='dsrRem03Div'></div>");
%>	
	</div>
</div>
<%
}
else if(dsrSizAr[2][2].equals("S"))
{
%>
<div class="col-lg-4 col-xs-6 col-sm-4">
	<div class="form-group">
		<label class="control-label  float-sm-left"  for="dsrRem03"><%=dsrRemAr[2]%></label>
		<select name="dsrRem03" id = "dsrRem03" class="">
			<%=GenrlSuper.getOptionList(dsrSizAr[3][2], dsrSizAr[3][2], "", true, true)%>
		</select>
	</div>
</div>
<%
}
%>

<%
if(dsrRemAr[3].equals(""))
{
	out.println("<input type = 'hidden' name = 'dsrRem04' value = ''>");
}
else if(dsrSizAr[2][3].equals("T"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem04"><%=dsrRemAr[3]%></label>
			<textarea name="dsrRem04" class="" id="dsrRem04" placeholder="<%=dsrRemAr[3]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[3]%>', 500)"><%=dsrRem04%></textarea>
		</div>
	</div>
<%
}
else if(dsrSizAr[2][3].equals("S"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem04"><%=dsrRemAr[3]%></label>
			<select name="dsrRem04" id = "dsrRem04" class="">
				<%=GenrlSuper.getOptionList(dsrSizAr[3][3], dsrSizAr[3][3], "", true, true)%>
			</select>
		</div>
	</div>
<%
}

if(dsrRemAr[4].equals(""))
{
	out.println("<input type = 'hidden' name = 'dsrRem05' value = ''>");
}
else if(dsrSizAr[2][4].equals("T"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem05"><%=dsrRemAr[4]%></label>
			<textarea name="dsrRem05" class="" id="dsrRem05"  placeholder="<%=dsrRemAr[4]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[4]%>', 500)"><%=dsrRem05%></textarea>
		</div>
	</div>
<%
}
else if(dsrSizAr[2][4].equals("S"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem05"><%=dsrRemAr[4]%></label>
			<select name="dsrRem05" id = "dsrRem05" class="">
				<%=GenrlSuper.getOptionList(dsrSizAr[3][4], dsrSizAr[3][4], "", true, true)%>
			</select>
		</div>
	</div>
<%
}

if(dsrRemAr[5].equals(""))
{
	out.println("<input type = 'hidden' name = 'dsrRem06' value = ''>");
}
else if(dsrSizAr[2][5].equals("T"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem06"><%=dsrRemAr[5]%></label>
		<textarea name="dsrRem06" class="" id="dsrRem06" placeholder="<%=dsrRemAr[5]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[5]%>', 500)"><%=dsrRem06%></textarea>
		</div>
	</div>
<%
}
else if(dsrSizAr[2][5].equals("S"))
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem06"><%=dsrRemAr[5]%></label>
		<select name="dsrRem06" id = "dsrRem06" class="">
			<%=GenrlSuper.getOptionList(dsrSizAr[3][5], dsrSizAr[3][5], "", true, true)%>
		</select>
		</div>
	</div>
<%
}

if(dsrRemAr[6].equals(""))
{
	out.println("<input type = 'hidden' name = 'dsrRem07' value = ''>");
}
else if(dsrSizAr[2][6].equals("T"))
{
%>
<div class="col-lg-4 col-xs-6 col-sm-4">
	<div class="form-group">
		<label class="control-label  float-sm-left"  for="dsrRem07"><%=dsrRemAr[6]%></label>
		<textarea name="dsrRem07"  class="" id="dsrRem07"  placeholder="<%=dsrRemAr[6]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[6]%>', 500)"><%=dsrRem07%></textarea>
	</div>
</div>
<%
}

if(!(dsrParam.equals("50") || dsrParam.equals("61"))) 
{
%>
<%
	if(dsrRemAr[7].equals(""))
	{
		out.println("<input type = 'hidden' name = 'dsrRem08' value = ''>");
	}
	else if(dsrSizAr[2][7].equals("T")) 
	{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem08"><%=dsrRemAr[7]%></label>
			<textarea name="dsrRem08" class="" id="dsrRem08" placeholder="<%=dsrRemAr[7]%>" onChange="return textValidLApp(this, '<%=dsrRemAr[7]%>', 500)"><%=dsrRem08%></textarea>
		</div>
	</div>
<%
	}
} 
try
{
//	out.println(actPntRq);
	if(!(dsrParam.equals("50"))) 
	{
		if(actPntRq)
		{
%>
	<div class="col-lg-6 col-xs-6 col-sm-6">
		<div class="form-group">
				<label class="control-label  float-sm-left"  for="dsrRem01"><%=dsrParam.equals("01") ? "Order Details" : "Action Remarks"%></label> 
					<div class="table-responsive">
					<table class="table table-sm" id="prjTable">
					<thead>
						<tr <%=thdClsJQ%>>
							<div class='chkBox'><th id="th">Del</th></div>
							<th id="th">
								<%=actPntRq ? "Action Points" : "Product"%>
							</th>
							<th id="th">
								<%=actPntRq ? "Closer Date" : (dsrParam.equals("21") ? "No of Samples Done" : "New Order Received")%>
							</th>
							<th id="th">
								<%=prjSelRq ? (dsrParam.equals("21") ? "No of Samples Approved" : "Projection for the Month (MT)") : ""%>
							</th> 
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
<%
		}
	}
/*
	if(dsrParam.equals("50")) 
	{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
				<label class="control-label  float-sm-left"  for="dsrRem01">Action Points</label> 
				<table id="prjTable2">
					<thead>
						<tr <%=thdClsJQ%>>
							<div class='chkBox'><th  id="th">Del</th></div>
							<th  id="th">
								Product
							</th>
							<th  id="th">
								New Order Received
							</th>
							<th  id="th">
								Projection for the Month (MT)
							</th> 
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
<%
		if (procType.equals("A"))
		{
			sql = "select repoCatg, repoDesc "
				+ "from bkmRepoCatg with (nolock) "
				+ "where isActive = 'Y' "
				+ "and   repoCatg in ('01', '02', '03', '09','12', '15','17','18','19')";

			rset = WebSessBean.selectRecord(sql);
	//repoCatg, repoDesc, prodQnty, projQnty, actnRemk, targetDt
			while (rset.next())
			{
%>
				<script language="Javascript">

					addrow('<%=rset.getString(1)%>', '<%=rset.getString(2)%>', '0', '0', '', '');
				</script>
<%
				recFound = true;
			}
		}
		else if(procType.equals("U"))
		{
//			sql = "select a.repoCatg, a.repoDesc,  prodQnty,projQnty, actnRemk, isnull(convert(char(10), targetDt, 103), '') from bkmRepoCatg a with (nolock), dptDSRActvtDtl b with (nolock) where a.isActive = 'Y' and   a.repoCatg = b.repoCatg and   a.repoCatg in ('01', '02', '03', '09', '15') and  docuNumb = '" + docuNumb + "' ";	// and createId = '" + loginIdM + "'" + docuNumb + "
			sql = "select a.repoCatg, a.repoDesc,  isnull(prodQnty, 0), isnull(projQnty, 0), isnull(actnRemk, ''), isnull(convert(char(10), targetDt, 103), '') "
				+ "from bkmRepoCatg a with (nolock) "
				+ "left join dptDSRActvtDtl b  with (nolock) on a.repoCatg = b.repoCatg " 
				+ "and		docuNumb = '" + docuNumb + "' "
				+ "and		b.createId = '" + loginIdM + "' "
				+ "where    a.repoCatg in ('01', '02', '03', '09','12','15','17','18','19') "
				+ "and		a.isActive = 'Y' ";
				rset = WebSessBean.selectRecord(sql);
			while(rset.next())
			{
%>			
				<script language="Javascript">
					addrow('<%=rset.getString(1)%>','<%=rset.getString(2)%>','<%=rset.getString(3)%>','<%=rset.getString(4)%>','<%=rset.getString(5)%>','<%=rset.getString(6)%>','0');
				</script>
<%

				recFound = true;
			}
		}
%>
	</div>
	</div>
<%
	}
*/
	if(prdSelRq) 
	{
%>
	<div class="col-lg-6 col-xs-6 col-sm-6">
		<div class="form-group">
				<label class="control-label  float-sm-left"  for="dsrRem01"><%=dsrParam.equals("01") || dsrParam.equals("02") || dsrParam.equals("61") ? "Order Details" : "Action Remarks"%></label> 
				<div class="table-responsive">
				<table id="prjTable" class="table table-sm">
				<thead>
					<tr <%=thdClsJQ%>>
						<div class='chkBox'><th  id="th">Del</th></div>
						<th  id="th">
							<%=actPntRq ? "Action Points" : "Product"%>
						</th>
						<th  id="th">
							<%=actPntRq ? "Closer Date" : (dsrParam.equals("21") ? "No of Samples Done" : "New Order Received")%>
						</th>
						<th  id="th">
							<%=prjSelRq ? (dsrParam.equals("21") ? "No of Samples Approved" : "Projection for the Month (MT)") : ""%>
						</th> 
					</tr>
				</thead>
				<tbody>
<%
		if (procType.equals("A"))
		{
/*
Removed bY Rajednra
			sql = "select repoCatg, repoDesc "
				+ "from bkmRepoCatg with (nolock) "
				+ "where isActive = 'Y' "
				+ "and   repoCatg in ('01', '02', '03', '09','12', '15','17','18','19','20')";

			rset = WebSessBean.selectRecord(sql);
	//repoCatg, repoDesc, prodQnty, projQnty, actnRemk, targetDt
			while (rset.next())
			{
				recFound = true;
			}
*/
	
%>
				<script language="Javascript">
					addrow('02', '', '0', '0', '', '');
				</script>
<%
		}
		else if(procType.equals("U"))
		{
//			sql = "select a.repoCatg, a.repoDesc,  prodQnty,projQnty, actnRemk, isnull(convert(char(10), targetDt, 103), '') from bkmRepoCatg a with (nolock), dptDSRActvtDtl b with (nolock) where a.isActive = 'Y' and   a.repoCatg = b.repoCatg and   a.repoCatg in ('01', '02', '03', '09', '15') and  docuNumb = '" + docuNumb + "' ";	// and createId = '" + loginIdM + "'" + docuNumb + "
			sql = "select a.repoCatg, a.repoDesc,  isnull(prodQnty, 0), isnull(projQnty, 0), isnull(actnRemk, ''), isnull(convert(char(10), targetDt, 103), '') "
				+ "from bkmRepoCatg a with (nolock) "
				+ "left join dptDSRActvtDtl b  with (nolock) on a.repoCatg = b.repoCatg " 
				+ "and		docuNumb = '" + docuNumb + "' "
				+ "and		b.createId = '" + loginIdM + "' "
				+ "where    a.repoCatg in ('01', '02', '03', '09','12','15','17','18','19') "
				+ "and		a.isActive = 'Y' ";
				rset = WebSessBean.selectRecord(sql);
			while(rset.next())
			{
%>			
				<script language="Javascript">
					addrow('<%=rset.getString(1)%>','<%=rset.getString(2)%>','<%=rset.getString(3)%>','<%=rset.getString(4)%>','<%=rset.getString(5)%>','<%=rset.getString(6)%>','0');
				</script>
<%

				recFound = true;
			}
		}
	}
	if (prdSelRq)
	{
%>
</tbody>
</table>
</div>
	<div align="center">
		<button name="skAdd" id="skAdd" class="btn btn-secondary" onClick="addrow1('00')" type="button">Add<span class="ui-icon ui-icon-plus"></span></button>
		<button name="skDel" id="skDel" class="btn btn-primary" onClick="deleter1()" type="button">Delete<span class="ui-icon ui-icon-minus"></span></button> 
	</div>
<%
	}
	if(actPntRq) 
	{
//		out.println("actPntRq  " + docuNumb);
//		out.println("actPntRq  " + dsrParam);
		if (procType.equals("A"))
		{
%>
			<script language="Javascript">
			//	addrow1();
			</script>
<%
		}
		else if(procType.equals("U"))
		{
			sql = "select prodQnty, actnRemk, isnull(convert(char(10), targetDt, 103), '') from dptDSRActvtDtl b with (nolock) where docuNumb = '" + docuNumb + "'  and createId = '" + loginIdM + "' ";	// and createId = '" + loginIdM + "'
			rset = WebSessBean.selectRecord(sql);
	//	out.println(sql);		
			while(rset.next())
			{
	/*			docuSrNo = rset.getString(1);
				repoCatg = rset.getString(2);
				prodQnty = rset.getString(3);
				actnRemk = rset.getString(4);
				targetDt = rset.getString(5);
	*/
%>			
				<script language="Javascript">
					addrow('','','0','0','<%=rset.getString(2)%>','<%=rset.getString(3)%>');
				</script>
<%
				recFound = true;
			}
		}
	}

if(!dsrParam.equals("61"))
{
if(!dsrParam.equals("50")) 
{
	if(dsrParam.equals("01") || dsrParam.equals("51")) 
	{
%>
	</table>
</div>
</div>
<%
	}
%>
	<input type="hidden"  name="cityName" id="cityName" size="30" maxlength="30" value="">
	<input type="hidden"  name="pinCodeN" id="pinCodeN" size="24" maxlength="6" value="">
	<input type="hidden"  name="district" id="district" size="24" maxlength="6" value="">
<%
	if (actPntRq)
	{
%>
	<div align="center">
		<button name="skAdd" id="skAdd" class="btn btn-secondary" onClick="addrow1()" type="button">Add<span class="ui-icon ui-icon-plus"></button>
		<button name="skDel" id="skDel" class="btn btn-primary" onClick="deleter1()" type="button">Delete<span class="ui-icon ui-icon-minus"></span></button> 
	</div>
		</div>
	</div>
<%
	}
}
}

if(actPntRq || prdSelRq)
{
	if(dsrParam.equals("50") || dsrParam.equals("01")) 
	{
%>
	<div class="col-lg-6 col-xs-6 col-sm-6">
		<div class="form-group table-responsive">
			<label class="control-label  float-sm-left"  for="dsrRem01">Last Recorded Market Mapping Data</label> <br>
			<div class="row">
				<div class="form-group col-lg-12">
					<table id="prjTablePrv" class="table table-sm">
							<thead>
								<tr <%=thdClsJQ%>>
									<th  id="th">Products</th>
									<th  id="th">
										Total Quantity Sold in a year (MT)
									</th>
									<th  id="th">
										Total BW Quantity Sold in a year (MT)
									</th> 
									<th  id="th">
										Date Last Modified 
									</th> 
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
<%
	}
}
	if(dsrParam.equals("01") || dsrParam.equals("50"))
	{
			sql = "select top 2 a.repoCatg, repoDesc , a.prodQnty, a.projQnty, convert(varchar(10), c.docuDate, 103) "
				+ "from  dptDSRActvtDtl a with (nolock), bkmRepoCatg b with (nolock), dptDSRActvt c with (nolock)  "
				+ "where a.repoCatg = b.repoCatg  and   a.docuNumb = c.docuNumb "
				+ "and   a.repoCatg in ('01', '02') "
				+ "and   mrktData = '01' and   (prodQnty > 0 or projQnty > 0) and   a.createId = '2422' order by a.createDt desc ";	//" + loginIdM + "

				rset = WebSessBean.selectRecord(sql);
		//		out.println(sql);
		//repoCatg, repoDesc, prodQnty, projQnty, actnRemk, targetDt
				while (rset.next())
				{
%>
					<script language="Javascript">
						addrowMrkPrv('<%=rset.getString(1)%>', '<%=rset.getString(2)%>', '<%=rset.getString(3)%>', '<%=rset.getString(4)%>', '<%=rset.getString(5)%>');
					</script>
<%
					recFound = true;
				}

	}
if(actPntRq || prdSelRq)
{
	if(dsrParam.equals("50") || dsrParam.equals("01")) 
	{
%>
	<div class="col-lg-6 col-xs-6 col-sm-6">
		<div class="form-group table-responsive">
			<label class="control-label  float-sm-left"  for="dsrRem01">Edit Market Mapping Data (Optional)</label> 
			<div class="row">
				<div class="form-group col-lg-12">
					<table id="prjTableMekt" class="table table-sm">
					<thead>
						<tr <%=thdClsJQ%>>
								<div class='chkBox'><th  id="th">Del</th></div>
						<th  id="th">Products</th>
							<th  id="th">
								Total Quantity Sold in a year (MT)
							</th>
							<th  id="th">
								Total BW Quantity Sold in a year (MT)
							</th> 
						</tr>
					</thead>
					<tbody>
					</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
<%

	if(dsrParam.equals("01") || dsrParam.equals("50"))
	{
		sql = "select repoCatg, repoDesc "
			+ "from bkmRepoCatg with (nolock) "
			+ "where isActive = 'Y' "
			+ "and   repoCatg in ('01', '02')";

			rset = WebSessBean.selectRecord(sql);
	//repoCatg, repoDesc, prodQnty, projQnty, actnRemk, targetDt
			while (rset.next())
			{
%>
				<script language="Javascript">
					addrowMrkShr('<%=rset.getString(1)%>', '<%=rset.getString(2)%>', '0', '0', '', '');
				</script>
<%
				recFound = true;
			}

	}
	}
}
}
catch(Exception e) 
{
	throw new Exception("Error while fetching records in " + pageAddress + e.toString());
}
rset = WebSessBean.closeRset(rset); 

if(dsrParam.equals("50")) 
{
%>
	<div class="col-lg-6 col-xs-6 col-sm-6">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem01">Order Details</label> 
			</br>
			<table id="prjTable" class="table table-sm">
				<thead>
					<tr <%=thdClsJQ%>>
						<div class='chkBox'><th  id="th">Del</th></div>
						<th  id="th">
							<%=actPntRq ? "Action Points" : "Product"%>
						</th>
						<th  id="th">
							<%=actPntRq ? "Closer Date" : (dsrParam.equals("21") ? "No of Samples Done" : "New Order Received")%>
						</th>
						<th  id="th">
							<%=prjSelRq ? (dsrParam.equals("21") ? "No of Samples Approved" : "Projection for the Month (MT)") : ""%>
						</th> 
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			<script language="Javascript">
				addrow('','','0','0','', '');
			</script>
			<div align="center">
				<button name="skAdd" id="skAdd" class="btn btn-secondary" onClick="addrow1()" type="button">Add<span class="ui-icon ui-icon-plus"></button>
				<button name="skDel" id="skDel" class="btn btn-danger" onClick="deleter1()" type="button">Delete<span class="ui-icon ui-icon-minus"></span></button> 
			</div>
		</div>
	</div>
<%
}
if(dsrParam.equals("50") || dsrParam.equals("61")) 
{
%>
	<div class="col-lg-4 col-xs-6 col-sm-4">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem08">No of KYC Document For this Purchaser</label>
			<textarea name="dsrRem09" id="dsrRem09" class="" placeholder="KYC Document Count" maxlength="1"><%=dsrRem09.equals("") ? '0' : dsrRem09%></textarea>
		</div>
	</div>
<%
} 
if(mobilApp)
{
%>	

	<div class="col-lg-4 col-xs-6 col-sm-4" id="finlRsltDiv7">
		<div class="form-group">
			<label class="control-label  float-sm-left"  for="dsrRem07">Address</label><br>
			<label class="control-label  float-sm-left"  for="ordExDat">Current Location</label>
			<input type="text" name="geoLatit" id="geoLatit" value="<%=geoLatit%>" readonly>
			<input type="text" name="geoLongt" id="geoLongt" value="<%=geoLongt%>" readonly>
			<input id="FinlRslt" name="FinlRslt" size="25" class="" type="hidden" value="<%=FinlRslt%>" readonly>
			<br>
			<label class="control-label  float-sm-left"  for="ordExDat">Purchaser Location</label>
			<br>
			<input type="text" name="lgtitute" id="lgtitute" value="<%=lgtitute%>" readonly>
			<input type="text" name="latitute" id="latitute" value="<%=latitute%>" readonly>
			<input type="hidden" name="locaCapr" id="locaCapr" value="">
			<input style="display:none;" type="button" value="Get Address" onclick="GetAddress()" />
			<div id="map"></div>
			<div id="current" style="display:none"></div>
		</div>
	</div>

<script>
//  document.getElementById("finlRsltDiv").style.display = "none";
</script>
<%
}
else
{
%>
			<div id="current" style="display:none"></div>
		<input type="hidden" name="geoLatit" id="geoLatit" value="">
		<input type="hidden" name="geoLongt" id="geoLongt" value="">
		<input type="hidden" name="FinlRslt" id="FinlRslt" value="">
		<input type="hidden" name="lgtitute" id="lgtitute" value="">
		<input type="hidden" name="latitute" id="latitute" value="">
		<input type="hidden" name="locaCapr" id="locaCapr" value="">
<%
}
%>

	<div class="col-lg-6 col-xs-6 col-sm-6">
		<table id="imgTable" class="table table-sm" align="center">
		<thead <%=thdClsJQ%>>
			<tr>
				<th id="th">Del</th>
				<th id="th" style="display:none;">Document Type</th>
				<th id="th">Upload Supporting / View</th>
				<th id="th" style="display:none;" >View</th>
			</tr>
		</thead>
		<tbody>
			<script language="Javascript">
				addrow1_Img();
			</script>
		</tbody>
		</table>
	</div>
</div>
<input type="hidden" name="randNmSt" value="<%=randNmSt%>">

  <div class="disp" align="center">
	<div class="col-lg-12 col-xs-12 col-sm-12">
<%
if(mobilApp)
{
%>
      <div class="btn-group" role="group" aria-label="Basic example">
        <input type="button" id="saveButnA" value="Submit & New" onClick="return submitValid('A')" class="btn btn-primary">
        <input type="button" id="saveButnE" value="Submit & Exit" onClick="return submitValid('E')" class="btn btn-primary">
	  </div>
<%
}
else
{
%>
      <div class="btn-group" role="group" aria-label="Basic example">
        <input type="button" id="saveButnA" value="Submit & New" onClick="return submitValid('A')" class="btn btn-primary">
        <input type="button" id="saveButnE" value="Submit & Exit" onClick="return submitValid('E')" class="btn btn-primary">
		<a class="btn btn-primary" style='cursor:pointer' onclick = "openClickWind('/BirlaWhite/Reports/General/DSRActvRepSelf.jsp?createId=<%=loginIdM%>&strtDate=<%=strtDate%>&endgDate=<%=sysDateOnly%>&emplName=<%=log.getUserName()%>')">Click to See Submitted Data</a>
	  </div>
<%
}
%>
    </div>
  </div>
<br>
<%
if(1 != 1)
{
%>
 <div class="row">
  <div class="container-fluid">
      <div class="btn-group btn-group-lg" role="group" aria-label="Basic example">
		<a class="btn btn-primary btn-block" style='cursor:pointer' onclick = "openClickWind('/BirlaWhite/Reports/General/DSRActvRepSelf.jsp?createId=<%=loginIdM%>&strtDate=<%=strtDate%>&endgDate=<%=sysDateOnly%>&emplName=<%=log.getUserName()%>')">Click to See Submitted Data</a>
    </div>
  </div>
</div>
<%
}
%>
<script language="javascript">
enabDisb();
</script>
<%
}
}
else
{
	if(rtlTrgFl)
	{
%>
	<blockquote>
		<div class="displErr displErr-danger" role="displErr">
			<font size="3" color="red">
				<strong> Dear User, <br> You are not Aurthorized to Enter DSR Without Entering Retailer Target Entry.
				<br> 
					First You complete 100% retailers target for Cement, VAP & Putty and then submit DSR. 
				<br>	
				<div class="card">
					<table>
						<tr>
							<th>Total Mapped Retailers</th><td><%=ttlMpdRt%></td> <td></td>
						</tr>
						<tr>
							<th>Product</th><td>No Of Retailers Target Entered</td> <td> % (Target Enter Vs Total Mapped)</td>
						</tr>
						<tr class=<%=trgCmtPr < 100 ? "table-danger" : "table-success" %>>
							<th>Cement </th><td><%=targtCmt%></td><td><%=trgCmtPr%></td>
						</tr>
						<tr class=<%=trgPtyPr < 100 ? "table-danger" : "table-success" %>>
							<th>Putty </th><td><%=targtPty%></td>	<td><%=trgPtyPr%></td>
						</tr>
						<tr class=<%=trgVapPr < 100 ? "table-danger" : "table-success" %>>
							<th>VAP </th><td><%=targtVAP%></td><td><%=trgVapPr%></td>
						</tr>
					</table>
				</div>
					<br>	Please <a href="/BirlaWhite/Mobile/RetailerTrgt.jsp">Click Here </a>for  <font size="3" color="black">Enter Retailer Target Entry</font>
					<br>	Please <a href="/BirlaWhite/Reports/MIS/BidVsTrgtSl.jsp?repoType=T">Click Here </a>for  <font size="3" color="black">Enter Retailer Target Download</font>
				</strong>
			</font>
		</div>
	<blockquote> 
<%
	}
	else if(snopFrAl.equals("Pending"))
	{
%>
	<blockquote>
		<div class="displErr displErr-danger" role="displErr">
			<font size="3" color="red">
			<br>	
			Please	<a href="/BirlaWhite/Mobile/salesNdOpr.jsp">Click Here </a>for  <font size="3" color="black">Enter SnOP Entry <br>
			
				<strong> Dear User, <br> You are not Aurthorized to Enter DSR Without submit SnOP.

				<div class="card">
					<table>
						<tr>
							<th>Type</th>
							<th>UOM</th>
							<th>Sales Area</th>
							<th>Status</th>
						</tr>
<%
	sql = "	select  'SnOP', nwMtKgLt, areaDesc, count(distinct case when noOfEntry > 0 then areaCode else null end), count(distinct areaCode), " 
		+ "			case when sum(noOfEntry) > 0 then 'Done' else 'Pending' end "
		+ "From  "
		+ "( "
		+ "	selecT  c.stLgcCod, c.retlStHd, a.areaCode, b.areaDesc, d.nwMtKgLt, count(*) as noOfEntry "
		+ "	From	dptAreaDemd a with (nolock), bkmAreaMast b with (nolock), bkmStateLgc c with (nolock), bkmCatgPack d with (nolock) "
		+ "	where	a.areaCode = b.areaCode "
		+ "	and		b.stLgcCod = c.stLgcCod	"
		+ "	and		a.mnthYear = dbo.cofNextYrMn(convert(varchar(6), getdate(), 112)) "
		+ "	and		a.catPckCd = d.catPckCd "
		+ "	and     a.statFlag not in ('C','R') "
		+ "	group   by c.stLgcCod, c.retlStHd, a.areaCode, b.areaDesc, d.nwMtKgLt "
		+ "	union all "
		+ "	selecT  c.stLgcCod, c.retlStHd, b.areaCode, b.areaDesc, d.nwMtKgLt, 0 "
		+ "	From	bkmAreaMast b with (nolock), bkmStateLgc c with (nolock), bkmCatgPack d with (nolock) "
		+ "	where	b.stLgcCod = c.stLgcCod "
		+ "	and     d.isActive = 'Y' "
		+ "	and     b.isActive = 'Y' "
		+ "	and     d.prodCdDs is not null and  b.areaCode not in ('EXB','EXC','EXE','EXG','EXN','EXR','EXT','EXR','EXT','EXR','KKR', 'KAT', 'DLC','PNY','BKM','NAT','KAT','JPF') "
		+ "	group   by c.stLgcCod, c.retlStHd, b.areaCode, b.areaDesc, d.nwMtKgLt "
		+ ")x "
		+ "where retlStHd = '" + loginIdM + "' "
		+ "and   day(getdate()) >= 19 "
		+ "group by stLgcCod,  nwMtKgLt, areaDesc "	;//, case when noOfEntry > 0 then 'Done' else 'Pending' end
	rset = WebSessBean.selectRecord(sql);
	out.println(sql);
	while(rset.next())
	{
%>
		<tr>
			<td><%=rset.getString(1)%></td> 
			<td><%=rset.getString(2)%></td> 
			<td><%=rset.getString(3)%></td> 
			<td><%=rset.getString(6)%></td> 
		</tr>
<%
		snopFrAl = rset.getString(5);
	}
				
%>
			</table>
				</div>
		</div>
	<blockquote> 
<%
	}
	else
	{
%>
	<blockquote>
		<div class="displErr displErr-danger" role="displErr">
			<font size="3" color="red">
				<strong> Dear User, <br> You are not Aurthorized to Enter DSR Without Entering Market MIS Entry And Stockiest Target Entry.<br> First You complete Both entries and then submit DSR. 
					<br>	Please <a href="/BirlaWhite/Mobile/SFAEnt01.jsp">Click Here </a>for Enter Market MIS Entry <font size="3" color="black"><%=dsrEntAl ? "Market MIS Entry Complete" : " Pending"%></font>
					<br>	Please <a href="/BirlaWhite/Mobile/StcktTrgtDt.jsp">Click Here </a>for Enter Stockiest Target Entry <font size="3" color="black"><%=dsrStkAl ? "Market MIS Entry Complete" : " Pending"%></font>
				</strong>
			</font>
			<div >
					<strong>You Belogns to Given Area : <%=areaDesc%>.<br> If there is any wrong mapping Please Contact to Your State Head Or Zonal Head</strong>
			</div>
		</div>
	<blockquote> 
<%
	}
}
}
catch (Exception e)
{
	throw new Exception("Error while fetching records in " + pageAddress + e.toString());
}
rset = WebSessBean.closeRset(rset);
%>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
		<script src="/tmp/geoTag/js/geoPosition.js" type="text/javascript" charset="utf-8"></script>


<script language="javascript">
 var isAndroid =  /Android/.test(navigator.userAgent);

	function  showHideRtl()
	{
		if(document.<%=formName%>.cusRtlFl.value == "R" || document.<%=formName%>.cusRtlFl.value == "RR")
			$("#retlClas").show();
		else
			$("#retlClas").hide();
	}

if(("<%=message%>" != "") || ("<%=dsrParam%>" == "50" && !<%=pinCdRqA%>) || ("<%=dsrParam%>" == "61" && !<%=pinCdRqA%>))
{
//	fillPinLoc1()
}
else
{
	document.<%=formName%>.areaCode.value= "";
}
function photoUpl(varNumRw)
{
	var flUpLnSt = "";
	document.getElementById("uplodBtn" + varNumRw).src = "";

//	if (!textValidApp(document.getElementById("docuType" + varNumRw), "Document Type", false))
//		return false;

//	var docuType = document.getElementById("docuType" + varNumRw).value;

	upldFlNm = "<%=deptCode%><%=loginIdM%>";

	upldFlNm += document.<%=formName%>.randNmSt.value + varNumRw;


	eval("document.<%=formName%>.upldFlNm" + varNumRw).value = upldFlNm;

	flUpLnSt = "/Envr/JSP/FileUpload.jsp?popupWin=Y&upDocNum=" + upldFlNm + "&fileDocu=0&fileType=jpg,jpeg&maxmSize=3&filSeqNo=0&attFilTy=00";
	//openUpldWind(upldFlNm, '', 'jpg', '');
/*
	if(!<%=mobilApp%>)
	{
		document.getElementById("myModalLabel" ).innerText = "Image Upload";
		document.getElementById("modeliframe").src = flUpLnSt;
	}
	else
	{
*/
		createModal('Image Upload', flUpLnSt);
//	}
	return true;
}

function photView(varNumRw)
{	
	//displErr(1);
	var imgeView="";
	imgeView = "/Envr/JSP/AtchFileShow.jsp?docuNumb=" + upldFlNm + "&atchNmId=0&filSeqNo=0&attFilTy=00";
//	displErr(imgeView);

/*
	if(!<%=mobilApp%>)
	{
		document.getElementById("myModalLabel" ).innerText = "Image View";
		document.getElementById("modeliframe" ).src = imgeView;
	}
	else
	{
*/
		createModal('Image View', imgeView);
//	}

//	displErr(document.getElementById("modelifrmSrc" ).src);
}

/*
function MessgView()
{	
	var imgeView="";
	imgeView = "All DIC will have to enter Market MIS at month end then only he would be able to enter DSR for next month.";
//	document.getElementById("myModalLabel" ).innerText = "Important Message";
//	document.getElementById("modeliframe" ).src = imgeView;
	imgeView = "/Envr/JSP/AtchFileShow.jsp?docuNumb=&atchNmId=0&filSeqNo=0&attFilTy=00";
	document.getElementById("modeliframe" ).src = imgeView;
}
*/
//	MessgView()

function pinCodeUpdar()
{	
	var imgeView="";
	imgeView = "/BirlaWhite/Master/Purchaser/PinCodeMast.jsp?popupWin=Y";

   createModal('Update New Pin Code', imgeView);

//	document.getElementById("myModalLabel" ).innerText = "Update Pin Code";
//	document.getElementById("modeliframe" ).src = imgeView;
}
function cusRtlCdHlpLoc(rqstType)
{
	var srcFldNm = "cusRtlCd";
	var cusRtlFl = document.<%=formName%>.cusRtlFl;
	var wherList = "";
	var cusTypFl = "";


	if(cusRtlFl.value == "")
	{
		displErr("Please select User Type");
		cusRtlFl.value = "";
		cusRtlFl.focus();
		return false;
	}

	if(cusRtlFl.value == "C" || cusRtlFl.value == "RD"  || cusRtlFl.value == "AD")
	{
		if("<%=dsrParam%>" == "KKR118" || document.<%=formName%>.dsrParam.value == "12" || document.<%=formName%>.dsrParam.value == "13") 
		{
			//wherList = whereAdd(wherList, "SW_28", "BL"); // Bulder Segment
			wherList = whereAdd(wherList, "SW_05", "N");
		}
		else
		{
			wherList = whereAdd(wherList, "SW_04", ""); // All Trade Segment
		}

		if(cusRtlFl.value == "C")
			cusTypFl = "T";
		else if(cusRtlFl.value == "RD")
			cusTypFl = "R";

		if("<%=dsrParam%>" == "KKR118" || document.<%=formName%>.dsrParam.value == "12" || document.<%=formName%>.dsrParam.value == "13") 
		{
			cusTypFl = "";
		}

		custCodeHlp('<%=formName%>', 'areaCode', srcFldNm, rqstType, 'O', cusTypFl, wherList);
	}
	else if(cusRtlFl.value == "R" || cusRtlFl.value == "RR")
	{
		if(cusRtlFl.value == "R")
			wherList = whereAdd(wherList, "SW_06", ""); // Exclude Subdistributor 
		else if(cusRtlFl.value == "RR")
			wherList = whereAdd(wherList, "SW_06", "S"); // Exclude Subdistributor 

		retlCodeHlp('<%=formName%>', srcFldNm, 'areaCode', 'A', rqstType, 'Y', wherList);
	}
	else
	{
		wherList = whereAdd(wherList, "SW_01", "Y");
		//wherList = whereAdd(wherList, "SW_04", "");
		wherList = whereAdd(wherList, "SW_07", document.<%=formName%>.areaCode.value);
		wherList = whereAdd(wherList, "SW_03", cusRtlFl.value);

		dataLook("<%=formName%>", srcFldNm, 'MK_00045', 'L', 'DN', wherList);
	
	}
	return true;
}

var custCdRtArr = "",
	cusRtlCdArr = "";

function cusRtlCdHlpget(rqstType)
{
//	displErr(rqstType);
	if(rqstType == "A")
	{
		var srcFldNm = "custCdRt",
			tgtFldNm = "custCdRtDiv",
			newCustS = "Y";
		if(!(document.<%=formName%>.cusRtlFl.value == "R" || document.<%=formName%>.cusRtlFl.value == "RR"))	
		{
			displErr("Nearest Stokiest Code Not require");
			return false;
		}
	}
	else
	{
		var srcFldNm = "cusRtlCd",
			newCustS = "",
			tgtFldNm = "cusRtlCdDiv";
	}

	var wherList = "",
		rtnValue = false,
		rqstType = "G";
		queryCod = "MK_01083";
	var cusRtlFl = document.<%=formName%>.cusRtlFl;

	wherList = whMasAdd(wherList, "Y");

//	wherList = whereAdd(wherList, "SW_04", "AGR");
	wherList = whereAdd(wherList, "SW_04", document.<%=formName%>.areaCode.value);

	if(cusRtlFl.value == "")
	{
		displErr("Please select User Type");
		cusRtlFl.value = "";
		cusRtlFl.focus();
		return false;
	}
//	displErr(newCustS);
/*	if(newCustS == "Y" && !(cusRtlFl.value == "R" || cusRtlFl.value == "RR"))
	{
		displErr("Nearest Stockiest Allow only When You select Retailer or Rural Retailer");
		cusRtlFl.value = "";
		cusRtlFl.focus();
		return false;
	}
*/
	if(document.<%=formName%>.areaCode.value == "")
	{
		displErr("Please select Area");
		document.<%=formName%>.areaCode.focus();
		return false;
	}
	
//	displErr(cusRtlFl.value);
	if(newCustS == "Y")
	{
		wherList = whereAdd(wherList, "SW_02", "'C'");
	}
	else if(cusRtlFl.value == "C")
	{
		wherList = whereAdd(wherList, "SW_08", "'PT','BL','TL','LU'");
	}
	else if(cusRtlFl.value == "RD")
	{
		wherList = whereAdd(wherList, "SW_08", "'RD'");
	}
	else if(cusRtlFl.value == "D")
	{
		if(document.<%=formName%>.areaCode.value == "DEL" || document.<%=formName%>.areaCode.value == "CAL")
		{
		//	return true
		}
		else 
		{
			document.<%=formName%>.cusRtlCd.value = "";
			displErr("DD Modal not applicable for your Sales Area");
			return false;
		}
		wherList = whereAdd(wherList, "SW_08", "'DD'");
	}
	else if(cusRtlFl.value == "AD")
	{
	//	displErr("A");
		wherList = whereAdd(wherList, "SW_08", "'AD','UR'");
	}
	else if(cusRtlFl.value == "DD")
	{
	//	displErr("A");
		wherList = whereAdd(wherList, "SW_08", "'DD'");
	}
	else if(cusRtlFl.value == "R")
	{
		wherList = whereAdd(wherList, "SW_06", "'R'");
	}
	else if(cusRtlFl.value == "RR")
	{
		wherList = whereAdd(wherList, "SW_07", "'R'");
	}
//	wherList = whereAdd(wherList, "SW_05", "<%=loginIdM%>");
	
//	alert(wherList);
	rtnValue = setPrmNew("<%=formName%>", srcFldNm, queryCod, rqstType, "DN", wherList, tgtFldNm);
	if (!rtnValue)
		return false;
//	displErr(rtnValue);
	if(newCustS == "Y")
	{
		custCdRtArr = document.getElementById(tgtFldNm).innerText.split("~~");
		document.getElementById(tgtFldNm).innerText = "";

		$("#custCdRt").autocomplete(
		{
			source: custCdRtArr
		});
	}
	else
	{
		cusRtlCdArr = document.getElementById(tgtFldNm).innerText.split("~~");
		document.getElementById(tgtFldNm).innerText = "";

		$("#cusRtlCd").autocomplete(
		{
			source: cusRtlCdArr
		});
	}
//	cusRtlCdHlpChng(cusRtlCdArr);
	return true;
}
function cusRtlCdHlpChng(currObjc)
{
//	displErr(isAndroid.matches);
	var rqstLnth = currObjc.value.split("~");
//	displErr(rqstLnth.length);

	if(rqstLnth.length == "1")
	{
//		displErr(currObjc.value);
		if(document.<%=formName%>.cusRtlFl.value  == "07" || document.<%=formName%>.cusRtlFl.value  == "08")
		{
		   document.<%=formName%>.cusRtlCd.value = currObjc.value;
		}
		else 
		{

		var wherList = "",
			rtnValue = false,
			rqstType = "G";
			queryCod = "MK_01083";
		var srcFldNm = "cusRtlCd",
			newCustS = "",
			tgtFldNm = "cusRtlCdDiv";
			
			wherList = whMasAdd(wherList, "Y");
			wherList = whereAdd(wherList, "SW_04", document.<%=formName%>.areaCode.value);
			wherList = whereAdd(wherList, "SW_09", currObjc.value);

		var rtnVal01 = setPrmNew('<%=formName%>', srcFldNm, queryCod, rqstType, 'DN', wherList, tgtFldNm);
/*
	wherList = whereAdd(wherList, "@__01", document.<%=formName%>.appRtlCd.value); 
	
	rtnKycFl = setPrmNew('<%=formName%>', document.<%=formName%>.appRtlCd.name, 'MK_01096', 'G', 'DN', wherList, 'rtnKycFlDiv');
		displErr(rtnVal01);
*/

		if (!rtnVal01)
			return false;

		custCdRtArr = document.getElementById("cusRtlCdDiv").innerText;
		
		document.getElementById("cusRtlCdDiv").innerText = "";
	///	currObjc	= custCdRtArr;
	//	document.<%=formName%>.cusRtlCd.value = "";
		//	return false;
		document.<%=formName%>.lgtitute.value = custCdRtArr.split("~")[7];
		document.<%=formName%>.latitute.value = custCdRtArr.split("~")[6];
		document.<%=formName%>.locaCapr.value = custCdRtArr.split("~")[5];
		document.getElementById("cusRtlCdDiv").innerText = custCdRtArr.split("~")[1];
		document.<%=formName%>.cusRtlCd.value = custCdRtArr.split("~")[0];
		}
	}
	else
	{
		document.<%=formName%>.lgtitute.value = currObjc.value.split("~")[7];
		document.<%=formName%>.latitute.value = currObjc.value.split("~")[6];
		document.<%=formName%>.locaCapr.value = currObjc.value.split("~")[5];
		document.getElementById("cusRtlCdDiv").innerText = currObjc.value.split("~")[1];
		document.<%=formName%>.cusRtlCd.value = currObjc.value.split("~")[0];
	}

	document.getElementById("cusRtlCdDiv1").innerText = document.getElementById("cusRtlCdDiv").innerText;
	var alValChk = "5";

//	   displErr(compareDateNew(document.<%=formName%>.docuDate.value, "17/05/2020"));
	if(compareDateNew( document.<%=formName%>.docuDate.value, "16/05/2020") > 0  && parseInt(withAlNm) <= parseInt(alValChk))
	{
		if(document.getElementById("lgtitute").value != "NA" && isAndroid.matches && document.getElementById("latitute").value != "NA" && document.<%=formName%>.dsrParam.value == "01")
		{
			var distCalc = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");
			if(distCalc < 520)
				return true;
			else
			{
				displErr("You are not at Customer`s Shop. Please Go to Purchaser Shop and retry. Your Distance from Purchaser's shop : " + distCalc);
	
				document.getElementById("cusRtlCd").value = "";
				
//				withAlNm += 1;

			//	 displErr(withAlNm);
				if(isAndroid.matches)
					getLocation();
				else
					initialise();

				return false;



			}
		}
		else if (document.<%=formName%>.dsrParam.value == "01" && isAndroid.matches)
		{
			displErr("Dear User Please capture retailer / Purchaser's Address First Other wise it is not allowing to update DSR Entry.");

			var openUrln = "/BirlaWhite/Mobile/LatLogCusCp.jsp?popupWin=Y&cusRtlCd=" + document.getElementById("cusRtlCd").value + "&areaCode="+document.<%=formName%>.areaCode.value + "&cusRtlFl=" + document.<%=formName%>.cusRtlFl.value;
			//createModal('Purchaser Location Capture', openUrln);
			location.href = openUrln;
			document.getElementById("cusRtlCdDiv").innerText = "";
			document.getElementById("cusRtlCd").value = "";
		}
	}
}

 function distanceCalDsr(lat1, lon1, lat2, lon2, unit) 
{
	if ((lat1 == lat2) && (lon1 == lon2)) 
	{
		return 0;
	}
	else 
	{
		var radlat1 = Math.PI * lat1/180;
		var radlat2 = Math.PI * lat2/180;
		var theta = lon1-lon2;
		var radtheta = Math.PI * theta/180;
		var dist = "";
			dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
		if (dist > 1) {
			dist = 1;
		}
		dist = Math.acos(dist);
		dist = dist * 180/Math.PI;
		dist = dist * 60 * 1.1515;
		if (unit=="K") { dist = dist * 1.609344 }
		if (unit=="M") { dist = dist * 1.609344 * 1000}
		if (unit=="N") { dist = dist * 0.8684 }
		
		return dist;
	}
}  

function cusRtlCdng(currObjc)
{
//	displErr(currObjc.value);
	var rqstLnth = currObjc.value.split("~");

	if(rqstLnth.length == "1")
	{
		displErr("Please Select Correct Code");
		document.<%=formName%>.custCdRt.value = "";
			return false;
	}
	//	var currObjt = currObjt.value;
	document.getElementById("custCdRtDiv").innerText = currObjc.value.split("~")[1];
	document.getElementById("custCdRt").value = currObjc.value.split("~")[0];
}

function docuDateChkLoc()
{
//	displErr(document.<%=formName%>.docuDate.value.substring(6,10) +"/"+ document.<%=formName%>.docuDate.value.substring(3,5) +"/"+ document.<%=formName%>.docuDate.value.substring(0,2));
//	displErr(dmyTOdmmmy(document.<%=formName%>.docuDate.value));
	if(!isDate(document.<%=formName%>.docuDate, true, "<=today"))
	{
		document.<%=formName%>.docuDate.value = "";
		document.<%=formName%>.docuDate.focus();
		return false;
	}

	var wherList = "";

	wherList = whereAdd(wherList, "@__01", "<%=loginIdM%>"); 
//	wherList = whereAdd(wherList, "@__02", document.<%=formName%>.docuDate.value.substring(6,10) +"/"+ document.<%=formName%>.docuDate.value.substring(3,5) +"/"+ document.<%=formName%>.docuDate.value.substring(0,2)); 
	wherList = whereAdd(wherList, "@__02", dmyTOdmmmy(document.<%=formName%>.docuDate.value)); 
	wherList = whereAdd(wherList, "@__03", "D"); // D for DSR

	var dataRecd = dataLook("<%=formName%>", "docuDate", "MK_02008", 'G', "DN", wherList);
	 

	if(document.getElementById("docuDateDiv").innerText != "OK")
	{
		displErr("Please Put Valid DSR Date. You Can submit DSR only Last Three Days. If You want to submit back date entry Please enter Exception entry(Path : Transcation --> DSR Exception Entry). Take Approval from concerned and Fill DSR Within 3 days after approval.");
		document.getElementById("docuDateDiv").innerHTML = "Please Put Valid DSR Date. You Can submit DSR only Last Three Days. If You want to submit back date entry Please enter Exception entry(Path : <a href='/BirlaWhite/Trans/GenExcp.jsp'>Click Here</a>). Take Approval from concerned and Fill DSR Within 3 days after approval.";
	//	document.<%=formName%>.docuDate.value = "";
		return false;
	}

	return document.getElementById("docuDateDiv").innerText;
}


function customerValid()
{
	if(!textValidApp(document.<%=formName%>.cusRtlFl, '<%=custLabl%> Flag', false))
		return false;
	
	if(!textValidApp(document.<%=formName%>.areaCode, 'Area Code', false))
		return false;

	if(<%=cusCodRq%> && !textValidApp(document.<%=formName%>.cusRtlCd, '<%=custLabl%> Code', false))  
		return false;

	return true;
}


function submitValid(submMthd)
{
	document.<%=formName%>.submMthd.value = submMthd;
	var msgeText = "You have choosen to Submit & " + (submMthd == "A" ? "Add" : "Exit") + ". Press OK to continue";

	if(!textValidApp(document.<%=formName%>.dsrParam, 'Activity Type', false))
		return false;
	
//	displErr(document.<%=formName%>.deptCode.value);
//	displErr(<%=mobilApp%>);
	if(document.<%=formName%>.deptCode.value == "KKR115" && <%=mobilApp%>  == true)
	{
		if(!textValidApp(document.<%=formName%>.FinlRslt, 'Your Address', false))
			return false;
	}
	
	if (<%=cusSelRq%> && !customerValid())  
		return false;

	if(document.<%=formName%>.dsrParam.value == "54") // In Case of Leave allowed Future Entry allowed 
	{
		if(!isDate(document.<%=formName%>.docuDate, false))
			return false;
	}
	else
	{
		if (!isDate(document.<%=formName%>.docuDate, true, "<=today"))
			return false;
	}
/*	
	if (compareDateNew(document.<%=formName%>.docuDate.value, "01/12/2017") < 0)
	{
		displErr("Please select Document Date from 01/12/2017");
		document.<%=formName%>.docuDate.focus();
		return false;
	}
*/
	if(document.<%=formName%>.dsrParam.value == "50") 
	{
		if (!isNumApp(document.<%=formName%>.dsrRem08, "PZ"))
			return false;
		if (!mobileValid(document.<%=formName%>.dsrRem08, false))
		{
			displErr("Please Enter Proper Mobile Number Else this is not count in Retailer Visit");
			return false;
		}
		if (!isNumApp(document.<%=formName%>.dsrRem09, "PZ"))
			return false;
		if (document.<%=formName%>.dsrRem09.value > 3)
		{
			displErr("For a singal Purchaser it can not be greater then 3 Please Enter Proper number of KYC document");
			return false;
		}
	//	displErr("document.<%=formName%>.dsrRem09.value" + document.<%=formName%>.dsrRem09.value);
	}
	var docuDtMs = docuDateChkLoc();

	if(docuDtMs != "OK")
	{
		displErr(docuDtMs);
		document.<%=formName%>.docuDate.focus();
		return false;
	}

	if(document.<%=formName%>.dsrParam.value == "41") 
	{
		if (!isNumApp(document.<%=formName%>.dsrRem01, "PZ"))
			return false;
		if (!isNumApp(document.<%=formName%>.dsrRem02, "PZ"))
			return false;
		if (!isNumApp(document.<%=formName%>.dsrRem03, "PZ"))
			return false;
	}
	if(document.<%=formName%>.dsrParam.value == "50" && document.<%=formName%>.deptCode.value == "KKR115") 
	{
		if (!isNumApp(document.<%=formName%>.dsrRem05, "PZ"))
			return false;
		if (!isNumApp(document.<%=formName%>.dsrRem06, "PZ"))
			return false;
		if (!isNumApp(document.<%=formName%>.dsrRem07, "PZ"))
			return false;
	}

	if(document.<%=formName%>.dsrParam.value == "31" && document.<%=formName%>.deptCode.value == "KKR117") 
	{
	//	displErr("document.<%=formName%>.dsrRem07 : " + document.<%=formName%>.dsrRem07.value);
		if(!textValidApp(document.<%=formName%>.dsrRem07, 'Contact Name', false))
			return false;
		if (!isNumApp(document.<%=formName%>.dsrRem08, "PZ"))
			return false;
	}
	else if(document.<%=formName%>.dsrParam.value == "21" && document.<%=formName%>.deptCode.value == "KKR117") 
	{
	//	displErr("document.<%=formName%>.dsrRem07 : " + document.<%=formName%>.dsrRem07.value);
		if(!textValidApp(document.<%=formName%>.dsrRem05, 'Contact Name', false))
			return false;
		if (!isNumApp(document.<%=formName%>.dsrRem06, "PZ"))
			return false;
	}


	/*if(compareDateNew("<%=sysDateOnly%>", document.<%=formName%>.docuDate.value) > 3) 
	{
		displErr("Difference between Report Date and Today can not be more than 3 days");
		document.<%=formName%>.docuDate.focus();
		return false;
	}
	*/

	if (!txtValLBlnk(document.<%=formName%>.dsrRem01, "<%=dsrRemAr[0]%>", 500, true, true)) return false; 
	if (!txtValLBlnk(document.<%=formName%>.dsrRem02, "<%=dsrRemAr[1]%>", 500, true, true)) return false;
	if (!txtValLBlnk(document.<%=formName%>.dsrRem03, "<%=dsrRemAr[2]%>", 500, true, true)) return false;
	if (!txtValLBlnk(document.<%=formName%>.dsrRem04, "<%=dsrRemAr[3]%>", 500, true, true)) return false;
	if (!txtValLBlnk(document.<%=formName%>.dsrRem05, "<%=dsrRemAr[4]%>", 500, true, true)) return false;
	if (!txtValLBlnk(document.<%=formName%>.dsrRem05, "<%=dsrRemAr[5]%>", 500, true, true)) return false;
	if (!txtValLBlnk(document.<%=formName%>.dsrRem05, "<%=dsrRemAr[6]%>", 500, true, true)) return false;
	if (!txtValLBlnk(document.<%=formName%>.dsrRem05, "<%=dsrRemAr[7]%>", 500, true, true)) return false;
	

	if(document.<%=formName%>.serNumbr != null)
	{
//		displErr(document.<%=formName%>.serNumbr.length);
		var rowLen = document.<%=formName%>.serNumbr.length;
		var abcLen = document.<%=formName%>.serNumbr.length;

		if(rowLen == null)
			rowLen = 1;

		var fldIndex = "",
			count = 0;
		var dtlDupAr = new Array();	
		var dtSrchKy = "";	

		for(var ck=0; ck<rowLen; ck++)
		{
			if(abcLen == null)
				fldIndex = document.<%=formName%>.serNumbr.value;
			else
				fldIndex = document.<%=formName%>.serNumbr[ck].value;

			if (!txtValLBlnk(eval("document.<%=formName%>.actnRemk" + fldIndex), "Action Remarks", 100, true, true)) 
				return false;

			if (!isNumApp(eval("document.<%=formName%>.prodQnty" + fldIndex), "PZ"))
				return false;

			if (!isNumApp(eval("document.<%=formName%>.projQnty" + fldIndex), "PZ"))
				return false;
			if("<%=dsrParam%>" == "01")
			{

			if (!txtValLBlnk(eval("document.<%=formName%>.repoDesc" + fldIndex), "Prodcut Code", 100, true, true)) 
				return false;
			if (!txtValLBlnk(eval("document.<%=formName%>.catgPack" + fldIndex), "Prodcut Code", 100, true, true)) 
				return false;
	//			displErr(document.getElementById("repoDesc" + fldIndex + "Div").innerText);
				//repoDescPop
				dtSrchKy = eval("document.<%=formName%>.catgPack" + fldIndex).value;
				if (isDupDtlVal(dtlDupAr, "document.<%=formName%>.catgPack" + fldIndex, dtSrchKy))
				{
					displErr("Please Check Duplicate Invoice. Product Code : " + document.getElementById("repoDesc" + fldIndex + "Div").innerText);
					return false;
				}
				dtlDupAr[ck] = dtSrchKy;
			}
		}
	}

//	displErr("document.<%=formName%>.dsrRem09.value" + document.<%=formName%>.dsrRem09.value);
	
	if(document.<%=formName%>.dsrParam.value == "50") 
	{
		if(!textValidApp(document.<%=formName%>.district, 'District Name', false))
			return false;
		if(!textValidApp(document.<%=formName%>.pinCodeN, 'Pin Name', false))
			return false;
		if(!textValidApp(document.<%=formName%>.cityName, 'City Name', false))
			return false;
		if(!textValidApp(document.<%=formName%>.cstBisTy, 'Counter Type', false))
			return false;

		if(document.<%=formName%>.cusRtlFl.value == "R" || document.<%=formName%>.cusRtlFl.value == "RR")
		{
			if(!textValidApp(document.<%=formName%>.custCdRt, 'Nearest Stockiest', false))
			return false;
		}

	}
/*	
	if(document.<%=formName%>.dsrParam.value == "50" || document.<%=formName%>.dsrParam.value == "01") 
	{
		if(document.<%=formName%>.serNumMk != null)
		{
			var rowLen1 = document.<%=formName%>.serNumMk.length;
			var abcLen1 = document.<%=formName%>.serNumMk.length;

			if(rowLen1 == null)
				rowLen1 = 1;

			var fldIndex1 = "";

			for(var i=0; i<rowLen1; i++)
			{
				if(abcLen == null)
					fldIndex1 = document.<%=formName%>.serNumMk.value;
				else
					fldIndex1 = document.<%=formName%>.serNumMk[i].value;
	
				if (!isNumApp(eval("document.<%=formName%>.prodQntyMk" + fldIndex1), "PZ"))
					return false;

				if (!isNumApp(eval("document.<%=formName%>.projQntyMk" + fldIndex1), "PZ"))
					return false;
			}
		}
	}


	if (count == 0)
	{
		displErr("Please enter atleast 1 Detail to Save");
		return false;
	}
*/

	if (!subValidCom("<%=formName%>"))
		return false;


	displSav(msgeText);
	return false;
}

function frmSubmt(val) // For Common Submit Function 
{
//	enableDisable("cityName", "E", false, false);
//	enableDisable("district", "E", false, false);

//	document.<%=formName%>.docuDate.value = dmyTOdmmmy(document.<%=formName%>.docuDate.value);

	if (val)
	{
		document.<%=formName%>.method = "POST";
		document.<%=formName%>.action = "DSRActvS.jsp"; 
		document.<%=formName%>.submit();
	}
} 

var lat, lng, address;

function initiate_geolocation() 
{
	navigator.geolocation.getCurrentPosition(handle_geolocation_query);
}

function handle_geolocation_query(position)
{
	lat = position.coords.latitude;	//To
	document.getElementById("geoLatit").value = lat; 
	lng = position.coords.longitude;
	document.getElementById("geoLongt").value = lng;
}

function GetAddress() 
{
var latlng = new google.maps.LatLng(lat, lng);
var geocoder = geocoder = new google.maps.Geocoder();

geocoder.geocode({ 'latLng': latlng }, function (results, status) 
{
	if (status == google.maps.GeocoderStatus.OK) 
	{
		if (results[1]) 
		{
			address = results[1].formatted_address;
			document.getElementById("FinlRslt").value = address; 
			$("#finlRsltDiv").show();
		}
	}
	else 
	{
		$("#finlRsltDiv").hide();
	//	displErr("Geocoder failed due to: " + status + " Please Enable Location");
	}

});
}

if(<%=mobilApp%>  == true)
{
	$(function()
	{
	initiate_geolocation();

	setTimeout(function(){
	  GetAddress();
	}, 3000);

	});	
}

$("#messgae").click();
</script>
<%
if(!mobilApp && 1 != 1)
{
%>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
			<iframe src="" id="modeliframe" frameborder="0" height="450" width="99.6%"></iframe>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<%
}
%>
<script>
function initMap() 
{
var map = new google.maps.Map(document.getElementById('map'), 
{
  zoom: 15,
  center: {lat: 40.731, lng: -73.997}
});
var geocoder = new google.maps.Geocoder;
var infowindow = new google.maps.InfoWindow;

  (geocoder, map, infowindow);

}
var mylatlng = "";

function getLocation() 
{
	withAlNm += 1;

	var getLocan = Android.trunOnGPSLoca();
	
setTimeout(function()
{
	var AndroidVL = Android.setLatLong();
//	displErr(AndroidVL);
	document.getElementById("latlng").value = AndroidVL;

	if(document.getElementById("latlng").value == "")
	{
		initialiseMap();initialise();
	}
	
	var latlng = AndroidVL.split(",");
//	var latlng = "";

	document.getElementById("geoLatit").value =    latlng[0];
	document.getElementById("geoLongt").value = 	latlng[1];

	//	mylatlng = 	{lat: 26.6062318, lng: 73.6853633};
	//	document.getElementById("latlng").value = "26.6062318,73.6853633";
		mylatlng = 	{lat: parseFloat(latlng[0]), lng: parseFloat(latlng[1])};

	var map = new google.maps.Map(document.getElementById("map"), 
	{
		zoom: 18,
//	    center = bounds.getCenter(),

		center: mylatlng
	});
	var geocoder = new google.maps.Geocoder;
	var infowindow = new google.maps.InfoWindow;
	var marker = new google.maps.Marker({position: mylatlng, map: map});
	var infoWindow = new google.maps.InfoWindow(
    //        {content: '', position: mylatlng}
	);
	geocodeLatLng(geocoder, map, infowindow);
        // Configure the click listener.
}, 3000);
}

function getLocationScript() 
{
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } 
  
}

function showPosition(position) 
{
	document.getElementById("latlng").value = position.coords.latitude + "," + position.coords.longitude;
	document.getElementById("geoLatit").value =     position.coords.latitude;
	document.getElementById("geoLongt").value = 	position.coords.longitude;

		mylatlng = 	{lat: position.coords.latitude, lng: position.coords.longitude};

	var map = new google.maps.Map(document.getElementById("map"), 
	{
		zoom: 18,
//	    center = bounds.getCenter(),

		center: mylatlng
	});
	var geocoder = new google.maps.Geocoder;
	var infowindow = new google.maps.InfoWindow;
	var marker = new google.maps.Marker({position: mylatlng, map: map});
	var infoWindow = new google.maps.InfoWindow(
    //        {content: '', position: mylatlng}
	);

		infoWindow.open(map);
				map.addListener('click', function(mapsMouseEvent) 
				{
				  // Close the current InfoWindow.
				  infoWindow.close();

				  // Create a new InfoWindow.
				  infoWindow = new google.maps.InfoWindow({position: mapsMouseEvent.latLng});
				  infoWindow.setContent(mapsMouseEvent.latLng.toString());
				
				  document.getElementById("googleValue").innerHTML = mapsMouseEvent.latLng.toString();
					
				   maulValuAsn(mapsMouseEvent.latLng.toString());

				  infoWindow.open(map);
				});	
		geocodeLatLng(geocoder, map, infowindow);
        // Configure the click listener.             
}

		function initialiseMap()
		{
			/*
			var myOptions = {
			      zoom: 4,
			      mapTypeControl: true,
			     // mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
			      navigationControl: true,
			    //  navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
//			      mapTypeId: google.maps.MapTypeId.ROADMAP      
			    }	
			map = new google.maps.Map(document.getElementById("map"), myOptions);
			*/
		}
		function initialise()
		{
			withAlNm += 1;
			if(geoPosition.init())
			{
				document.getElementById('current').innerHTML="Receiving...";
				geoPosition.getCurrentPosition(showPositionNew,function(){document.getElementById('current').innerHTML="Couldn't get location"},{enableHighAccuracy:true});
			}
			else
			{
				document.getElementById('current').innerHTML="Functionality not available";
			}
		}

		function showPositionNew(p)
		{
			var latitude = parseFloat( p.coords.latitude );
			var longitude = parseFloat( p.coords.longitude );
			document.getElementById('current').innerHTML="latitude=" + latitude + " longitude=" + longitude;

			document.getElementById("geoLatit").value = latitude;
			document.getElementById("geoLongt").value = longitude;

			var pos=new google.maps.LatLng( latitude , longitude);
			map.setCenter(pos);
			map.setZoom(14);
			
			var infowindow = new google.maps.InfoWindow({
			    content: "<strong>yes</strong>"
			});

			var marker = new google.maps.Marker({
			    position: pos,
			    map: map,
			    title:"You are here"
			});
			
			displMap();

			google.maps.event.addListener(marker, 'click', function() {
			  infowindow.open(map,marker);


			});
		}

if(isAndroid.matches)
	 getLocation();
else
{
	 initialiseMap();initialise();
}

if("<%=mobilApp%>" == "true")
{
	$(function()
	{
		setTimeout(function()
		{
			if(document.getElementById('geoLatit').value == "" || document.getElementById('geoLongt').value == "") 
				initialiseMap();initialise();
		}, 6000);

	});	
}


function geocodeLatLng(geocoder, map, infowindow) 
{
	var input = document.getElementById('latlng').value;
	var latlngStr = input.split(',', 2);
	var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
	geocoder.geocode({'location': latlng}, function(results, status) 
	{
	  if (status === 'OK') 
	  {
		if (results[0]) 
		{
		  map.setZoom(19);
		  var marker = new google.maps.Marker({
			position: latlng,
			map: map
		  });
		  infowindow.setContent(results[0].formatted_address);
		  infowindow.open(map, marker);
		}
		else 
		{
	//	  window.displErr('No results found');
		}
  } 
	else 
	{
//		window.displErr('Geocoder failed due to: ' + status);
	}
});
}

</script>
	<div align="center">
		<ion-button color="primary"   onclick="return initialise()">Again Get Location</ion-button>
	</div>

<input type="hidden" name="custName" id="custName" value="<%=custName%>"><div id="custNameDiv"></div>
</div>

<!-- Form footer Starts --->
<jsp:include page="/Envr/JSP/FooterCom.jsp" flush="true"/>
<!-- Form footer Ends --->
<script>
getLocation();
if("<%=message%>" != "")
{
	locationChk();
}

function locationChk()
{
	setTimeout(function()
	{
		var distCalc = distanceCalDsr(document.getElementById("latitute").value, document.getElementById("lgtitute").value, document.getElementById("geoLatit").value, document.getElementById("geoLongt").value, "M");
		if(distCalc < 520)
			return true;
		else
		{
			displErr("You are not at Customer`s Shop. Please Go to Purchaser Shop and retry. Your Distance from Purchaser's shop : " + distCalc);

			document.getElementById("cusRtlCd").value = "";
			
			if(isAndroid.matches)
				getLocation();
			else
				initialise();

			return false;
		}
	}, 9000);  
}
</script>
