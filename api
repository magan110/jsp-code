<%@ include file="/Envr/JSP/SecurityCom.jsp"%>

<%
ResultSet rset = null;
ResultSetMetaData rsmd = null;

String 	areaCode = "",
		whreArea = "",
		sql = "",
		whreCond = "",
		formName = "AcvtSumm",
		optionFg = "",
		areaPage = "",
		detlPage = "/BirlaWhite/CASC/Reports/AcvtSumm.jsp",
		compPage = "/BirlaWhite/CASC/Reports/complainDetl.jsp",
		custPage = "/BirlaWhite/CASC/Reports/custVocDtl.jsp",
		smapPage = "/BirlaWhite/CASC/Reports/sampLingCust.jsp",
		infcPage = "/BirlaWhite/CASC/Reports/influDtl.jsp",
		siteTnPg = "/BirlaWhite/CASC/Reports/AcvtWseSumm.jsp",
		partPage = "/BirlaWhite/CASC/Reports/partiActSum.jsp",
		stateFlg = "",
		strtDate = "",
		whreArCn = "",
		endgDate = "",
		znArStng = "",
		zoneFlag = "Y",
		areaFlag = "",
		repoType = "",
		znArStTy = "",
		znArStCl = "",
		znArCdSt = "",
		znArStCd = "",
		repoTyp1 = "3",
		znArStDs = "",
		znStArAr[] = null,
		dataVal1[] = null;

int     applictr = 0,
		siteTran = 0,
		archTech = 0,
		painMasn = 0,
		yuvaPrst = 0,
		govtDept = 0,
		brandApr = 0,
		ubsMeets = 0,
		exhibtin = 0,
		yuvaRatn = 0,
		sampling = 0,
		custVoic = 0,
		retlMeet = 0,
		counterM = 0,
		apCoMeet = 0,
		complain = 0,
		eMetMeet = 0,
		totalKyc = 0,
		fulKycTt = 0,
		parKycTt = 0,
		refsSite = 0,
		saleTrng = 0,
		emplTrng = 0,
		totalKycTot = 0,
		fulKycTtTot = 0,
		parKycTtTot = 0,
		eMetMeetTot = 0,
		applictrTot = 0,
		yuvaPrstTot = 0,
		siteTranTot = 0,
		archTechTot = 0,
		painMasnTot = 0,
		brandAprTot = 0,
		govtDeptTot = 0,
		ubsMeetsTot = 0,
		exhibtinTot = 0,
		custVoicTot = 0,
		complainTot = 0,
		samplingTot = 0,
		retlMeetTot = 0,
		counterMTot = 0,
		noOfColm = 0,
		apCoMeetTot = 0;


double prodQnty = 0.00,
	prodQntyTot = 0.00,
	znstarre [][] = new double [2][17];

if (XssFilter.parSmGet("repoType") != null)
	repoType = XssFilter.parSmGet("repoType");
if (XssFilter.parSmGet("znArStTy") != null)
	znArStTy = XssFilter.parSmGet("znArStTy");
if (XssFilter.parSmGet("repoTyp1") != null)
	repoTyp1 = XssFilter.parSmGet("repoTyp1");
if (XssFilter.parSmGet("strtDate") != null)
	strtDate = XssFilter.parSmGet("strtDate");
if (XssFilter.parSmGet("endgDate") != null)
	endgDate = XssFilter.parSmGet("endgDate");
if (XssFilter.parSmGet("areaCode") != null)
	areaCode = XssFilter.parSmGet("areaCode");
if(XssFilter.parSmGet("areaFlag")!=null)
	areaFlag = XssFilter.parSmGet("areaFlag");
if(XssFilter.parSmGet("znArStDs")!=null)
	znArStDs = XssFilter.parSmGet("znArStDs");
if(XssFilter.parSmGet("zoneFlag")!=null)
	zoneFlag = XssFilter.parSmGet("zoneFlag");
if(XssFilter.parSmGet("stateFlg")!=null)
	stateFlg = XssFilter.parSmGet("stateFlg");



if(!areaCode.equals(""))
{
  whreCond = " and dbo.cofDocNoVal(docuNumb, 'O') = '" + areaCode + "'";
  whreArea = " and a.areaCode = '" + areaCode + "'";
  whreArCn = " and dbo.wcfLoginVal('A', a.createId) = '" + areaCode + "'";
}

if(stateFlg.equals("Y"))
{
	znArStCl = "State Desc";

	if(repoType.equals("S"))
	{
		znArStng = "b.statDesc ";
		znArCdSt = "b.stateCod";
	}
	else
	{
		znArStng = "b.stLgcDes ";
		znArCdSt = "b.stLgcCod";
	}
	whreCond = " and b.zoneDesc = '" + znArStDs + "' ";
	whreArea = " and b.zoneDesc = '" + znArStDs + "' ";
	whreArCn = " and b.zoneDesc = '" + znArStDs + "' ";
	zoneFlag = "";
}
else if(areaFlag.equals("Y"))
{
	znArStCl = "Area Desc";
	znArStng = "b.zoneDesc + ' - ' + b.areaDesc + ' ~ ' + dbo.wcfLoginVal('N', a.createId) ";
	znArCdSt = "b.areaCode";
	if(repoType.equals("S"))
	{
		whreCond = "and b.statDesc = '" + znArStDs + "' ";
		whreArea = "and b.statDesc = '" + znArStDs + "' ";
	}
	else
	{
//		whreCond = "and b.stLgcDes = '" + znArStDs + "' ";
//		whreArea = "and b.stLgcDes = '" + znArStDs + "' ";
	}
//	whreArCn = " and b.zoneDesc = '" + znArStDs + "' ";
	areaFlag = "Y";
	zoneFlag = "";
}
else if(zoneFlag.equals("Y"))
{
	znArStCl = "Zone Desc";
	znArStng = " b.zoneDesc";
	znArCdSt = " b.zoneCode";
}
whreCond += "and dbo.cofDocNoVal(docuNumb, 'O') in (" + WebSessBean.resArStrGet() + ") ";
whreArea += "and a.areaCode in (" + WebSessBean.resArStrGet() + ") ";
whreArCn += "and dbo.wcfLoginVal('A', a.createId) in (" + WebSessBean.resArStrGet() + ") ";
%>
<script type="text/javascript" language="javascript1.2">
var lineSkip = 1;

function refreshed()
{
	if (!isDate(document.<%=formName%>.strtDate, true, "<=today"))
		return false;

	if (!isDate(document.<%=formName%>.endgDate, true, "<=today"))
		return false;

	if (compareDate(document.<%=formName%>.strtDate.value, document.<%=formName%>.endgDate.value))
	{
		alert("End Date cannot be less than Start Date");
		document.<%=formName%>.endgDate.focus();
		return false;
	}
	document.<%=formName%>.refresh.disabled = true;
	document.<%=formName%>.method = "POST";
	document.<%=formName%>.action = "<%=formName%>.jsp";
	document.<%=formName%>.submit();
}
</script>
<!-- Header Starts -->
<jsp:include page="/Envr/JSP/HeaderCom.jsp" flush="true">
	<jsp:param name="mobFrend" value="B"/>
	<jsp:param name="pagTypRp" value="Y"/>
</jsp:include>
<!-- Header Ends -->
<form name="<%=formName%>">
<div class="card card-xl-stretch p-6 pt-2">
	<div class="row">
		<div class="col-xl-3">
			<label>Report Type</label>
			<select name="repoTyp1">
				<%=GenrlSuper.getProcessType("1,2,3,4,5,7,47", "Zone Wise, Logical State Wise, Area Wise, Employee Wise - Area Wise, State Wise, Employee Wise Total - Summary, Employee wise - Sampling & Conversion ", repoTyp1)%>
			</select>
		</div>
		<div class="col-xl-3">
			<label>Start Date</label>
			<input type="text" name="strtDate" size="10" maxlength="10" value="<%=strtDate%>" onClick="showCal('<%=formName%>','strtDate')" onChange="return isDate(document.<%=formName%>.strtDate, true, '<=today')" onfocus='setAccessKey(this,"calSD")'>
		</div>
		<div class="col-xl-3">
			<label>End Date</label>
			<input type="text" name="endgDate" size="10" maxlength="10" value="<%=endgDate%>" onClick="showCal('<%=formName%>','endgDate')" onChange="isDate(document.<%=formName%>.endgDate, true, '<=today')" onfocus='setAccessKey(this, "calED")'>
		</div>
		<div class="col-xl-3">
			<input type="button" name="refresh" value="Go" class="btn btn-primary" onClick="refreshed()">
			<label>As on <%=sdf.format(calendar.getTime())%></label>
		</div>
	</div>
		<script type="text/javascript" language="javascript1.2">
			if (document.<%=formName%>.endgDate.value == "")
				document.<%=formName%>.endgDate.value = getTodayDate();
		</script>
<%


try
{
	if(!strtDate.equals("") && !endgDate.equals(""))
	{
		sql = "exec dppCascRprt '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "', '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "', " + repoTyp1 + ", '" + loginIdM + "', '" + znArStTy + "',  ''  ";
		rset = WebSessBean.selectRecord(sql);
		out.println(sql);

		rsmd = rset.getMetaData();
		noOfColm = rsmd.getColumnCount();
		//out.println(noOfColm);
%>
<div class="table-responsive">
 <table class="table" id="excelTable">
  <thead>
  	<tr>
<%
		for (int i=1; i <= noOfColm; i++)
		{
			if(i == 1)
			{
				if(!repoTyp1.equals("1"))
				{

					out.println("<th id='th'>Zone</th>");
			//		out.println("<th id='th'>State</th>");
					if(!(repoTyp1.equals("2") || repoTyp1.equals("5")))
					{
						out.println("<th id='th'>State</th>");
					}
					if(repoTyp1.equals("4"))
					{
						out.println("<th id='th'>Area</th>");
						out.println("<th id='th'>Employee Name</th>");
						out.println("<th id='th'>Code</th>");
						out.println("<th id='th'>Active Status</th>");
					}
					if(repoTyp1.equals("7"))
					{
						//out.println("<th id='th'>Area</th>");
						out.println("<th id='th'>Employee Name</th>"); 
						out.println("<th id='th'>Employee Code</th>"); 
						out.println("<th id='th'>Department</th>");
						out.println("<th id='th'>Designation</th>");
						out.println("<th id='th'></th>");
					}
					if(repoTyp1.equals("47"))
					{
						out.println("<th id='th'>Area</th>");
						out.println("<th id='th'>Employee Name</th>");
						out.println("<th id='th'>Code</th>");
						out.println("<th id='th'>Active Status</th>");
					}
				}
			}
			out.println("<th id='th'>" + rsmd.getColumnName(i) + "</th>");
		}
%>
	</tr>
  </thead>
  <tbody>
<%

		while(rset.next())
		{
			out.println("<tr>");
			for (int i=1; i <= noOfColm; i++)
			{
				znArStDs = rset.getString(1);
				//out.println(znArStDs);
				if(!repoTyp1.equals("1") && znArStDs != null)
				{
					znStArAr  = znArStDs.split("~");
				}
				if(i == 1)
				{
					if(znArStDs.equals("ZATotal"))
						out.println("<td>Total Central, North, East & Export</td>");
					else if(znArStDs.equals("ZBTotal"))
						out.println("<td>Total South,West A, B Zone</td>");
					else 
					{
						if(!repoTyp1.equals("1"))
						{
				//			System.out.println("3 " + znStArAr.length);
							out.println("<td>" + znStArAr[0] + "</td>");
							if(!(repoTyp1.equals("2") || repoTyp1.equals("5")))
							{
								out.println("<td>" + znStArAr[1].substring(2) + "</td>");
								if(!(repoTyp1.equals("3")))
								{
									out.println("<td>" + znStArAr[2].substring(2) + "</td>");
									out.println("<td>" + znStArAr[3] + "</td>");
									out.println("<td>" + znStArAr[4] + "</td>");
									out.println("<td>" + znStArAr[5] + "</td>");
									//out.println("<td>" + znStArAr[5] + "</td>");
								}
								if((repoTyp1.equals("7")))
								{
								//	out.println("<td>" + znStArAr[3] + "</td>");
								//	out.println("<td>" + znStArAr[4] + "</td>");
									out.println("<td>" + znStArAr[5] + "</td>");
								}
							}
						}
						out.println("<td>" + (repoTyp1.equals("1") ? znArStDs.substring(2) : znStArAr[znStArAr.length-1]) + "</td>");

					}
				}
				else 
				{
					znArCdSt = rset.getString(i);
					dataVal1 = znArCdSt.split("~");

		//			System.out.println(i + " " + dataVal1[1] + " " + dataVal1[1].length() + " " + dataVal1[1].equals("00")) ;
					
					if(dataVal1[1].trim().equals("00") || dataVal1[1].trim().equals("001") || dataVal1[1].trim().equals("002") || dataVal1[1].trim().equals("003") || dataVal1[1].trim().equals("004") || dataVal1[1].trim().equals("005") || dataVal1[1].trim().equals("006") || dataVal1[1].trim().equals("010") || dataVal1[1].trim().equals("011") || dataVal1[1].trim().equals("012") ||
						dataVal1[1].trim().equals("019")) 
					{
					   detlPage = infcPage;
					}
					else if(dataVal1[1].trim().equals("008"))
					{
					   detlPage = smapPage;
					}
					else if(dataVal1[1].trim().equals("009"))
					{
					   detlPage = smapPage;
					}
					else if(dataVal1[1].trim().equals("CC"))
					{
					   detlPage = compPage;
					}
					else if(dataVal1[1].trim().equals("CV"))
					{
					   detlPage = custPage;
					}
					else if(dataVal1[1].trim().equals("11P") || dataVal1[1].trim().equals("P03")
						|| dataVal1[1].trim().equals("P12") || dataVal1[1].trim().equals("P06")
						|| dataVal1[1].trim().equals("P10") || dataVal1[1].trim().equals("P11")
						|| dataVal1[1].trim().equals("P18") || dataVal1[1].trim().equals("P02")
						|| dataVal1[1].trim().equals("P05") || dataVal1[1].trim().equals("P22")
						|| dataVal1[1].trim().equals("P01") || dataVal1[1].trim().equals("P17")
						|| dataVal1[1].trim().equals("P24") || dataVal1[1].trim().equals("P15")
						|| dataVal1[1].trim().equals("P16") || dataVal1[1].trim().equals("P23")
						|| dataVal1[1].trim().equals("P27") || dataVal1[1].trim().equals("P19")
						|| dataVal1[1].trim().equals("P21") || dataVal1[1].trim().equals("P60"))
					{
					   detlPage = partPage;
					}
					else
					{
					   detlPage = siteTnPg;
					}

						if ((loginIdM.equals("PZ6910") || loginIdM.equals("1325") || loginIdM.equals("2675") || loginIdM.equals("PZ6590") || loginIdM.equals("3597") || loginIdM.equals("3769") || loginIdM.equals("3335") || loginIdM.equals("3141") || loginIdM.equals("2617") || loginIdM.equals("3722")) &&
						!(dataVal1[1].trim().equals("001") || dataVal1[1].trim().equals("002") ||
						  dataVal1[1].trim().equals("003") || dataVal1[1].trim().equals("07") ||
						  dataVal1[1].trim().equals("025") || dataVal1[1].trim().equals("026") ||
						  dataVal1[1].trim().equals("M03") || dataVal1[1].trim().equals("M08") ||
						  dataVal1[1].trim().equals("M09") || dataVal1[1].trim().equals("NAI") || dataVal1[1].trim().equals("20")))
					{
						// Show hyperlink if dataVal1[1] is not in the list and loginIdM is in the allowed list
						out.println("<td><a onclick=\"openClickWind('" + detlPage +
						  "?strtDate=" + strtDate +
						  "&endgDate=" + endgDate +
						  "&caaActTy=" + dataVal1[1].trim() +
						  "&znArStTy=" + (repoTyp1.trim().equals("1") ? znArStDs.substring(2) : znStArAr[znStArAr.length-1]) +
						  "&repoType=" + repoType +
						  "&repoTyp1=" + (Integer.parseInt(repoTyp1)) + "')\">" +
						  dataVal1[0] +
						  "</a></td>");
					} 
					else 
					{
						// Show plain text
						out.println("<td>" + dataVal1[0] + "</td>");
					}
					

				}
			}
			out.println("</tr>");
		}
	}
}
catch(Exception e)
{
	throw new Exception("Error in Selecting details in " + pageAddress + e.toString() + sql + znArCdSt);
}
%>
<script type="text/javascript" language="javascript1.2">
	document.<%=formName%>.refresh.disabled = false;
</script>
</tbody>
</table>
</div>
</div>
<!-- Footer Starts -->
<jsp:include page="/Envr/JSP/FooterCom.jsp?excelFlg=false" flush="true"/>
<!-- Footer Ends -->
