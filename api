<%@ include file="/Envr/JSP/SecurityCom.jsp"%>

<%

CallableStatement cstmt = null;
ResultSet rset = null;
ResultSetMetaData rsmd = null;

String 	mnthYear = "",
		formName = "EmplDashBrd",
		mnthNumb = "",
		repCatDs = "",
		csRtCode = "",
		custClub = "",
		areaCode = "",
		custName = "",
		custType = "",
		custCode = "",
		sapCusCd = "",
		genTrNtr = "",
		securDep = "",
		trgtValu = "",
		achvValu = "",
		repoDesc = "",
		prodCode = "",
		mrgRepDs = "",
		balancQt = "",
		mrgRepCtS = "",
		impParam[] = null,
		outTable[][] = null,
		mrgRepCt = "",
		strtDate = "",
		endgDate = "",
		tmpField = "",
		repoCatg = "01",
		datSycDt = "NA",
		repoCtAl = "",
		queryCod = "3",
	//	prodDesc[] = null,
		siteMkRp = "M",
		chrSpcAr[][] = null,
		chrSerAr[][] = null,
		sql = "";

int  totlMpRt = 0,
	 totlMpSt = 0,
	 totlMpAU = 0,
	 kycVrRtl = 0,
	 teleCallRt = 0,
	 teleCallSt = 0,
	 prsnlVstRt = 0,
	 prsnlVstSt = 0,
	 unqRetlVst = 0,
	 unqMapRtVs = 0,
	 ttlMapRt = 0,
	 bild1Mnt = 0,
	 bild3Mnt = 0,
	 bild6Mnt = 0,
	 bildCurM = 0,
	 nevrBill = 0;

if (XssFilter.parSmGet("custCode") != null)
	custCode = XssFilter.parSmGet("custCode");
if (XssFilter.parSmGet("areaCode") != null)
	areaCode = XssFilter.parSmGet("areaCode");
if (XssFilter.parSmGet("csRtCode") != null)
	csRtCode = XssFilter.parSmGet("csRtCode");

if (log.getUserType().equals("C"))
{
	custCode = loginIdM;
	areaCode = log.getArCode();
}
if (XssFilter.parSmGet("endgDate") != null)
	endgDate = XssFilter.parSmGet("endgDate");
if (XssFilter.parSmGet("strtDate") != null)
	strtDate = XssFilter.parSmGet("strtDate");

sql = "select CONVERT(VARCHAR(10),DATEADD(dd,-(DAY(getdate())-1),getdate()),103), convert(varchar(10), getdate(), 103), convert(varchar(11), DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE())-1, 0), 113),  convert(varchar(11), getdate(), 113)";
rset = WebSessBean.selectRecord(sql);
rset.next();
if(strtDate.equals(""))
{
	strtDate = rset.getString(1);
	endgDate = rset.getString(2);
}

%>

<!-- Header Display Area Begin -->
<jsp:include page="/Envr/JSP/HeaderCom.jsp" flush="true">
		<jsp:param name="mobFrend" value="B"/>
</jsp:include>

	<script src="/Envr/js/chartJS/mimaCharts.js"></script>
	<script src="/Envr/js/chartJS/tests.js"></script>

<!-- Header Display Area Ends -->
<script type="text/javascript" language="javascript">
function refreshed()
{
//	document.<%=formName%>.custCode.value = document.<%=formName%>.csRtCode.value.substring(0,8);
	document.<%=formName%>.method = "POST";
	document.<%=formName%>.action = "<%=formName%>.jsp";
	document.<%=formName%>.submit();
}
function csRtCodePop()
{
	var srcFldNm = "areaCode",
		tgtFldNm = srcFldNm + "Div";

	areaCode = document.<%=formName%>.areaCode.value;

	if (areaCode == "")
		return false;

	document.<%=formName%>.csRtCode.value = "";

	var rtnValue = cusRtlArHlp("<%=formName%>", srcFldNm, "C", "Y");
	if (!rtnValue)
		return false;

	var csRtCodeArr = document.getElementById(tgtFldNm).innerText.split(splitChr);
	document.getElementById(tgtFldNm).innerText = "";
	$( "#csRtCode" ).autocomplete({
		source: csRtCodeArr
	});

	return true;
}
var trgtValu = "",
	achvValu = "",
	charts = "";
</script>

<form name="<%=formName%>">
<div class="row">
	<div class="card row">
		<div class="form-group col-md-3">
			<label class="control-label float-sm-left"  for="mnthYear">Start Date:</label>
			<input type="text" name="strtDate" size="10" maxlength="10" value="<%=strtDate%>" onChange="return isDate(this, true, '<=today')" onfocus='setAccessKey(this,"calSD")' onClick="showCal('<%=formName%>','strtDate')">
		</div>
		<div class="form-group col-md-3">
			<label class="control-label float-sm-left"  for="mnthYear">End Date:</label>
			<div class="input-group mb-3">
				<input type="text" name="endgDate" size="10" maxlength="10" value="<%=endgDate%>" onChange="return isDate(this, true, '<=today')" onfocus='setAccessKey(this, "calED")' onClick="showCal('<%=formName%>','endgDate')">
			<div class="input-group-append">
				<input type="button" name="refresh" value="Go" class="btn btn-primary" onClick="refreshed()"> 
			</div>
			</div>
		</div>
	</div>
</div>
<input type="hidden" name="custCode" value="">
<input type="hidden" name="csRtCode" value="">
<input type="hidden" name="areaCode" value="<%=areaCode%>">
<%
if(loginIdM.equals("2948") || loginIdM.equals("0652") || loginIdM.equals("2954") )
	loginIdM = "3676";
%>
<div class="row">
<%
try
{
	sql = "select sum(case when custType in ('RR','RT','DD','AD','UR') then 1 else 0 end) as mapRtlCd, sum(case when custType in ('ST','RD') then 1 else 0 end) as mapStcst, sum(case when custType in ('AD','UR') then 1 else 0 end) as mapAdUr, sum(case when kycVerFl = 'Y' then 1 else 0 end) as kycVrRtl  "
		+ "from dpvConcEmpl a with (nolock)	"
		+ "where a.custAcSt = 'Y' "
		+ "and   a.concEmpl = '" + loginIdM + "' ";
	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
		totlMpRt = rset.getInt(1);
		totlMpSt = rset.getInt(2);
		totlMpAU = rset.getInt(3);	//AD UR
		kycVrRtl = rset.getInt(4);
	}

	sql = "select sum(case when dsrParam in ('02', '04') and custType in ('RR','RT','DD','AD','UR') then 1 else 0 end) as teleCall, 		sum(case when dsrParam in ('02', '04') and custType in ('ST','RD') then 1 else 0 end) as teleCall, 		sum(case when dsrParam in ('01', '05') and custType in ('RR','RT','DD','AD','UR') then 1 else 0 end), sum(case when dsrParam in ('01', '05') and custType in ('ST','RD') then 1 else 0 end),  "
		+ "count(distinct case when dsrParam in ('01', '05') and custType in ('RR','RT','DD','AD','UR') then a.cusRtlCd else null end), "
		+ "count(distinct case when dsrParam in ('01', '05') and custType in ('RR','RT','DD','AD','UR') and a.createId = b.concEmpl then a.cusRtlCd else null end) "
		+ "From dptDSRActvt a with (nolock), dpvConcEmpl b with (nolock) "
		+ "where a.cusRtlCd = b.custCode "
		+ "and   a.docuDate between  '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "' "
		+ "and   a.createId = '" + loginIdM + "' "
		+ "and   a.statFlag  not in ('C','R') ";

	//	out.println(sql);
	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
		teleCallRt = rset.getInt(1);
		teleCallSt = rset.getInt(2);
		prsnlVstRt = rset.getInt(3);
		prsnlVstSt = rset.getInt(4);
		unqRetlVst = rset.getInt(5);
		unqMapRtVs = rset.getInt(6);
	}
%>
			<div class="col-xl-6 col-md-6 col-lg-6 box-col-12 pt-5">
				<div class="card mb-10">
					<div class="card-header">
						<h5>Visit/Calling Report
							<span class="float-right"></span>
						</h5>
					</div>
					<div class="bottom-content card-body">
						<div class="row">
							<div class="col-12">
								<p id="chartValVst"></p>
							</div>
						</div>
						<div class="row text-center">
							<div class="col-6 b-r-light">
								<div>
									<a href="#" onClick="openClickWind('/BirlaWhite/Reports/DashBoard/EmplInSntSlf.jsp?popupWin=Y&emplCode=<%=loginIdM%>&emplCatg=All&repoType=TMRLR')"> 
									<span class=""><i class="icon-angle-up f-12 ms-1"></i></span><span class="">Total Mapped Retailer</span>
										<h4 class="num m-0">
											<span class="counter color-bottom"><%=totlMpRt%></span>
										</h4>
									</a>
								</div>
							</div>
							<div class="col-6 b-r-light">
								<div>
									<a href="#" onClick="openClickWind('/BirlaWhite/Reports/DashBoard/EmplInSntSlf.jsp?popupWin=Y&emplCode=<%=loginIdM%>&strtDate=<%=strtDate%>&endgDate=<%=endgDate%>&emplCatg=All&repoType=UNQRTLRVs')"> 
									<span class=""><i class="icon-angle-up f-12 ms-1"></i></span><span class="">Total Unique Visited Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=unqRetlVst%></span>
									</h4>
									</a>
								</div>
							</div>
							<div class="col-6">
								<div>
									<a href="#" onClick="openClickWind('/BirlaWhite/Reports/DashBoard/EmplInSntSlf.jsp?popupWin=Y&emplCode=<%=loginIdM%>&strtDate=<%=strtDate%>&endgDate=<%=endgDate%>&emplCatg=All&repoType=unqMapRtVs')"> 
									<span class=""><i class="icon-angle-up f-12 ms-1"></i></span><span class="">Visited Unique Mapped Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=unqMapRtVs%></span >
									</h4>
									</a>
								</div>
							</div>
							<div class="col-6">
								<div>
									<a href="#" onClick="openClickWind('/BirlaWhite/Reports/DashBoard/EmplInSntSlf.jsp?popupWin=Y&emplCode=<%=loginIdM%>&strtDate=<%=strtDate%>&endgDate=<%=endgDate%>&emplCatg=All&repoType=unqMapPnRtVs')"> 
									<span class=""><i class="icon-angle-up f-12 ms-1"></i></span><span class="">Pending Retailer Visit</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=totlMpRt - unqMapRtVs%></span >
									</h4>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
	<script>
	trgtValu = "<%=totlMpRt - unqMapRtVs%>";
	achvValu = "<%=unqMapRtVs%>";
	charts = [{
	title: '',
	config: 
	{
		type: 'pie',
		defaultLabel: 'DSR Visit',
		onclick: function(e, point) 
		{
			console.log('clicked point', point);
		}
	},
	data: [
	{
		v: <%=totlMpRt - unqMapRtVs%>,
		l: 'Pending Retailer'
	},
	{
		v: <%=unqMapRtVs%>,
		l: 'Unique Retailer Visit'

	}]
}
];

 	genCharts("chartValVst", charts);
	trgtValu = "",
	achvValu = "",
	charts = "";

</script>
<%
/*
	sql = "select  loginIdM, NoOf_Days, cast(Total_Hours as numeric(9,2))+ cast(Minutes_cal as numeric(9,2))as Total_Hours, cast((cast(Total_Hours as numeric(9,2))+ cast(Minutes_cal as numeric(9,2)))/NoOf_Days as numeric(18,2))as AvgHPrd "
		+ "From  "
		+ "( "
		+ "	select loginIdM, count(*) as NoOf_Days, sum(cast(hours as numeric)) as hours, "
		+ "			sum(cast(x.Minutes as numeric))as Minutes, "
		+ "			sum(cast(hours as numeric)) + floor(sum(cast(x.Minutes as numeric))/60) as Total_Hours, "
		+ "			(sum(cast(x.Minutes as numeric))  - floor(sum(cast(x.Minutes as numeric))/60)*60)/60 as Minutes_cal "
		+ "	from "
		+ "	(	"
		+ "		select  b.loginIdM, b.emplName,  isnull(b.emplDesc, '') as emplDesc, "
		+ "			replace(convert(varchar(6), docuDate, 113), ' ', '_') as Days, 	"
		+ "			cast(COUNT(*) as varchar) as Total_Visits,  "
		+ "			REPLACE(CONVERT(VARCHAR(5),DATEADD(SECOND, round(cast(DATEDIFF(MINUTE, MIN(a.createDt), MAX(a.createDt)) as numeric(9,2))/60, 2) * 3600, 0),108), ':', ':') as Time_In_Min, "
		+ "			convert(varchar(5), MIN(a.createDt), 114) as First_Visit_Time, convert(varchar(5), max(a.createDt), 114) as Last_Visit_Time, "
		+ "			CONVERT(VARCHAR(2),DATEADD(SECOND, round(cast(DATEDIFF(MINUTE, MIN(a.createDt), MAX(a.createDt)) as numeric(9,2))/60, 2) * 3600, 0),108) as Hours, "
		+ "			substring(CONVERT(VARCHAR(5),DATEADD(SECOND, round(cast(DATEDIFF(MINUTE, MIN(a.createDt), MAX(a.createDt)) as numeric(9,2))/60, 2) * 3600, 0),108), 4,2) as Minutes "
		+ "		from	dptDSRActvt a with (nolock), prmEmployee b with (nolock)  "
		+ "		where  a.createId = b.loginIdM  "
		+ "		and    dsrParam in ('05','11','50','21','06','31','51','13','03') "
		+ "		and    a.docuDate between '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "' "
		+ "		and    CONVERT(varchar(11), a.docuDate, 113) = CONVERT(varchar(11), a.createDt, 113)  "
		+ "		and    a.statFlag not in ('C','R') "
		+ "		and    b.isActive = 'Y' "
		+ "		group by b.loginIdM, b.emplName, b.emplDesc, b.isActive, replace(convert(varchar(6), docuDate, 113), ' ', '_') "
		+ "	) x where x.loginIdM = '" + loginIdM + "' "
		+ "	group by loginIdM "
		+ ") x	";	

	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{

	}
*/
%>
<!--
			<div class="col-xl-6 col-md-6 col-lg-6 box-col-12 pt-5">
				<div class="card mb-10">
					<div class="card-header">
						<h5>Calling Report
							<span class="float-right"></span>
						</h5>
					</div>
					<div class="bottom-content card-body">
						<div class="row">
							<div class="col-12">
								<p id="chartValVst1"></p>
							</div>
						</div>
						<div class="row text-center">
							<div class="col-4 b-r-light">
								<div>
									<span class="font-primary"><i class="icon-angle-up f-12 ms-1"></i></span><span class="text-muted block-bottom">Total Mapped Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=totlMpRt%></span>
									</h4>
								</div>
							</div>
							<div class="col-4 b-r-light">
								<div>
									<span class="font-primary"><i class="icon-angle-up f-12 ms-1"></i></span><span class="text-muted block-bottom">Total Call Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=teleCallRt%></span>
									</h4>
								</div>
							</div>
							<div class="col-4 b-r-light">
								<div>
									<span class="font-primary"><i class="icon-angle-up f-12 ms-1"></i></span><span class="text-muted block-bottom">Total Visit Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=prsnlVstRt%></span>
									</h4>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
 
			<div class="col-xl-6 col-md-6 col-lg-6 box-col-12 pt-5">
				<div class="card mb-10">
					<div class="card-header">
						<h5>Calling Report
							<span class="float-right"></span>
						</h5>
					</div>
					<div class="bottom-content card-body">
						<div class="row">
							<div class="col-12">
								<p id="chartValVst1"></p>
							</div>
						</div>
						<div class="row text-center">
							<div class="col-4 b-r-light">
								<div>
									<span class="font-primary"><i class="icon-angle-up f-12 ms-1"></i></span><span class="text-muted block-bottom">Total Mapped Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=totlMpRt%></span>
									</h4>
								</div>
							</div>
							<div class="col-4 b-r-light">
								<div>
									<span class="font-primary"><i class="icon-angle-up f-12 ms-1"></i></span><span class="text-muted block-bottom">Total Call Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=teleCallRt%></span>
									</h4>
								</div>
							</div>
							<div class="col-4 b-r-light">
								<div>
									<span class="font-primary"><i class="icon-angle-up f-12 ms-1"></i></span><span class="text-muted block-bottom">Total Visit Retailer</span>
									<h4 class="num m-0">
										<span class="counter color-bottom"><%=prsnlVstRt%></span>
									</h4>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div> -->
	<script>
	/*
	trgtValu = "<%=prsnlVstRt%>";
	achvValu = "<%=teleCallRt%>";
	charts = [{
	title: '',
	config: 
	{
		type: 'pie',
		defaultLabel: 'DSR Visit',
		onclick: function(e, point) 
		{
			console.log('clicked point', point);
		}
	},
	data: [
	{
		v: <%=prsnlVstRt%>,
		l: 'Total Retailer Visit'
	},
	{
		v: <%=teleCallRt%>,
		l: 'Retailer Calling'

	}]
}
];

 	genCharts("chartValVst1", charts);
	trgtValu = "",
	achvValu = "",
	charts = "";
		*/
</script>
</div>
<div class="row">
<div class="col-xl-4 col-md-4 col-lg-4 box-col-12">
	<div class="card mb-10">
		<div class="card-header">
			<h5> Avg Working Hours in Market
				<span class="float-right"></span>
			</h5>
		</div>
		<div class="bottom-content">
			<div class="row">
				<div class="col-12">
					
				</div>
			</div>
			<div class="table-responsive table-border">
				<table>
<%
	sql = "select  loginIdM, NoOf_Days, cast(Total_Hours as numeric(9,2))+ cast(Minutes_cal as numeric(9,2))as Total_Hours, cast((cast(Total_Hours as numeric(9,2))+ cast(Minutes_cal as numeric(9,2)))/NoOf_Days as numeric(18,2))as AvgHPrd, totlVisit "
		+ "From  "
		+ "( "
		+ "	select loginIdM, count(*) as NoOf_Days, sum(cast(hours as numeric)) as hours, "
		+ "			sum(cast(x.Minutes as numeric))as Minutes, "
		+ "			sum(cast(hours as numeric)) + floor(sum(cast(x.Minutes as numeric))/60) as Total_Hours, "
		+ "			(sum(cast(x.Minutes as numeric))  - floor(sum(cast(x.Minutes as numeric))/60)*60)/60 as Minutes_cal, sum(totlVisit) as totlVisit "
		+ "	from "
		+ "	(	"
		+ "		select  b.loginIdM, b.emplName,  isnull(b.emplDesc, '') as emplDesc, "
		+ "			replace(convert(varchar(6), docuDate, 113), ' ', '_') as Days, 	"
		+ "			cast(COUNT(*) as varchar) as Total_Visits,  "
		+ "			REPLACE(CONVERT(VARCHAR(5),DATEADD(SECOND, round(cast(DATEDIFF(MINUTE, MIN(a.createDt), MAX(a.createDt)) as numeric(9,2))/60, 2) * 3600, 0),108), ':', ':') as Time_In_Min, "
		+ "			convert(varchar(5), MIN(a.createDt), 114) as First_Visit_Time, convert(varchar(5), max(a.createDt), 114) as Last_Visit_Time, "
		+ "			CONVERT(VARCHAR(2),DATEADD(SECOND, round(cast(DATEDIFF(MINUTE, MIN(a.createDt), MAX(a.createDt)) as numeric(9,2))/60, 2) * 3600, 0),108) as Hours, "
		+ "			substring(CONVERT(VARCHAR(5),DATEADD(SECOND, round(cast(DATEDIFF(MINUTE, MIN(a.createDt), MAX(a.createDt)) as numeric(9,2))/60, 2) * 3600, 0),108), 4,2) as Minutes, sum(case when dsrParam in ('05','01','06') then 1 else 0 end) as totlVisit "
		+ "		from	dptDSRActvt a with (nolock), prmEmployee b with (nolock)  "
		+ "		where  a.createId = b.loginIdM  "
		+ "		and    dsrParam in ('05','11','50','21','06','31','51','13','03') "
		+ "		and    a.docuDate between '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "' "
		+ "		and    CONVERT(varchar(11), a.docuDate, 113) = CONVERT(varchar(11), a.createDt, 113)  "
		+ "		and    a.statFlag not in ('C','R') "
		+ "		and    b.isActive = 'Y' "
		+ "		group by b.loginIdM, b.emplName, b.emplDesc, b.isActive, replace(convert(varchar(6), docuDate, 113), ' ', '_') "
		+ "	) x where x.loginIdM = '" + loginIdM + "' "
		+ "	group by loginIdM "
		+ ") x	";	

	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
%>
		<tr>
			<th>No Of Days</th><td><%=rset.getString(2)%></td>
		</tr>
		<tr>
			<th>No Of Visit</th><td><%=rset.getString(5)%></td>
		</tr>
		<tr>
			<th>Total No Of Working Hours</th><td><%=rset.getString(3)%></td>
		</tr>
		<tr>
			<th>Avg no Working Hours</th><td><%=rset.getString(4)%></td>
		</tr>
<%
	}
	sql = "select x.emplCode, sum(case when atTyp1st in ('AB','AL','CD','CL','LP','ML','OL','PL','PT','SL','PH') then First_half else 0 end) as Leave, "
		+ "	sum(case when atTyp1st in ('OF') then First_half else 0 end)	as offDays,	  "
		+ "	sum(case when atTyp1st in ('PD') then First_half else 0 end)	as Present_Days,  "
		+ "	sum(case when atTyp1st in ('OD') then First_half else 0 end)	as OD "
		+ "from    "
		+ "(  "
		+ "	select cast(emplCode as varchar) as emplCode, atTyp1st, 0.5 as First_half "
		+ "	From itKharia.dbo.sltAttnMktg with (nolock)	 "
		+ "	where pnchDate between '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "' and atTyp1st <> '' "
		+ "	union all	"
		+ "	select cast(emplCode as varchar) as emplCode, atTyp2nd, 0.5 as First_half 	"
		+ "	From itKharia.dbo.sltAttnMktg  with (nolock) "
		+ "	where pnchDate between '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "'  "
		+ "	and atTyp2nd <> ''	"
		+ "	union all  "
		+ "	select 'PZ' + cast(emplCode as varchar) as emplCode, atTyp1st, 0.5 as First_half  "
		+ "	From itKharia.dbo.[srtAttnMktg] with (nolock) "
		+ "	where pnchDate between '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "'and atTyp1st <> '' "
		+ "	union all  "
		+ "	select 'PZ' + cast(emplCode as varchar) as emplCode, atTyp2nd, 0.5 as First_half   "
		+ "	From itKharia.dbo.[srtAttnMktg]  with (nolock)	"
		+ "	where pnchDate between '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "' "
		+ "	and atTyp2nd <> '' "
		+ ")x, prmEmployee y with (nolock)  "
		+ "where x.emplCode = y.loginIdM "
		+ "group by x.emplCode " ;
	rset = WebSessBean.selectRecord(sql);
	if(rset.next())
	{
%>
			<tr>
				<th>Leave</th><td><%=rset.getString(2)%></td>
			</tr>
			<tr>
				<th>offDays</th><td><%=rset.getString(3)%></td>
			</tr>
			<tr>
				<th>Present Days</th><td><%=rset.getString(4)%></td>
			</tr>
<%
	}
%>
					</table>
				</div>
			</div>
		</div>
	</div>
<%
	//}
%>
</div>

<div class="row">
<%
	sql = "select mrgRepDs, count(distinct retlCode), "	
		+ "		sum(case when isnull(cast(DATEDIFF(day, lstBilDt, getdate()) as varchar), 500) <= 30 then 1 else 0 end) as bildinOneMonth, "
		+ "		sum(case when isnull(cast(DATEDIFF(day, lstBilDt, getdate()) as varchar), 500) <= 90 then 1 else 0 end) as biledInLst3Mnth, "
		+ "		sum(case when isnull(cast(DATEDIFF(day, lstBilDt, getdate()) as varchar), 500) <= 180 then 1 else 0 end) as biledSixMnth," 
		+ "		sum(case when isnull(cast(DATEDIFF(day, lstBilDt, getdate()) as varchar), '') = '' then 1 else 0 end) as nevrBilled, mrgRepCt, "
		+ "		sum(case when isnull(lstBilDt, '') between  '" + WebSessBean.dmyTOddmmmyyyy(strtDate) + "' and '" + WebSessBean.dmyTOddmmmyyyy(endgDate) + "' then 1 else 0 end) as bildinOneMonth " 
		+ "From rtvBillStat with (nolock) "
		+ "where concEmpl = '" + loginIdM + "' "
		+ "and   mrgRepCt in ('01','02','03') "
		+ "group by concEmpl, mrgRepCt, mrgRepDs "
		+ "order by concEmpl, mrgRepCt, mrgRepDs";
	rset = WebSessBean.selectRecord(sql);
	while(rset.next())
	{
		mrgRepDs = rset.getString(1);
		ttlMapRt = rset.getInt(2);
		bild1Mnt = rset.getInt(3);
		bild3Mnt = rset.getInt(4);
		bild6Mnt = rset.getInt(5);
		nevrBill = rset.getInt(6);
		mrgRepCt = rset.getString(7);
		bildCurM = rset.getInt(8);
%>
			<div class="col-xl-4 col-md-4 col-lg-4 box-col-12">
				<div class="card mb-10">
					<div class="card-header">
						<h5> Retailer Tally Billing Status (<%=mrgRepDs%>)
							<span class="float-right"></span>
						</h5>
					</div>
					<div class="bottom-content">
						<div class="row">
							<div class="col-12">
								<p id="chartVal<%=mrgRepCt%>"></p>
							</div>
						</div>
						<div class="table-responsive table-border">
							<table>
								<tr>
									<th>No. of Retailers (mapped to employee)</th><td><%=totlMpRt%></td>
								</tr>
								<tr>
									<th>Billed in Curr Month</th><td><%=bildCurM%></td>
								</tr>
								<tr>
									<th>Unbilled in Curr Month</th><td><%=totlMpRt - bildCurM%></td>
								</tr>
								<tr>
									<th>Unbilled</th><th>Count</th>
								</tr>
								<tr>
									<th>< 1 month</th><td><%=totlMpRt - bild1Mnt%></td>
								</tr>
								<tr>
									<th>< 3 month</th><td><%=totlMpRt - bild3Mnt%></td>
								</tr>
								<tr>
									<th>< 6 month</th><td><%=totlMpRt - bild6Mnt%></td>
								</tr>
								<tr>
									<th>Never Billed</th><td><%=nevrBill%></td>
								</tr>
							</table>
						</div>
					</div>
				</div>
			</div>
	<script>
	charts = [{
	title: '',
	config: 
	{
		type: 'pie',
		defaultLabel: 'DSR Visit',
		onclick: function(e, point) 
		{
			console.log('clicked point', point);
		}
	},
	data: [
	{
		v: <%=bild1Mnt%>,
		l: 'Billed < 1 Month'
	},
	{
		v: <%=ttlMapRt - bild1Mnt%>,
		l: 'Unbilled < 1 Month'

	}]
}
];

 	genCharts("chartVal<%=mrgRepCt%>", charts);
	trgtValu = "",
	achvValu = "",
	charts = "";

</script>
<%
	}
%>
</div>
<%
}
catch(Exception e)
{
	throw new Exception("Error while fetching records in " + pageAddress + e.toString() + sql);
}
rset = WebSessBean.closeRset(rset);

%>
<!-- Form footer Starts --->
<jsp:include page="/Envr/JSP/FooterCom.jsp" flush="true"/>
<!-- Form footer Ends --->
