// Controllers/DsrRetailerInOutController.cs
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;

namespace YourApp.Controllers
{
    // ------------------------------------------------
    // 1) EF Core DbContext
    // ------------------------------------------------
    public class ApplicationDbContext : DbContext
    {
        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> opts)
            : base(opts) { }

        /// <summary>
        /// Maps to your bkmAreaMast table.
        /// </summary>
        public DbSet<BkmAreaMast> BkmAreaMast { get; set; } = null!;
    }

    // ------------------------------------------------
    // 2) Entity model for bkmAreaMast
    // ------------------------------------------------
    public class BkmAreaMast
    {
        public string AreaCode { get; set; } = "";
        public string AreaDesc { get; set; } = "";
        public string IsActive { get; set; } = "";   // 'Y' or 'N'
        public string IsOnlyDp { get; set; } = "";   // 'Y' or 'N'
    }

    // ------------------------------------------------
    // 3) DTO returned by our endpoint
    // ------------------------------------------------
    public class AreaCodeDto
    {
        public string Code { get; set; } = "";
        public string Description { get; set; } = "";
    }

    // ------------------------------------------------
    // 4) The API controller itself
    // ------------------------------------------------
    [ApiController]
    [Route("api/[controller]")]
    public class DsrRetailerInOutController : ControllerBase
    {
        private readonly ApplicationDbContext _context;

        public DsrRetailerInOutController(ApplicationDbContext context)
        {
            _context = context;
        }

        /// <summary>
        /// GET  /api/DsrRetailerInOut/areaCodes
        /// Returns all active area codes (excluding “only DP” records).
        /// </summary>
        [HttpGet("areaCodes")]
        [ProducesResponseType(typeof(IEnumerable<AreaCodeDto>), 200)]
        public async Task<ActionResult<IEnumerable<AreaCodeDto>>> GetAreaCodes()
        {
            var codes = await _context.BkmAreaMast
                .Where(a => a.IsActive == "Y" && a.IsOnlyDp != "Y")
                .OrderBy(a => a.AreaDesc)
                .Select(a => new AreaCodeDto
                {
                    Code        = a.AreaCode,
                    Description = a.AreaDesc
                })
                .ToListAsync();

            return Ok(codes);
        }
    }
}




System.InvalidOperationException: Unable to resolve service for type 'YourApp.Controllers.ApplicationDbContext' while attempting to activate 'YourApp.Controllers.DsrRetailerInOutController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method9(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at AuthenticationMiddleware.InvokeAsync(HttpContext context) in C:\Users\Magan.Dhaniya-mkt\Desktop\SparshWebServices\AuthenticationMiddleware.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)

HEADERS
=======
Accept: text/plain
Host: localhost:7223
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate, br, zstd
Accept-Language: en-US,en;q=0.9
Referer: https://localhost:7223/swagger/index.html
sec-ch-ua-platform: "Windows"
sec-ch-ua: "Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"
sec-ch-ua-mobile: ?0
sec-fetch-site: same-origin
sec-fetch-mode: cors
sec-fetch-dest: empty
priority: u=1, i

