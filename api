<%@ include file="/Envr/JSP/SecurityCom.jsp"%>
<!-- /BirlaWhite/Mobile/GrcLeadEntry.jsp -->
<%@ page import="java.sql.*, java.util.Base64, java.io.ByteArrayInputStream, java.io.IOException, java.util.ArrayList, java.util.List" %>

<%
ResultSet rset = null;

String  sql = "",
		procType = "A",
		docuNumb = "",
		mobileNo = "",
		leadDate = "",
		leadQnty = "",
		siteName = "",
		siteRmrk = "",
		prdCdStr = "",
		siteAddr = "",
		upldFlNm = "",
		uplodBtn = "",
		randNmSt = "",
		leadZone = "",
		leadStat = "",
		saleArea = "",
		loctCity = "",
		siteAdrs = "",
		archctNm = "",
		archctMo = "",
		archctEm = "",
		siteLoct = "",
		grcItmRq = "",
		qtyOfWrk = "",
		timeFram = "",
		disablFl = "",
		areaCode = "",
		itxPanNo = "",
		gstnNumb = "",
		emailAdd = "",
		stateGeo = "",
		district = "",
		pinCodeS = "",
		retlPinC = "",
		cityCode = "",
		location = "",
		cityName = "",
		loginTyp = "",
		stMobNum = "",
		stateNam = "",
		leadMsrs = "",
		areaCodS = "",
		siteType = "",
		retlAdd1 = "",
		mouStrrs = "",
		delvrPrd = "",
		prjcKStr = "",
		prjctKnd = "",
		delvPStr = "",
		cnPerStr = "",
		cntPrsnt = "",
		pinCdStr = "<option value=''></option>",
		adhrNumb = "",
		archtNam = "",
		sitePinC = "",
		drawRand = ("" + (Math.random() * 10000)).substring(0,16),
		formName = "GrcLeadEntry";


Double salesBag = 0.00,
	   salesQty = 0.00;

List<String> imageList = new ArrayList<>();

if (XssFilter.parSmGet("procType") != null)
	procType = XssFilter.parSmGet("procType");

if (XssFilter.parSmGet("docuNumb") != null)
	docuNumb = XssFilter.parSmGet("docuNumb");

if (XssFilter.parSmGet("siteType") != null)
	siteType = XssFilter.parSmGet("siteType");

loginTyp = log.getUserType();
if(log.getUserType().equals(""))
{
	procType = "U";
	loginTyp = "S";
}
if(procType.equals("A"))
{
	sql = "select right(newId(), 8)";
	rset = WebSessBean.selectRecord(sql);

	rset.next();
	randNmSt = rset.getString(1);
}
else //if(procType.equals("A"))
{
	randNmSt = docuNumb;
}

sql = " select 'F2','Feet Squre' union all select 'FT','Feet' union all select 'M2','Meter Squre' union all select 'NO','Numbers' union all select 'RF','Running Ft' ";
mouStrrs = WebSessBean.getSqlToOptionStr(sql, leadMsrs);


sql = " select '01-03 month','01-03 month' union all select '04-06 month','04-06 month' union all select '07-12 month','07-12 month' union all select 'over 12 month','over 12 month' ";
delvPStr = WebSessBean.getSqlToOptionStr(sql, delvrPrd);

sql = " select 'residence / bunglow','residence / bunglow' union all select 'religious','religious' union all select 'hotel','hotel' union all select 'hospital','hospital' union all select 'Govt. Project','Govt. Project' "
	+ " union all select 'Commercial Project','Commercial Project' union all select 'high rise','high rise' union all select 'land scaping','land scaping' union all select 'educational institute','educational institute'  "
	+ " union all select 'Others','Others' ";
prjcKStr = WebSessBean.getSqlToOptionStr(sql, prjctKnd);

sql = " select 'Owner','Owner' union all select 'builder','builder' union all select 'contractor','contractor' union all select 'architect','architect' union all select 'construction company','construction company' ";
cnPerStr = WebSessBean.getSqlToOptionStr(sql, cntPrsnt);
%>

<script language="javascript">

function refreshed()
{
	document.<%=formName%>.method = "POST";
	document.<%=formName%>.action = "<%=formName%>.jsp";
	document.<%=formName%>.submit();
}

function deleter2()
{
	deleterCv("<%=formName%>", "abc1", "prjTable", 1);
}

function addrow(prodCode,salesBag,salesQty)
{
	numrows = getNumRows();
	var newRow = insertRowBw(document.all.prjTable);

	name = "abc1";
	m = insertCellBw(newRow);
	m.innerHTML = "<input type = 'checkbox' name = '" + name + "' value = '" + numrows + "'>";

	name = "prodCode" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = "<select class='form-control' name='" + name + "' id='" + name + "' class='form-control form-control-solid'  value='" + prodCode + "'><%=prdCdStr%></select>";
	//m.innerHTML = "<input type='text' name='" + name + "' id='" + name + "' class='form-control form-control-solid' value='" + prodCode + "'>";
	
	name = "salesBag" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = "<input type='text' name='" + name + "' id='" + name + "' class='form-control form-control-solid' value='" + salesBag + "' onchange=\"return BagConv(" + numrows + ", 'N')\">";
	

	name = "salesQty" + numrows;
	m = insertCellBw(newRow);
	m.innerHTML = "<input type='text' name='" + name + "' id='" + name + "' class='form-control form-control-solid' value='" + salesQty + "' readonly>";


	$("#prjTable").before(numrows);
		eval("document.<%=formName%>.prodCode" + numrows).value = prodCode;
		eval("document.<%=formName%>.salesBag" + numrows).value = salesBag;
		eval("document.<%=formName%>.salesQty" + numrows).value = salesQty;
	if($("select").select2 != null)
		$("select").select2();

	BagConv(numrows,"N");
}

 var upldFlNm ;
//var  upldFlNmDiv;
function photoUpl()
{
	var flUpLnSt = "";
	var docuType = "";
	var filSeqNo = "Img1";


   	if(document.<%=formName%>.procType.value == "A")
		upldFlNm = "<%=randNmSt%><%=loginIdM%>";
	else
	   upldFlNm = "<%=randNmSt%>";

	document.<%=formName%>.upldFlNm.value = upldFlNm;
//	alert(upldFlNm);
	flUpLnSt = "/Envr/JSP/FileUpload.jsp?popupWin=Y&upDocNum=" + upldFlNm + "&fileDocu=0&fileType=jpg,jpeg&maxmSize=5&filSeqNo=" + filSeqNo + "&attFilTy=00";

	createModal('Image Upload', '' + flUpLnSt + '')
	return true;
}

function areaCodeChange()
{
	console.log("function called 1");
	var rtnValue = districtOpt('<%=formName%>', 'areaCode', 'A', '', 'district');
	if (rtnValue == false)
		return false;

	document.<%=formName%>.district.onchange = function ()
	{
		fillPinLoc1();
		updateAddressFields();

		console.log("function called");

	}
	createEmptySelect("sitePinC");
	return true;
}

function fillPinLoc1()
{
    console.log("function called 3");
	return pinCodeNOpt('<%=formName%>', 'district', '', 'sitePinC');
} 

function photView()
{	
	var imgeView = "";

														
	var atchNmId = "0", atchNmIO = "";
	var filSeqNo = "Img1";

	if(atchNmIO != "")
	{
		atchNmId = atchNmIO;
	}

   	if(document.<%=formName%>.procType.value == "A")
		upldFlNm = "<%=randNmSt%><%=loginIdM%>";
	else
	   upldFlNm = "<%=randNmSt%>";

	imgeView = "/Envr/JSP/AtchFileShow.jsp?docuNumb=" + upldFlNm + "&atchNmId=" + atchNmId + "&filSeqNo=" + filSeqNo + "&attFilTy=00";
	createModal('Image Upload', '' + imgeView + '')
}
	
function submitValid()
{
	if(document.<%=formName%>.procType.value != "A")
	{
		if(!textValidApp(document.<%=formName%>.docuNumb, "Document No", false))
			return false;
	}

	if(!textValidApp(document.<%=formName%>.procType, "Process Type", false))
		return false;

	if(!textValidApp(document.<%=formName%>.leadDate, "Date", false))
		return false;

	if(!textValidApp(document.<%=formName%>.leadQnty, "Qty", false))
		return false;

	if(!textValidApp(document.<%=formName%>.siteName, "Site Name", false))
		return false;
	if(!textValidApp(document.<%=formName%>.mobileNo, "Mobile No", false))
		return false;
	if(!textValidApp(document.<%=formName%>.siteAddr, "Address", false))
		return false;

	confirm("Press OK to save.")
	{
		document.<%=formName%>.method = "POST";
		document.<%=formName%>.action = "<%=formName%>S.jsp";
		document.<%=formName%>.submit();
	}
}

function geoLocPnChng(currObjt) 
{
    if (currObjt == "G") 
	{
        if ("<%=mobilApp%>" == "true") 
		{
            chkdc();
           // parseAndDisplayAddress();
        }
    }
	else 
	{
        // Handle Pin Code selection if needed
		//parseAndDisplayAddress();
		 chkdc();
    }
}

function setCust()
{
	document.<%=formName%>.concEmpl.value = "";
	if(isEmpty(document.<%=formName%>.areaCode.value))
	{
	//	enableDisable("custCode", "D");
		document.getElementById("district").innerHTML = "<select name=''  class='selectpicker' data-style='btn-info' ><option value=''>select</option></select>";
	}
	else
	{
		 fillDistLoc('');
	
	}
}

function fillDistLoc(currObjt)
{
	var wherList = "";
		//wherList = whereAdd(wherList, "SW_06", document.<%=formName%>.areaCode.value);
//		wherList = whereAdd(wherList, "SW_02", "12");
	var rtnValue = districtOpt('<%=formName%>', 'areaCode', 'A', wherList, 'district');
	if(rtnValue)
	{
		if(currObjt != "")
		{
			if(document.<%=formName%>.district !=  null)
				document.<%=formName%>.district.value = currObjt.toUpperCase();
		}

		document.<%=formName%>.district.onchange = function fillPinCdLoc()
		{
			rtnValue = pinCodeNOpt('<%=formName%>', 'district', '', 'retlPinC');
		}
	}

	if(document.<%=formName%>.retlPinC.value == "" || document.<%=formName%>.retlPinC ==  null)
		createEmptySelect("retlPinC");
}

function retlPinCChang(currObjc)
{
 
	var cityName = splitSelectText(document.<%=formName%>.retlPinC)[1];
	
	document.<%=formName%>.location.value = cityName;
	document.<%=formName%>.cityName.value = cityName;
	document.getElementById("locationDiv").innerText = cityName

	 fillDistLoc(splitSelectText(document.<%=formName%>.retlPinC)[2]);

}

function updateAddressFields() {
    const addressString = document.getElementById('retlAdd1').value;

    // Remove any leading or trailing spaces and normalize the address
    const normalizedAddress = addressString.trim().replace(/\s+/g, ' ');

    // Try to match the pincode in the address string
    const pincodeRegex = /\b\d{6}\b/;
    const pincodeMatch = normalizedAddress.match(pincodeRegex);
    let pincode = '';
    if (pincodeMatch) {
        pincode = pincodeMatch[0];
    }

    // Remove the pincode from the address string
    const addressWithoutPincode = normalizedAddress.replace(pincodeRegex, '');

    // Split the address by comma and trim each part
    const parts = addressWithoutPincode.split(',').map(part => part.trim());

    // Extract city, district, and state from the parts
    let city = '';
    let district = '';
    let state = '';
    if (parts.length >= 3) {
        city = parts[0];
        district = parts[1];
        state = parts.slice(2).join(', ');
    } else if (parts.length === 2) {
        city = parts[0];
        state = parts[1];
    } else if (parts.length === 1) {
        city = parts[0];
    }

    // Update the input fields
    document.getElementById('city1').value = city;
    document.getElementById('district1').value = district;
    document.getElementById('pincode1').value = pincode;
    document.getElementById('state1').value = state;
}

</script>

<!-- header display area begin -->
<jsp:include page="/Envr/JSP/HeaderCom.jsp" flush="true">
    <jsp:param name="mobFrend" value="B"/>
</jsp:include>
<!-- HEADER DISPLAY AREA ENDS -->
<form name="<%=formName%>">
    <div class="card card-xl-stretch p-6" ontouchstart="updateAddressFields()">
        <div class="row p-6">
            <h1 class="header-bw" align="center"> Process Details </h1>
            <div class="col-md-4">
                <label class="required">Define Onsite/Offsite</label>
                <select name="siteType" id="siteType" onchange="refreshed()" value="">
                    <%=WebSessBean.getSqlToOptionStr("select 'O', 'Onsite' union select 'F', 'Offsite' ",siteType)%>
                </select>
            </div>
            <div class="col-md-4">
                <label class="required">Process Type</label>
                <select name="procType" id="procType" onchange="refreshed()" value="">
                    <%=WebSessBean.getSqlToOptionStr("select 'A', 'Add' union select 'U', 'Update' ",procType)%>
                </select>
            </div>
<%
if(procType.equals("U"))
{
%>
 		<div class="col-md-4">
			<label class="required">Document No</label>
			<select name="docuNumb" id="docuNumb" onchange = "refreshed()">
					<%=WebSessBean.getSqlToOptionStr("select a.docuNumb, a.docuNumb  from bwlive.dbo.dptGrcLeadGn a with (nolock) where a.createId = '" + loginIdM + "' ", docuNumb, false)%>
			</select>
		</div>
<%
}
try 
{	
	if(!docuNumb.equals("") && siteType.equals("F"))
	{
		sql = "select a.docuNumb, convert(varchar(10), leadDate, 111), leadQnty, siteName, mobileNo, siteAddr, siteRmrk, adhrNumb, archtNam, itxPanNo, gstnNumb, emailAdd, district, areaCode, retlPinC , attchMnt from bwlive.dbo.dptGrcLeadGn a with (nolock) where docuNumb = '" + docuNumb + "' ";
		rset = WebSessBean.selectRecord(sql);
		if(rset.next())
		{
			docuNumb = rset.getString(1); 
			leadDate = rset.getString(2); 
			leadQnty = rset.getString(3); 
			siteName = rset.getString(4);  
			mobileNo = rset.getString(5);  
			siteAddr = rset.getString(6);  
			siteRmrk = rset.getString(7); 
			adhrNumb = rset.getString(8); 
			archtNam = rset.getString(9); 
			itxPanNo = rset.getString(10); 
			gstnNumb = rset.getString(11); 
			emailAdd = rset.getString(12); 
			district = rset.getString(13); 
			areaCode = rset.getString(14); 
			sitePinC = rset.getString(15); 
			drawRand = rset.getString(16); 
		}
	}
	if(!docuNumb.equals("") && siteType.equals("O"))
	{
		sql = "select a.docuNumb, convert(varchar(10), leadDate, 111), leadQnty, siteName, mobileNo, siteAddr, siteRmrk, adhrNumb, archtNam, itxPanNo, gstnNumb, emailAdd, district, stateNam, cityName, attchMnt from bwlive.dbo.dptGrcLeadGn a with (nolock) where docuNumb = '" + docuNumb + "' ";
		rset = WebSessBean.selectRecord(sql);
		if(rset.next())
		{
			docuNumb = rset.getString(1); 
			leadDate = rset.getString(2); 
			leadQnty = rset.getString(3); 
			siteName = rset.getString(4);  
			mobileNo = rset.getString(5);  
			siteAddr = rset.getString(6);  
			siteRmrk = rset.getString(7); 
			adhrNumb = rset.getString(8); 
			archtNam = rset.getString(9); 
			itxPanNo = rset.getString(10); 
			gstnNumb = rset.getString(11); 
			emailAdd = rset.getString(12); 
			district = rset.getString(13); 
			stateNam = rset.getString(14); 
			cityName = rset.getString(15); 
			drawRand = rset.getString(16); 
		}
	
	}
%>	

<div class="col-md-4">
    <label>lead Date</label>
    <input type="text" value="<%=leadDate%>" name="leadDate" id="leadDate" onChange="return isDate(this, false, '')" onClick="showCal('<%=formName%>','leadDate')">	<br>
</div>
<div class="col-md-4">
    <label class="required">lead Qty</label>
    <input type="text" value="<%=leadQnty%>" name="leadQnty" id="leadQnty" required><br>
</div>
<div class="col-md-4">
    <label class="optional">Unit of Measurement</label><span class="optional">(optional)</span>
    <select name="leadMsrs" id="leadMsrs"> <%=mouStrrs%> </select><br>
</div>

<%
if(siteType.equals("F"))
{
%>
		<br><h1 class="header-bw" align="center">Project Details </h1>
		<div class="col-md-4">
				<label class="control-label float-sm-left">Area *</label> 
					<select name="areaCode" id="areaCode" data-live-search="true" onChange="return areaCodeChange()" class="selectpicker" value="<%=areaCode%>">
						<%=WebSessBean.getArDesc(areaCode, true)%>
					</select><br>
		</div>

<%
}
if(siteType.equals("O"))
{
%>
<br>
<h1 class="header-bw" align="center">Project Details </h1>
<div class="col-md-4">
    <label class="control-label float-sm-left">Area *</label> 
    <select name="areaCode" id="areaCode" data-live-search="true" class="selectpicker" value="<%=areaCodS%>">
        <%=WebSessBean.getArDesc(areaCodS, true)%>
    </select><br>
</div>
<div class="col-md-4">
    <label>Address Capture using Geo Location*(for Mobile)</label> 
    <div class="card1">
        <label class="check"> 
            <input type="radio" name="geoLocPn" value="G" id="geoLocPn" onclick="geoLocPnChng('G')">
            <span>Geo Location</span> 
        </label>
        <label class="check"> 
            <input type="radio" name="geoLocPn" value="P" id="geoLocPn1" onclick="geoLocPnChng('P')">
            <span>Pin Code</span> 
        </label> 
    </div>
</div>
<div class="col-md-4">
    <label class="control-label float-sm-left">Address 1 *</label> 
    <input type="text" id="retlAdd1" name="retlAdd1" class="form-control" value="<%=retlAdd1%>" onChange="updateAddressFields()">
    <!--<input type="button" name="btnSaveExit" value="Submit" class="coloredBtn" onClick="updateAddressFields()">-->
</div>
<div style="display: none;">
    <div class="col-md-4">
        <label class="control-label float-sm-left">Pin Code *</label> 
        <div>
            <select name="retlPinC" id="retlPinC" class="form-control" onChange="return retlPinCChang()">
                <%//=pinCdStr%>
                <option value="">-- Select  Pin Code --</option>
            </select> 
        </div>
    </div> 
</div>
	 <div class="col-md-4">
        <label for="city">Area Code(G-MAP)</label>
        <input type="text" id="city1" name="cityName" value="<%=cityName%>" readonly>
    </div>
    <div class="col-md-4">
        <label for="district">Addres 2</label>
        <input type="text" id="district1" name="district" value="<%=district%>" readonly>
    </div>
    <div class="col-md-4">
        <label for="pincode">Pincode:</label>
        <input type="text" id="pincode1" name="pinCodeS" value="<%=pinCodeS%>" readonly>
    </div>
    <div class="col-md-4">
        <label for="state">Address 3</label>
        <input type="text" id="state1" name="stateNam" value="<%=stateNam%>" readonly>
    </div>

<%
} 
if (siteType.equals("F"))
{
%>
<div class="col-md-4">
    <label class="control-label float-sm-left">City and District *</label>
    <select name="district" id="district" class="selectpicker">
        <option>Select District</option>
    </select>
    <label class="control-label" id="districtLabel"></label><br>
</div>
<div class="form-group col-md-4">
    <label class="control-label float-sm-left">Pin Code *</label>
    <select name="sitePinC" id="sitePinC" class="selectpicker">
        <option value="">Select Pincode</option>
    </select>
    <label class="control-label" id="sitePinCLabel"></label>
</div>
<%
}
%>
<div class="col-md-4">
    <label class="required">Project Name</label>
    <input type="text" value="<%=siteName%>" name="siteName" id="siteName" required> <br>
</div>
<div class="col-md-4">
	<label class="">Delivery Period </label>
	<select id="delvrPrd" name="delvrPrd" value="<%=delvrPrd%>"><%=delvPStr%></select>
</div>
<div class="col-md-4">
	<label class="">Kind of project </label>
	<select id="prjctKnd" name="prjctKnd" value="<%=prjctKnd%>"><%=prjcKStr%></select>
</div>
<div class="col-md-4">
    <label class="required">Project Address</label>
    <input type="text" value="<%=siteAddr%>" name="siteAddr" id="siteAddr" required>
</div>
<div class="col-md-4">
    <label class="optional">Contact Person</label><span class="optional">(optional)</span>
    <input type="text" value="<%=stMobNum%>" maxlength="10" name="stMobNum" id="stMobNum"><br>
</div>
<div class="col-md-4">
	<label class="">Contact Person Type </label>
	<select id="cntPrsnt" name="cntPrsnt" value="<%=cntPrsnt%>"><%=cnPerStr%></select>
</div>
<br>
<div class="col-md-4">
    <label class="required">Architect Name:</label>
    <input type="text" value="<%=archtNam%>" name="archtNam" class="required" id="archtNam" required> <br>
</div>
<div class="col-md-4">
    <label class="required">Mobile No</label>
    <input type="text" value="<%=mobileNo%>" maxlength="10" name="mobileNo" id="mobileNo" required>
</div>
<div class="col-md-4">
    <div class="d-flex flex-column mb-5 fv-row">
        <label class="d-flex align-items-center fs-5 fw-bold mb-2">Email</label>
        <input type='text' name='emailAdd' id="emailAdd" size='40' class="form-control" value='<%=emailAdd%>' maxlength='40' <%=disablFl%>>
    </div>
</div>
<br>
<h1 class="header-bw" align="center">Buyer Detail</h1>
<div class="col-md-4" id="gstDiv">
    <div class="d-flex flex-column mb-5 fv-row">
        <label class=" d-flex align-items-center fs-5 fw-bold mb-2">GST Number </label>
        <input type='text' name='gstnNumb' id="gstnNumb" placeholder="GSTIN" size='30' class="form-control" maxlength="15" value="<%=gstnNumb%>">        
        <div style="display:none" id="gstnNumbDiv"></div>
    </div>
</div>
<div class="col-md-4" id="panDiv">
    <div class="d-flex flex-column mb-5 fv-row">
        <label class=" d-flex align-items-center fs-5 fw-bold mb-2">PAN NO  </label>
        <input type="text" size="10" maxlength="10" name="itxPanNo" id="itxPanNo" class="form-control" placeholder="PAN" value="<%=itxPanNo%>">
        <input type="hidden" name="itxPanNoH" id="itxPanNoH" value="<%=itxPanNo%>">
        <div id="itxPanNoDiv"></div>
    </div>
</div>
<div class="col-md-4" id="panDiv">
    <div class="d-flex flex-column mb-5 fv-row">
        <label class=" d-flex align-items-center fs-5 fw-bold mb-2">AADHAR NO  </label>
        <input type="text" size="10" maxlength="12" name="adhrNumb" id="adhrNumb" class="form-control" placeholder="AADHAR" value="<%=adhrNumb%>">
        <input type="hidden" name="adhrNumb" id="adhrNumb" value="<%=adhrNumb%>">
        <div id="adhNoDiv"></div>
    </div>
</div>
<div class="col-md-4">
    <label class="required">Remarks</label>
    <input type="text" value="<%=siteRmrk%>" name="siteRmrk" id="siteRmrk" required>
</div>
</div>
<div class="mt-5" align="center">
<label class="control-label"> Upload Aadhar
    <input type='button' name='uplodBtn' class='coloredBtnBig' value='Upload Image' onClick="openUpldWind('<%=drawRand%>', '', '', '.5',  'A', '00')"></td>
    <input type="hidden" name="drawRand" value="<%=drawRand%>">
	<td><script language='javascript'>document.write(atchFileShowJS('<%=drawRand%>', 0, '', 'A'))</script>
</label>
<label class="control-label"> Upload PAN
    <input type='button' name='uplodBtn' class='coloredBtnBig' value='Upload Image' onClick="openUpldWind('<%=drawRand%>', '', '', '.5',  'B', '00')"></td>
    <input type="hidden" name="drawRand" value="<%=drawRand%>">
	<td><script language='javascript'>document.write(atchFileShowJS('<%=drawRand%>', 0, '', 'B'))</script>
</label>
<label class="control-label"> Upload Drawing
    <input type='button' name='uplodBtn' class='coloredBtnBig' value='Upload Image' onClick="openUpldWind('<%=drawRand%>', '', '', '.5',  'C', '00')"></td>
    <input type="hidden" name="drawRand" value="<%=drawRand%>">
	<td><script language='javascript'>document.write(atchFileShowJS('<%=drawRand%>', 0, '', 'C'))</script>
</label>
<label class="control-label"> Upload GST
    <input type='button' name='uplodBtn' class='coloredBtnBig' value='Upload Image' onClick="openUpldWind('<%=drawRand%>', '', '', '.5',  'D', '00')"></td>
    <input type="hidden" name="drawRand" value="<%=drawRand%>">
	<td><script language='javascript'>document.write(atchFileShowJS('<%=drawRand%>', 0, '', 'D'))</script>
</label>
</div>

<%
if(mobilApp)
{
%>
		<!--		<div class="form-group col-md-6  col-12">
					 <input type="button" name="getLocation" class="btn btn-secondary" value="Re Capture Location" onClick="getLocation()" /> 
				</div> -->
<%
}
%>
<div style="display: none;">
	<%@ include file="/Envr/JSP/LocaCapture.jsp"%> 
</div>
<%
if(!procType.equals(""))
{
	try 
	{
		 // Assuming "attachFl" is the column containing image data
		sql = " SELECT attachFl FROM imageData.dbo.cotDocAttch where docuNumb = '" + drawRand + "' ";
		rset = KkrSessBean.selectRecord(sql);
		// System.out.println("Executing SQL query: " + sql);

    while (rset.next()) 
	{
        Blob blob = rset.getBlob("attachFl");
        if (blob != null) 
		{
            int blobLength = (int) blob.length();
            byte[] bytes = blob.getBytes(1, blobLength);
            String imageData = Base64.getEncoder().encodeToString(bytes);
            // System.out.println("Retrieved image data: " + imageData);
            imageList.add(imageData);
            blob.free();  // Close the Blob after usage
        }
    }

    if (!imageList.isEmpty()) 
	{
        for (String imageData : imageList) 
		{
            byte[] decodedImageData = Base64.getDecoder().decode(imageData);

            try (ByteArrayInputStream inputStream = new ByteArrayInputStream(decodedImageData)) 
			{
%>
			<div class="col-md-2" align="center">
                <img height="250px" width="400px" align="center" src="data:image/jpeg;base64,<%= Base64.getEncoder().encodeToString(decodedImageData) %>" alt="Image" />
			</div>
<%
}
catch (IOException e) 
{
  e.printStackTrace();
}
        }
    }
} 
catch (Exception e) 
{
    e.printStackTrace();
}
}
}
catch(Exception e)
{
	throw new Exception("error in " + pageAddress + e + sql);
}
%>
	<div class="mt-5" align="center">
		<input type="button" name="btnSaveExit" value="Submit" class="coloredBtn" onClick="return submitValid()">
	</div>
</div>
<jsp:include page="/Envr/JSP/FooterCom.jsp" flush="true"/>
<script>
 function chkdc()
 {
	Swal.fire({
	  title: 'Are you at Purchaser shop?',
	  text: "Press Yes to capture current location!",
	  icon: 'warning',
	  showCancelButton: true,
	  confirmButtonColor: '#3085d6',
	  cancelButtonColor: '#d33',
	  confirmButtonText: 'Yes!'
	}).then((result) => {
	  if (result.isConfirmed) 
	  {
		 frmSubmt(true);
	  }
	})
}
 function frmSubmt(val)
 {
	 if(val)
	 {
		getLocation();
		//parseAndDisplayAddress();
	 } 
 }
 </script>

